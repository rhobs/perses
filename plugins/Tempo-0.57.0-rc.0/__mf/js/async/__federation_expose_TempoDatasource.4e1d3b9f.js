/*! For license information please see __federation_expose_TempoDatasource.4e1d3b9f.js.LICENSE.txt */
"use strict";(self.chunk_Tempo=self.chunk_Tempo||[]).push([["9871"],{74513:function(e,t,r){r.r(t),r.d(t,{StatusCodeError:()=>o,StatusCodeOk:()=>a,StatusCodeUnset:()=>n});let n="STATUS_CODE_UNSET",a="STATUS_CODE_OK",o="STATUS_CODE_ERROR"},37856:function(e,t,r){async function n(...e){let t=await globalThis.fetch(...e);if(!1===t.ok){let e=t.headers.get("content-type");if(e?.includes("application/json")){let e=await t.clone().json();if(e.error)throw new s(e.error,t.status);if(e.message)throw new s(e.message,t.status)}let r=await t.clone().text();if(r)throw new s(r,t.status);throw new o(t)}return t}async function a(...e){let t=await n(...e);if(!t.ok)throw new o(t);return await t.json()}r.d(t,{P7:()=>s,fk:()=>o,hd:()=>n,x6:()=>a});class o extends Error{status;constructor(e){super(`${e.status} ${e.statusText}`),this.status=e.status,Object.setPrototypeOf(this,o.prototype)}}class s extends Error{status;constructor(e,t){super(e),this.status=t,Object.setPrototypeOf(this,s.prototype)}}},2192:function(e,t,r){var n=r(70451),a=Symbol.for("react.element"),o=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,r){var n,o={},u=null,l=null;for(n in void 0!==r&&(u=""+r),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(l=t.ref),t)s.call(t,n)&&!c.hasOwnProperty(n)&&(o[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===o[n]&&(o[n]=t[n]);return{$$typeof:a,type:e,key:u,ref:l,props:o,_owner:i.current}}t.Fragment=o,t.jsx=u,t.jsxs=u},62540:function(e,t,r){e.exports=r(2192)},55075:function(e,t,r){r.r(t),r.d(t,{TempoDatasource:()=>f});var n=r(37856),a=r(74513);let o=async function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let a=await (0,n.hd)(...t);try{return await a.json()}catch(e){throw console.error("Invalid response from server",e),Error("Invalid response from server")}};function s(e,t,r){let{datasourceUrl:n,headers:a={}}=r,s=`${n}${e}`,i=(function(e){let t=new URLSearchParams;for(let r in e){let n=e[r];switch(typeof n){case"string":t.append(r,n);break;case"number":t.append(r,n.toString())}}return t})(t).toString();return""!==i&&(s+="?"+i),o(s,{method:"GET",headers:a})}function i(e,t){return s("/api/search",e,t)}function c(e,t){return s(`/api/traces/${encodeURIComponent(e.traceId)}`,{},t)}async function u(e,t){let r=await i(e,t);return r.traces&&0!==r.traces.length?r.traces.every(e=>e.serviceStats)?r:{traces:await Promise.all(r.traces.map(async e=>{if(e.serviceStats)return e;let r={};for(let s of(await c({traceId:e.traceID},t)).batches){var n,o;let e="unknown";for(let t of(null==(n=s.resource)?void 0:n.attributes)??[])if("service.name"===t.key&&"stringValue"in t.value){e=t.value.stringValue;break}let t=r[e]??{spanCount:0};for(let e of s.scopeSpans)for(let r of(t.spanCount+=e.spans.length,e.spans))(null==(o=r.status)?void 0:o.code)===a.StatusCodeError&&(t.errorCount=(t.errorCount??0)+1);r[e]=t}return{...e,serviceStats:r}}))}:{traces:[]}}var l=r(62540),p=r(57744);r(70451);let f={createClient:(e,t)=>{let{directUrl:r,proxy:n}=e,{proxyUrl:a}=t,o=r??a;if(void 0===o)throw Error("No URL specified for Tempo client. You can use directUrl in the spec to configure it.");let l=null==n?void 0:n.spec.headers;return{options:{datasourceUrl:o},query:(e,t)=>c(e,{datasourceUrl:o,headers:t??l}),search:(e,t)=>i(e,{datasourceUrl:o,headers:t??l}),searchWithFallback:(e,t)=>u(e,{datasourceUrl:o,headers:t??l}),searchTags:(e,t)=>s("/api/v2/search/tags",e,{datasourceUrl:o,headers:t??l}),searchTagValues:(e,t)=>(function(e,t){let{tag:r,...n}=e;return s(`/api/v2/search/tag/${encodeURIComponent(r)}/values`,n,t)})(e,{datasourceUrl:o,headers:t??l})}},OptionsEditorComponent:function(e){let{value:t,onChange:r,isReadonly:n}=e;return(0,l.jsx)(p.HTTPSettingsEditor,{value:t,onChange:r,isReadonly:n,initialSpecDirect:{directUrl:""},initialSpecProxy:{proxy:{kind:"HTTPProxy",spec:{allowedEndpoints:[{endpointPattern:"/api/search",method:"GET"},{endpointPattern:"/api/traces",method:"GET"},{endpointPattern:"/api/v2/search/tags",method:"GET"},{endpointPattern:"/api/v2/search/tag",method:"GET"}],url:""}}}})},createInitialOptions:()=>({directUrl:""})}}}]);