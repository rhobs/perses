{"version":3,"sources":["../../src/TimeSeriesExportAction.tsx"],"sourcesContent":["// Copyright 2023 The Perses Authors\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport React, { useCallback, useMemo } from 'react';\nimport { IconButton, Tooltip } from '@mui/material';\nimport DownloadIcon from 'mdi-material-ui/Download';\nimport { TimeSeriesChartProps } from './TimeSeriesChartPanel';\nimport { extractExportableData, isExportableData, sanitizeFilename, exportDataAsCSV } from './CSVExportUtils';\n\nexport const TimeSeriesExportAction: React.FC<TimeSeriesChartProps> = ({ queryResults, definition }) => {\n  const exportableData = useMemo(() => {\n    return extractExportableData(queryResults);\n  }, [queryResults]);\n\n  const canExport = useMemo(() => {\n    return isExportableData(exportableData);\n  }, [exportableData]);\n\n  const handleExport = useCallback(() => {\n    if (!exportableData || !canExport) return;\n\n    try {\n      const title = definition?.spec?.display?.name || 'Time Series Data';\n\n      const csvBlob = exportDataAsCSV({\n        data: exportableData,\n      });\n\n      const baseFilename = sanitizeFilename(title);\n      const filename = `${baseFilename}_data.csv`;\n\n      const link = document.createElement('a');\n      link.href = URL.createObjectURL(csvBlob);\n      link.download = filename;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(link.href);\n    } catch (error) {\n      console.error('Time series export failed:', error);\n    }\n  }, [exportableData, canExport, definition]);\n\n  if (!canExport) {\n    return null;\n  }\n\n  return (\n    <Tooltip title=\"Export as CSV\">\n      <IconButton size=\"small\" onClick={handleExport} aria-label=\"Export time series data as CSV\">\n        <DownloadIcon fontSize=\"inherit\" />\n      </IconButton>\n    </Tooltip>\n  );\n};\n"],"names":["React","useCallback","useMemo","IconButton","Tooltip","DownloadIcon","extractExportableData","isExportableData","sanitizeFilename","exportDataAsCSV","TimeSeriesExportAction","queryResults","definition","exportableData","canExport","handleExport","title","spec","display","name","csvBlob","data","baseFilename","filename","link","document","createElement","href","URL","createObjectURL","download","body","appendChild","click","removeChild","revokeObjectURL","error","console","size","onClick","aria-label","fontSize"],"mappings":";AAAA,oCAAoC;AACpC,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,6CAA6C;AAC7C,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;AAEjC,OAAOA,SAASC,WAAW,EAAEC,OAAO,QAAQ,QAAQ;AACpD,SAASC,UAAU,EAAEC,OAAO,QAAQ,gBAAgB;AACpD,OAAOC,kBAAkB,2BAA2B;AAEpD,SAASC,qBAAqB,EAAEC,gBAAgB,EAAEC,gBAAgB,EAAEC,eAAe,QAAQ,mBAAmB;AAE9G,OAAO,MAAMC,yBAAyD,CAAC,EAAEC,YAAY,EAAEC,UAAU,EAAE;IACjG,MAAMC,iBAAiBX,QAAQ;QAC7B,OAAOI,sBAAsBK;IAC/B,GAAG;QAACA;KAAa;IAEjB,MAAMG,YAAYZ,QAAQ;QACxB,OAAOK,iBAAiBM;IAC1B,GAAG;QAACA;KAAe;IAEnB,MAAME,eAAed,YAAY;QAC/B,IAAI,CAACY,kBAAkB,CAACC,WAAW;QAEnC,IAAI;YACF,MAAME,QAAQJ,YAAYK,MAAMC,SAASC,QAAQ;YAEjD,MAAMC,UAAUX,gBAAgB;gBAC9BY,MAAMR;YACR;YAEA,MAAMS,eAAed,iBAAiBQ;YACtC,MAAMO,WAAW,GAAGD,aAAa,SAAS,CAAC;YAE3C,MAAME,OAAOC,SAASC,aAAa,CAAC;YACpCF,KAAKG,IAAI,GAAGC,IAAIC,eAAe,CAACT;YAChCI,KAAKM,QAAQ,GAAGP;YAChBE,SAASM,IAAI,CAACC,WAAW,CAACR;YAC1BA,KAAKS,KAAK;YACVR,SAASM,IAAI,CAACG,WAAW,CAACV;YAC1BI,IAAIO,eAAe,CAACX,KAAKG,IAAI;QAC/B,EAAE,OAAOS,OAAO;YACdC,QAAQD,KAAK,CAAC,8BAA8BA;QAC9C;IACF,GAAG;QAACvB;QAAgBC;QAAWF;KAAW;IAE1C,IAAI,CAACE,WAAW;QACd,OAAO;IACT;IAEA,qBACE,KAACV;QAAQY,OAAM;kBACb,cAAA,KAACb;YAAWmC,MAAK;YAAQC,SAASxB;YAAcyB,cAAW;sBACzD,cAAA,KAACnC;gBAAaoC,UAAS;;;;AAI/B,EAAE"}