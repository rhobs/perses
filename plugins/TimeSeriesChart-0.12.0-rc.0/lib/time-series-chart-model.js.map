{"version":3,"sources":["../../src/time-series-chart-model.ts"],"sourcesContent":["// Copyright 2023 The Perses Authors\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Definition, ThresholdOptions, FormatOptions } from '@perses-dev/core';\nimport { OptionsEditorProps, LegendSpecOptions } from '@perses-dev/plugin-system';\n\n/**\n * Line style options for time series charts.\n */\nexport type LineStyleType = 'solid' | 'dashed' | 'dotted';\n\n/**\n * The schema for a TimeSeriesChart panel.\n */\nexport interface TimeSeriesChartDefinition extends Definition<TimeSeriesChartOptions> {\n  kind: 'TimeSeriesChart';\n}\n\n/**\n * The Options object supported by the TimeSeriesChartPanel plugin.\n */\nexport interface TimeSeriesChartOptions {\n  legend?: LegendSpecOptions;\n  yAxis?: TimeSeriesChartYAxisOptions;\n  thresholds?: ThresholdOptions;\n  visual?: TimeSeriesChartVisualOptions;\n  tooltip?: TooltipSpecOptions;\n  querySettings?: QuerySettingsOptions[];\n}\n\nexport interface QuerySettingsOptions {\n  queryIndex: number;\n  colorMode?: 'fixed' | 'fixed-single';\n  colorValue?: string;\n  lineStyle?: LineStyleType;\n  areaOpacity?: number;\n}\n\nexport type TimeSeriesChartOptionsEditorProps = OptionsEditorProps<TimeSeriesChartOptions>;\n\nexport interface TimeSeriesChartYAxisOptions {\n  show?: boolean;\n  label?: string;\n  format?: FormatOptions;\n  min?: number;\n  max?: number;\n  logBase?: LOG_BASE;\n}\n\nexport interface TooltipSpecOptions {\n  enablePinning: boolean;\n}\n\nexport interface TimeSeriesChartPaletteOptions {\n  mode: 'auto' | 'categorical';\n}\n\nexport type TimeSeriesChartVisualOptions = {\n  display?: 'line' | 'bar';\n  lineWidth?: number;\n  lineStyle?: LineStyleType;\n  areaOpacity?: number;\n  showPoints?: 'auto' | 'always';\n  palette?: TimeSeriesChartPaletteOptions;\n  pointRadius?: number;\n  stack?: StackOptions;\n  connectNulls?: boolean;\n};\n\nexport const DEFAULT_FORMAT: FormatOptions = {\n  unit: 'decimal',\n  shortValues: true,\n};\n\nexport const DEFAULT_Y_AXIS: TimeSeriesChartYAxisOptions = {\n  show: true,\n  label: '',\n  format: DEFAULT_FORMAT,\n  min: undefined,\n  max: undefined,\n  logBase: 'none',\n};\n\nexport const Y_AXIS_CONFIG = {\n  show: { label: 'Show' },\n  label: { label: 'Label' },\n  unit: { label: 'Unit' },\n  min: { label: 'Min' },\n  max: { label: 'Max' },\n  logBase: { label: 'Log Base' },\n};\n\nexport const DEFAULT_DISPLAY = 'line';\nexport const DEFAULT_LINE_WIDTH = 1.25;\nexport const DEFAULT_LINE_STYLE = 'solid';\nexport const DEFAULT_AREA_OPACITY = 0;\n// How much larger datapoint symbols are than line width, also applied in VisualOptionsEditor.\nexport const POINT_SIZE_OFFSET = 1.5;\nexport const DEFAULT_POINT_RADIUS = DEFAULT_LINE_WIDTH + POINT_SIZE_OFFSET;\nexport const DEFAULT_CONNECT_NULLS = false;\n\nexport const DEFAULT_VISUAL: TimeSeriesChartVisualOptions = {\n  display: DEFAULT_DISPLAY,\n  lineWidth: DEFAULT_LINE_WIDTH,\n  lineStyle: DEFAULT_LINE_STYLE,\n  areaOpacity: DEFAULT_AREA_OPACITY,\n  pointRadius: DEFAULT_POINT_RADIUS,\n  connectNulls: DEFAULT_CONNECT_NULLS,\n};\n\n// Controls how often static threshold values should be plotted so threshold data shows\n// in tooltip without flicker.\nexport const THRESHOLD_PLOT_INTERVAL = 15;\n\nexport const VISUAL_CONFIG = {\n  lineWidth: {\n    label: 'Line Width',\n    testId: 'slider-line-width',\n    min: 0.25,\n    max: 3,\n    step: 0.25,\n  },\n  lineStyle: {\n    label: 'Line Style',\n  },\n  pointRadius: {\n    label: 'Point Radius',\n    testId: 'slider-point-radius',\n    min: 0,\n    max: 6,\n    step: 0.25,\n  },\n  areaOpacity: {\n    label: 'Area Opacity',\n    testId: 'slider-area-opacity',\n    min: 0,\n    max: 1,\n    step: 0.05,\n  },\n  stack: {\n    label: 'Stack Series',\n  },\n  connectNulls: {\n    label: 'Connect Nulls',\n  },\n};\n\n// None is equivalent to undefined since stack is optional\nexport type StackOptions = 'none' | 'all'; // TODO: add percent option support\n\nexport const STACK_CONFIG = {\n  none: { label: 'None' },\n  all: { label: 'All' },\n  // TODO: enable option after 'Percent' implemented\n  // percent: { label: 'Percent', disabled: true }, // hidden since not implemented yet\n};\n\nexport const STACK_OPTIONS = Object.entries(STACK_CONFIG).map(([id, config]) => {\n  return {\n    id: id as StackOptions,\n    ...config,\n  };\n});\n\nexport const LINE_STYLE_CONFIG = {\n  solid: { label: 'Solid' },\n  dashed: { label: 'Dashes' },\n  dotted: { label: 'Dots' },\n};\n\nexport const OPACITY_CONFIG = {\n  label: 'Opacity',\n  testId: 'slider-opacity',\n  min: 0,\n  max: 1,\n  step: 0.05,\n};\n\n// LogBase outlines the allowed log bases for the log-supported charts.\nexport type LOG_BASE_LABEL = 'none' | 'log2' | 'log10';\nexport type LOG_BASE = 'none' | 2 | 10;\n\n// Single source of truth for log base configuration\nexport const LOG_BASE_CONFIG: Record<LOG_BASE_LABEL, { label: string; log: LOG_BASE }> = {\n  none: { label: 'None', log: 'none' },\n  log2: { label: '2', log: 2 },\n  log10: { label: '10', log: 10 },\n};\n\n// Options array for SettingsAutocomplete\nexport const LOG_BASE_OPTIONS = Object.entries(LOG_BASE_CONFIG).map(([id, config]) => ({\n  id: id as LOG_BASE_LABEL,\n  ...config,\n}));\n\n// Reverse lookup map from LOG_BASE value to LOG_BASE_LABEL\nexport const LOG_VALID_BASES: Record<LOG_BASE, LOG_BASE_LABEL> = Object.fromEntries(\n  Object.entries(LOG_BASE_CONFIG).map(([label, config]) => [config.log, label])\n) as Record<LOG_BASE, LOG_BASE_LABEL>;\n\n// Both of these constants help produce a value that is LESS THAN the initial value.\n// For positive values, we multiply by a number less than 1 to get this outcome.\n// For negative values, we multiply to a number greater than 1 to get this outcome.\nexport const POSITIVE_MIN_VALUE_MULTIPLIER = 0.8;\nexport const NEGATIVE_MIN_VALUE_MULTIPLIER = 1.2;\n\n/**\n * Creates an initial/empty options object for the TimeSeriesChartPanel.\n */\nexport function createInitialTimeSeriesChartOptions(): TimeSeriesChartOptions {\n  return {};\n}\n"],"names":["DEFAULT_FORMAT","unit","shortValues","DEFAULT_Y_AXIS","show","label","format","min","undefined","max","logBase","Y_AXIS_CONFIG","DEFAULT_DISPLAY","DEFAULT_LINE_WIDTH","DEFAULT_LINE_STYLE","DEFAULT_AREA_OPACITY","POINT_SIZE_OFFSET","DEFAULT_POINT_RADIUS","DEFAULT_CONNECT_NULLS","DEFAULT_VISUAL","display","lineWidth","lineStyle","areaOpacity","pointRadius","connectNulls","THRESHOLD_PLOT_INTERVAL","VISUAL_CONFIG","testId","step","stack","STACK_CONFIG","none","all","STACK_OPTIONS","Object","entries","map","id","config","LINE_STYLE_CONFIG","solid","dashed","dotted","OPACITY_CONFIG","LOG_BASE_CONFIG","log","log2","log10","LOG_BASE_OPTIONS","LOG_VALID_BASES","fromEntries","POSITIVE_MIN_VALUE_MULTIPLIER","NEGATIVE_MIN_VALUE_MULTIPLIER","createInitialTimeSeriesChartOptions"],"mappings":"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"}