"use strict";(self.chunk_TimeSeriesChart=self.chunk_TimeSeriesChart||[]).push([["53"],{3233:function(e,t,l){l.r(t),l.d(t,{TimeSeriesChart:()=>eN});let n={unit:"decimal",shortValues:!0},a={show:!0,label:"",format:n,min:void 0,max:void 0,logBase:"none"},i="Label",o="Min",r="Max",s="Log Base",d={display:"line",lineWidth:1.25,lineStyle:"solid",areaOpacity:0,pointRadius:2.75,connectNulls:!1},u="Line Width",c="slider-line-width",h=.25,p=3,m=.25,v="Line Style",g="Area Opacity",x="slider-area-opacity",y=0,f=1,b=.05,j="Stack Series",C="Connect Nulls",A={none:{label:"None"},all:{label:"All"}},S=Object.entries(A).map(e=>{let[t,l]=e;return{id:t,...l}}),M={solid:{label:"Solid"},dashed:{label:"Dashes"},dotted:{label:"Dots"}},w={none:{label:"None",log:"none"},log2:{label:"2",log:2},log10:{label:"10",log:10}},O=Object.entries(w).map(e=>{let[t,l]=e;return{id:t,...l}}),E=Object.fromEntries(Object.entries(w).map(e=>{let[t,l]=e;return[l.log,t]}));var T=l(62540),L=l(7013),k=l(38662),D=l(37266),I=l(57744),_=l(61375),R=l(31729),N=l(40704),$=l(68003);function P(e){let{value:t,onChange:l}=e,n=t.stack??"none",a=A[n];return(0,T.jsxs)(D.OptionsEditorGroup,{title:"Visual",children:[(0,T.jsx)(D.OptionsEditorControl,{label:j,control:(0,T.jsx)(D.SettingsAutocomplete,{value:{...a,id:n},options:S,onChange:(e,n)=>{let a={...t,stack:"none"===n.id?void 0:n.id};"all"!==n.id||t.areaOpacity||(a.areaOpacity=.3),l(a)},disabled:void 0===t,disableClearable:!0})}),(0,T.jsx)(D.OptionsEditorControl,{label:"Display",control:(0,T.jsxs)(_.A,{color:"primary",exclusive:!0,value:t.display??"line",onChange:(e,n)=>{l({...t,display:n})},children:[(0,T.jsx)(R.A,{value:"line",selected:void 0===t.display||"line"===t.display,"aria-label":"display line series",children:"Line"}),(0,T.jsx)(R.A,{value:"bar","aria-label":"display bar series",children:"Bar"})]})}),"line"===t.display&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(D.OptionsEditorControl,{label:u,control:(0,T.jsx)(N.Ay,{"data-testid":c,value:t.lineWidth??1.25,valueLabelDisplay:"auto",step:m,marks:!0,min:h,max:p,onChange:(e,n)=>{let a=Array.isArray(n)?n[0]:n,i=void 0!==a?a+1.5:2.75;l((0,k.jM)(t,e=>{e.lineWidth=a,e.pointRadius=i}))}})}),(0,T.jsx)(D.OptionsEditorControl,{label:v,control:(0,T.jsx)(_.A,{color:"primary",exclusive:!0,value:t.lineStyle??"solid",onChange:(e,n)=>{l({...t,lineStyle:n})},children:Object.entries(M).map(e=>{let[t,l]=e;return(0,T.jsx)(R.A,{value:t,"aria-label":`${t} line style`,children:l.label},t)})})}),(0,T.jsx)(D.OptionsEditorControl,{label:g,control:(0,T.jsx)(N.Ay,{"data-testid":x,value:t.areaOpacity??0,valueLabelDisplay:"auto",step:b,marks:!0,min:y,max:f,onChange:(e,n)=>{let a=Array.isArray(n)?n[0]:n;l((0,k.jM)(t,e=>{e.areaOpacity=a}))}})}),(0,T.jsx)(D.OptionsEditorControl,{label:C,control:(0,T.jsx)($.A,{checked:t.connectNulls??!1,onChange:e=>{l({...t,connectNulls:e.target.checked})}})})]})]})}var V=l(93648);function F(e){let{value:t,onChange:l}=e,d=w[E[t.logBase??"none"]];return(0,T.jsxs)(D.OptionsEditorGroup,{title:"Y Axis",children:[(0,T.jsx)(D.OptionsEditorControl,{label:"Show",control:(0,T.jsx)($.A,{checked:t.show??a.show,onChange:e=>{l({...t,show:e.target.checked})}})}),(0,T.jsx)(D.FormatControls,{value:t.format??n,onChange:e=>l({...t,format:e})}),(0,T.jsx)(D.OptionsEditorControl,{label:s,control:(0,T.jsx)(D.SettingsAutocomplete,{value:{...d,id:d.label},options:O,onChange:(e,n)=>{l({...t,logBase:n.log})},disabled:void 0===t,disableClearable:!0})}),(0,T.jsx)(D.OptionsEditorControl,{label:i,control:(0,T.jsx)(V.A,{value:t.label??"",inputProps:{"aria-label":"enter y axis label"},onChange:e=>l({...t,label:e.target.value}),placeholder:"Default"})}),(0,T.jsx)(D.OptionsEditorControl,{label:o,control:(0,T.jsx)(V.A,{type:"number",value:t.min??"",onChange:e=>{let n=e.target.value?Number(e.target.value):void 0;l({...t,min:n})},placeholder:"Default"})}),(0,T.jsx)(D.OptionsEditorControl,{label:r,control:(0,T.jsx)(V.A,{type:"number",value:t.max??"",onChange:e=>{let n=e.target.value?Number(e.target.value):void 0;l({...t,max:n})},placeholder:"Default"})})]})}var G=l(315),q=l(88091),B=l(97653),z=l(74628),U=l(47095),W=l(30145),H=l(56599),Q=l(70451),Y=l(86067),Z=l(86742),X=l(7800);let K="#555";function J(e){let{querySettings:{queryIndex:t,colorMode:l,colorValue:n,lineStyle:a,areaOpacity:i},availableQueryIndexes:o,onQueryIndexChange:r,onColorModeChange:s,onColorValueChange:d,onLineStyleChange:u,onAreaOpacityChange:c,onDelete:h,inputRef:p,onAddColor:m,onRemoveColor:v,onAddLineStyle:g,onRemoveLineStyle:x,onAddAreaOpacity:y,onRemoveAreaOpacity:f}=e,b=o.concat(t).sort((e,t)=>e-t),[j,C]=(0,Q.useState)(null),A=(0,Q.useMemo)(()=>{let e=[];return l||e.push({key:"color",label:"Color",action:m}),a||e.push({key:"lineStyle",label:"Line Style",action:g}),void 0===i&&e.push({key:"opacity",label:"Opacity",action:y}),e},[l,a,i,m,g,y]),S=()=>{C(null)};return(0,T.jsx)(G.A,{spacing:2,sx:{borderBottom:"1px solid",borderColor:"divider",borderRadius:1,p:2},children:(0,T.jsxs)(G.A,{direction:"row",alignItems:"center",spacing:1,sx:{flexWrap:"wrap",gap:1},children:[(0,T.jsx)(V.A,{select:!0,inputRef:p,value:t,label:"Query",onChange:r,sx:{minWidth:"75px"},children:b.map(e=>(0,T.jsxs)(B.A,{value:e,children:["#",e+1]},`query-${e}`))}),l&&(0,T.jsxs)(ee,{label:"Color",onRemove:v,children:[(0,T.jsxs)(V.A,{select:!0,value:l,onChange:s,size:"small",sx:{flexGrow:1},children:[(0,T.jsx)(B.A,{value:"fixed-single",children:"Fixed (single)"}),(0,T.jsx)(B.A,{value:"fixed",children:"Fixed"})]}),(0,T.jsx)(D.OptionsColorPicker,{label:`Query n\xb0${t+1}`,color:n||K,onColorChange:d})]}),a&&(0,T.jsxs)(ee,{label:"Line Style",onRemove:x,children:[(0,T.jsx)(_.A,{color:"primary",exclusive:!0,value:a,onChange:(e,t)=>{null!==t&&u(t)},size:"small",children:Object.entries(M).map(e=>{let[t,l]=e;return(0,T.jsx)(R.A,{value:t,"aria-label":`${t} line style`,children:l.label},t)})}),(0,T.jsx)(z.A,{sx:{flexGrow:1}})]}),void 0!==i&&(0,T.jsxs)(ee,{label:"Opacity",onRemove:f,children:[(0,T.jsx)(z.A,{}),(0,T.jsx)(N.Ay,{value:i,valueLabelDisplay:"auto",step:.05,marks:!0,min:0,max:1,onChange:c,sx:{flexGrow:1}})]}),A.length>0&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(U.A,{onClick:e=>{1===A.length&&A[0]?A[0].action():C(e.currentTarget)},"aria-label":"Add option",children:(0,T.jsx)(Z.default,{})}),(0,T.jsx)(W.A,{anchorEl:j,open:!!j,onClose:S,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:A.map(e=>(0,T.jsxs)(B.A,{onClick:()=>{(0,e.action)(),S()},sx:{minWidth:"120px"},children:[(0,T.jsx)(Z.default,{sx:{mr:1,fontSize:"1rem"}}),e.label]},e.key))})]}),(0,T.jsx)(z.A,{sx:{flexGrow:1}}),(0,T.jsx)(U.A,{"aria-label":`delete settings for query n\xb0${t+1}`,onClick:h,children:(0,T.jsx)(Y.default,{})})]})})}function ee(e){let{label:t,children:l,onRemove:n}=e,a=(0,H.A)();return(0,T.jsxs)(z.A,{sx:{position:"relative",minWidth:"250px"},children:[(0,T.jsx)(q.A,{variant:"caption",sx:{position:"absolute",top:-8,left:12,backgroundColor:a.palette.background.code,px:.5,color:"text.secondary",zIndex:1},children:t}),(0,T.jsxs)(G.A,{direction:"row",alignItems:"center",spacing:1,sx:{border:"1px solid",borderColor:"divider",borderRadius:1,p:1},children:[l,(0,T.jsx)(U.A,{size:"small",onClick:n,"aria-label":`Remove ${t}`,children:(0,T.jsx)(X.default,{})})]})]})}var et=l(25632),el=l.n(et),en=l(3967),ea=l(87680),ei=l(99415),eo=l(12826);function er(e){let t=Math.floor(Math.log10(Math.abs(e)));return Math.floor(e/Math.pow(10,t))*Math.pow(10,t)}var es=l(92959);let ed=new es.A({hue:{min:20,max:360}}),eu=new es.A({hue:{min:0,max:20}}),ec={};var eh=l(18264),ep=l.n(eh),em=l(63682),ev=l(74653),eg=l(62707),ex=l(31373),ey=l(59738),ef=l(90652),eb=l(61305),ej=l(64404),eC=l(28502),eA=l(48683),eS=l(72106),eM=l(40988),ew=l(55875),eO=l(37573);(0,ev.Y)([eg.a,ex.a,ey.a,ef.a,eb.a,ej.a,eC.a,eA.a,eS.a,eM.a,ew.a,eO.a]);let eE=(0,Q.forwardRef)(function(e,t){var l;let n,{height:a,data:i,seriesMapping:o,timeScale:r,yAxis:s,format:d,grid:u,isStackedBar:c=!1,tooltipConfig:h=D.DEFAULT_TOOLTIP_CONFIG,noDataVariant:p="message",syncGroup:m,onDataZoom:v,onDoubleClick:g,__experimentalEChartsOptionsOverride:x}=e,{chartsTheme:y,enablePinning:f,enableSyncGrouping:b,lastTooltipPinnedCoords:j,setLastTooltipPinnedCoords:C}=(0,D.useChartsContext)(),A=h.enablePinning&&f,S=(0,Q.useRef)(),[M,w]=(0,Q.useState)(!0),[O,E]=(0,Q.useState)(null),[L,k]=(0,Q.useState)(null),[I,_]=(0,Q.useState)(!1),[R,N]=(0,Q.useState)(0),{timeZone:$}=(0,D.useTimeZone)();if(void 0===r){let e=(0,ei.l$)(i);if(void 0===e){let e=new Date,t=new Date(e);t.setFullYear(e.getFullYear()-5);let l=e.getTime(),a=t.getTime();n={startMs:a,endMs:l,stepMs:1,rangeMs:l-a}}else n=e}else n=r;(0,Q.useImperativeHandle)(t,()=>({highlightSeries(e){let{name:t}=e;S.current&&S.current.dispatchAction({type:"highlight",seriesId:t})},clearHighlightedSeries:()=>{S.current&&(0,D.clearHighlightedSeries)(S.current)}}),[]);let P=(0,Q.useMemo)(()=>({datazoom:e=>{if(void 0===v&&setTimeout(()=>{E(null)},10),void 0===v||void 0===e.batch[0])return;let t=e.batch[0].startValue,l=e.batch[0].endValue;void 0!==t&&void 0!==l&&v({start:t,end:l})},finished:()=>{void 0!==S.current&&(0,D.enableDataZoom)(S.current)}}),[v,E]),{noDataOption:V}=y,F=(0,Q.useMemo)(()=>{if(null===i||0===i.length&&"message"===p)return V;let e=[],t="local"===$;i.map((l,n)=>{let a=l.values.map(e=>{let[l,n]=e;return[t?l:(0,em.toZonedTime)(l,$),null===n?"-":n]});e.push({id:n,source:[...a],dimensions:["time","value"]})});let l={dataset:e,series:f&&null!==L?[...o,L]:o,xAxis:{type:"time",min:t?n.startMs:(0,em.toZonedTime)(n.startMs,$),max:t?n.endMs:(0,em.toZonedTime)(n.endMs,$),axisLabel:{hideOverlap:!0,formatter:(0,D.getFormattedAxisLabel)(n.rangeMs??0)},axisPointer:{snap:!1}},yAxis:(0,D.getFormattedAxis)(s,d),animation:!1,tooltip:{show:!0,showContent:c,trigger:c?"item":"axis",appendToBody:c},axisPointer:{type:"line",z:0,triggerEmphasis:!1,triggerTooltip:!1,snap:!1},toolbox:{feature:{dataZoom:{icon:null,yAxisIndex:"none"}}},grid:u};return x?x(l):l},[i,o,n,s,d,u,V,x,p,$,c,f,L]);return(0,Q.useEffect)(()=>{null===O||null===j||ep()(j,O)||(E(null),null!==O&&null!==L&&k(null))},[j,o]),(0,T.jsxs)(z.A,{style:{height:a},onClick:e=>{let t=e.ctrlKey||e.metaKey;t&&e.preventDefault();let l=(0,D.getPointInGrid)(e.nativeEvent.offsetX,e.nativeEvent.offsetY,S.current);if(null!==l&&A&&e.target instanceof HTMLCanvasElement){let n={page:{x:e.pageX,y:e.pageY},client:{x:e.clientX,y:e.clientY},plotCanvas:{x:e.nativeEvent.offsetX,y:e.nativeEvent.offsetY},target:e.target};E(e=>null===e?n:(k(null),null)),k(e=>{if(null!==e)return null;{var t;let e=l[0],n=null==(t=i[0])?void 0:t.values,a=(0,D.getClosestTimestamp)(n,e);return el()({},D.DEFAULT_PINNED_CROSSHAIR,{markLine:{data:[{xAxis:a}]}})}}),t||C(n)}},onMouseDown:e=>{let{clientX:t}=e;_(!0),N(t)},onMouseMove:e=>{if(!(e.target instanceof HTMLCanvasElement))return;let{clientX:t}=e;I&&t-R>0&&w(!1)},onMouseUp:()=>{_(!1),N(0),w(!0)},onMouseLeave:()=>{null===O&&w(!1),void 0!==S.current&&(0,D.clearHighlightedSeries)(S.current)},onMouseEnter:()=>{w(!0),void 0!==S.current&&(0,D.enableDataZoom)(S.current)},onDoubleClick:e=>{E(null),void 0===g?void 0!==S.current&&(0,D.restoreChart)(S.current):g(e)},children:[!0===M&&(null==(l=F.tooltip)?void 0:l.showContent)===!1&&!0!==h.hidden&&(0,T.jsx)(D.TimeChartTooltip,{containerId:y.tooltipPortalContainerId,chartRef:S,data:i,seriesMapping:o,wrapLabels:h.wrapLabels,enablePinning:A,pinnedPos:O,format:d,onUnpinClick:()=>{E(null),k(null)}}),(0,T.jsx)(D.EChart,{sx:{width:"100%",height:"100%"},option:F,theme:y.echartsTheme,onEvents:P,_instance:S,syncGroup:b?m:void 0})]})});var eT=l(65211),eL=l(54042);let ek=e=>!!(e&&"object"==typeof e&&"series"in e&&Array.isArray(e.series)&&e.series.length>0),eD=(e,t)=>{let l=e.formattedName||e.name;if(l&&l!==`Series ${t+1}`||(l=e.legendName||e.displayName||e.legend||e.name||""),(!l||l===e.name)&&e.labels){let n=e.labels,a={...n},i=a.__name__;delete a.__name__;let o=Object.entries(a).filter(e=>{let[t]=e;return null!=t&&""!==t}).map(e=>{let[t,l]=e;return`${t}="${l}"`}).join(", ");l=i&&o?`${i}{${o}}`:i||(o?`{${o}}`:n.job||n.instance||n.metric||`Series ${t+1}`)}return l&&""!==l.trim()||(l=`Series ${t+1}`),l},eI=e=>e.replace(/[,"\n\r]/g,"_").replace(/\s+/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"").substring(0,255),e_=e=>{let t;if("string"==typeof e){let l=new Date(e);if(isNaN(l.getTime()))return e;t=l.getTime()}else t=e>1e10?e:1e3*e;let l=new Date(t);return isNaN(l.getTime())?new Date(t).toISOString():l.toISOString()},eR=e=>{if(null==e)return"";let t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")||t.includes("\r")?`"${t.replace(/"/g,'""')}"`:t},eN={PanelComponent:function(e){var t;let{spec:{thresholds:l,yAxis:i,tooltip:o,querySettings:r},contentDimensions:s,queryResults:u}=e,c=(0,D.useChartsTheme)(),h=(0,H.A)(),p=(0,D.useId)("time-series-panel"),m=(0,Q.useRef)(null),v=c.echartsTheme.color,g=c.container.padding.default,x=s?{width:s.width-2*g,height:s.height-2*g}:void 0,y=(0,Q.useMemo)(()=>e.spec.legend&&(0,I.validateLegendSpec)(e.spec.legend)?el()({},en.yf,e.spec.legend):void 0,[e.spec.legend]),f=(null==(t=e.spec.yAxis)?void 0:t.format)??n,b=(0,Q.useMemo)(()=>el()({},d,e.spec.visual),[e.spec.visual]),j=(null==i?void 0:i.logBase)??"none",C=(0,Q.useMemo)(()=>(function(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=arguments.length>1?arguments[1]:void 0;e=(null==t?void 0:t.min)!==void 0?t.min:"none"!==l?void 0:e=>e.min>=0&&e.min<=1?0:e.min>0?er(.8*e.min):er(1.2*e.min);let n={show:!0,axisLabel:{show:(null==t?void 0:t.show)??a.show},min:e,max:null==t?void 0:t.max};return"none"!==l?{...n,type:"log",logBase:l}:n})(i,j),[i,j]),[A,S]=(0,Q.useState)("ALL"),[M,w]=(0,Q.useState)(),{setTimeRange:O}=(0,I.useTimeRange)(),{timeScale:E,timeChartData:L,timeSeriesMapping:k,legendItems:_}=(0,Q.useMemo)(()=>{let e,t=(e=u.map(e=>e.data),(0,ei.l$)(e));if(void 0===t)return{timeChartData:[],timeSeriesMapping:[]};let n=[],a=[],o=[],s=0;for(let e=0;e<u.length;e++){let l,i=u[e];for(let t of r??[])t.queryIndex===e&&(l=t);if(i)for(let r=0;r<i.data.series.length;r++){var d,m,g;let c=i.data.series[r];if(void 0===c)return{timeChartData:[],timeSeriesMapping:[],legendItems:[]};let x=c.formattedName??c.name,f=function(e){var t,l,n;let{categoricalPalette:a,visual:i,muiPrimaryColor:o,seriesName:r,seriesIndex:s,querySettings:d,queryHasMultipleResults:u}=e;if(d){if("fixed"===d.colorMode&&d.colorValue)return d.colorValue;else if("fixed-single"===d.colorMode&&!u&&d.colorValue)return d.colorValue}let c=Array.isArray(a)&&a[0]?a[0]:o;return(null==(t=i.palette)?void 0:t.mode)==="categorical"?function(e,t,l){if(void 0===e)return l;let n=e.length??1;return e[t%n]??l}(a,s,c):(l=r,n=c,function(e){var t;let l,n;return t=e.toLowerCase().includes("error"),(n=ec[l=`${e}_____${t}`])||(n=function(e,t){let[l,n,a]=t?eu.hsl(e):ed.hsl(e),i=`${(100*n).toFixed(0)}%`,o=`${(100*a).toFixed(0)}%`;return`hsla(${l.toFixed(2)},${i},${o},0.9)`}(e,t),ec[l]=n),n}(l)??n)}({categoricalPalette:v,visual:b,muiPrimaryColor:h.palette.primary.main,seriesName:x,seriesIndex:s,querySettings:l,queryHasMultipleResults:((null==(g=u[e])||null==(m=g.data)||null==(d=m.series)?void 0:d.length)??0)>1}),j=p+c.name+s,C=(null==y?void 0:y.values)?(0,ea.pG)(c.values,y.values):void 0,S="ALL"===A;if(!S&&A[j]||S){let e=a.length;o.push(function(e,t,l,n,a,i,o){let r=n.lineWidth??1.25,s=n.pointRadius??2.75,d=a.rangeMs<=9e5;return("always"===n.showPoints&&(d=!0),"bar"===n.display)?{type:"bar",id:e,datasetIndex:t,name:l,color:i,stack:"all"===n.stack?n.stack:void 0,label:{show:!1}}:{type:"line",id:e,datasetIndex:t,name:l,connectNulls:n.connectNulls??!1,color:i,stack:"all"===n.stack?n.stack:void 0,sampling:"lttb",progressiveThreshold:D.OPTIMIZED_MODE_SERIES_LIMIT,showSymbol:d,showAllSymbol:!0,symbolSize:s,lineStyle:{width:r,type:(null==o?void 0:o.lineStyle)??n.lineStyle},areaStyle:{opacity:(null==o?void 0:o.areaOpacity)??n.areaOpacity??0},emphasis:{focus:"series",disabled:void 0!==n.areaOpacity&&n.areaOpacity>0,lineStyle:{width:r+1,opacity:1,type:n.lineStyle}},selectedMode:"single",select:{itemStyle:{borderColor:i,borderWidth:s+.5}},blur:{lineStyle:{width:r,opacity:.5,type:n.lineStyle}}}}(j,e,x,b,t,f,l)),a.push({name:x,values:(0,ei.rT)(c,t)})}y&&n&&n.push({id:j,label:x,color:f,data:C}),s++}}if(l&&l.steps){let e=c.thresholds,n=l.defaultColor??e.defaultColor;l.steps.forEach((r,d)=>{var u,c,h,p,m;let v,g,x,y=e.palette[d]??n,f={color:r.color??y,value:"percent"===l.mode?(u=r.value,c=null==i?void 0:i.max,h=null==i?void 0:i.min,g=c??(v=0,(p=a).length&&void 0!==p[0]&&(null==(m=p[0])?void 0:m.values)?p.forEach(e=>{e.values.forEach(e=>{let[t,l]=e;"number"==typeof l&&l>v&&(v=l)})}):p.forEach(e=>{void 0!==e.data&&e.data.forEach(e=>{"number"==typeof e&&e>v&&(v=e)})}),v),u/100*(g-(x=h??0))+x):r.value},b=r.name??`Threshold ${d+1}`,j=[],C=t.startMs;for(;C<=t.endMs;)j.push([C,f.value]),C+=15e3;a.push({name:b,values:j}),o.push({type:"line",name:b,id:b,datasetId:b,datasetIndex:s,color:f.color,label:{show:!1},lineStyle:{type:"dashed",width:2},emphasis:{focus:"series",lineStyle:{width:2.5}},blur:{lineStyle:{opacity:.5}}}),s++})}return{timeScale:t,timeChartData:a,timeSeriesMapping:o,legendItems:n}},[u,l,A,y,b,r,null==i?void 0:i.max,null==i?void 0:i.min,v,p,c.thresholds,h.palette.primary.main]),R=(0,Q.useMemo)(()=>(null==y?void 0:y.values)?I.legendValues.reduce((e,t)=>{var l;let n=I.LEGEND_VALUE_CONFIG[t];return n&&(null==y||null==(l=y.values)?void 0:l.includes(t))&&e.push({accessorKey:`data.${t}`,header:n.label,headerDescription:n.description,width:72,align:"right",cell:e=>{let{getValue:t}=e,l=t();return"number"==typeof l&&f?(0,eo.Fl)(l,f):l},cellDescription:!0,enableSorting:!0}),e},[]):[],[null==y?void 0:y.values,f]);if(void 0===x)return null;let N=i&&i.label?30:20,$={left:C.show?N:0,right:20,bottom:0},P=e=>{O({start:new Date(e.start),end:new Date(e.end)})},V="bar"===b.display&&"all"===b.stack,F=!0;V?F=!1:(null==o?void 0:o.enablePinning)!==void 0&&(F=o.enablePinning);let G={...D.DEFAULT_TOOLTIP_CONFIG,enablePinning:F};return(0,T.jsx)(z.A,{sx:{padding:`${g}px`},children:(0,T.jsx)(D.ContentWithLegend,{width:x.width,height:x.height,minChildrenHeight:50,legendSize:null==y?void 0:y.size,legendProps:y&&{options:y,data:_||[],selectedItems:A,onSelectedItemsChange:S,tableProps:{columns:R,sorting:M,onSortingChange:w},onItemMouseOver:(e,t)=>{var l;let{id:n}=t;null==(l=m.current)||l.highlightSeries({name:n})},onItemMouseOut:()=>{var e;null==(e=m.current)||e.clearHighlightedSeries()}},children:e=>{let{height:t,width:l}=e;return(0,T.jsxs)(z.A,{style:{height:t,width:l},children:[i&&i.show&&i.label&&(0,T.jsx)(D.YAxisLabel,{name:i.label,height:t}),(0,T.jsx)(eE,{ref:m,height:t,data:L,seriesMapping:k,timeScale:E,yAxis:C,format:f,grid:$,isStackedBar:V,tooltipConfig:G,syncGroup:"default-panel-group",onDataZoom:P,noDataVariant:!L.length&&_&&_.length>0?"chart":"message"})]})}})})},supportedQueryTypes:["TimeSeriesQuery"],panelOptionsEditorComponents:[{label:"General Settings",content:function(e){let{onChange:t,value:l}=e;return(0,T.jsxs)(D.OptionsEditorGrid,{children:[(0,T.jsxs)(D.OptionsEditorColumn,{children:[(0,T.jsx)(I.LegendOptionsEditor,{calculation:"aggregation",value:l.legend,onChange:e=>{t((0,k.jM)(l,t=>{t.legend=e}))}}),(0,T.jsx)(P,{value:l.visual??d,onChange:e=>{t((0,k.jM)(l,t=>{t.visual=e}))}})]}),(0,T.jsx)(D.OptionsEditorColumn,{children:(0,T.jsx)(F,{value:l.yAxis??a,onChange:e=>{t((0,k.jM)(l,t=>{t.yAxis=e}))}})}),(0,T.jsxs)(D.OptionsEditorColumn,{children:[(0,T.jsx)(D.ThresholdsEditor,{hideDefault:!0,thresholds:l.thresholds,onChange:e=>{t((0,k.jM)(l,t=>{t.thresholds=e}))}}),(0,T.jsx)(D.OptionsEditorGroup,{title:"Reset Settings",children:(0,T.jsx)(L.A,{variant:"outlined",color:"secondary",onClick:()=>{t((0,k.jM)(l,e=>{e.yAxis=void 0,e.legend=void 0,e.visual=void 0,e.thresholds=void 0}))},children:"Reset To Defaults"})})]})]})}},{label:"Query Settings",content:function(e){let{onChange:t,value:l}=e,n=l.querySettings,a=e=>{t((0,k.jM)(l,t=>{t.querySettings=e}))},i=(0,Q.useRef)(null),o=(0,Q.useRef)(!1);(0,Q.useEffect)(()=>{var e;i.current&&o.current&&(null==(e=i.current)||e.focus(),o.current=!1)},[null==n?void 0:n.length]);let r=(e,t)=>{void 0!==n&&a((0,k.jM)(n,l=>{let n=l[e];n&&t(n)}))},s=(0,I.useQueryCountContext)(),d=(0,Q.useMemo)(()=>{let e=(null==n?void 0:n.map(e=>e.queryIndex))??[];return Array.from({length:s},(e,t)=>t).filter((t,l)=>!e.includes(l))},[n,s]),u=(0,Q.useMemo)(()=>d[0]??-1,[d]),c={queryIndex:u};return(0,T.jsxs)(G.A,{children:[0===s?(0,T.jsx)(q.A,{mb:2,fontStyle:"italic",children:"No query defined"}):(null==n?void 0:n.length)&&n.map((e,t)=>(0,T.jsx)(J,{inputRef:t===n.length-1?i:void 0,querySettings:e,availableQueryIndexes:d,onQueryIndexChange:e=>{void 0!==n&&a((0,k.jM)(n,l=>{let n=null==l?void 0:l[t];n&&(n.queryIndex=parseInt(e.target.value))}))},onColorModeChange:e=>{void 0!==n&&a((0,k.jM)(n,l=>{if(void 0!==l){let n=l[t];if(n){let t=e.target.value;t?n.colorMode=t:(n.colorMode=void 0,n.colorValue=void 0)}}}))},onColorValueChange:e=>{void 0!==n&&a((0,k.jM)(n,l=>{if(void 0!==l){let n=l[t];n&&(n.colorValue=e)}}))},onLineStyleChange:e=>{void 0!==n&&a((0,k.jM)(n,l=>{if(void 0!==l){let n=l[t];n&&(n.lineStyle=e)}}))},onAreaOpacityChange:(e,l)=>{let i;return i=Array.isArray(l)?l[0]:l,void(void 0!==n&&a((0,k.jM)(n,e=>{if(void 0!==e){let l=e[t];l&&(l.areaOpacity=i)}})))},onDelete:()=>{void 0!==n&&a((0,k.jM)(n,e=>{e.splice(t,1)}))},onAddColor:()=>{r(t,e=>{e.colorMode="fixed-single",e.colorValue=K})},onRemoveColor:()=>{r(t,e=>{e.colorMode=void 0,e.colorValue=void 0})},onAddLineStyle:()=>{r(t,e=>{e.lineStyle="solid"})},onRemoveLineStyle:()=>{r(t,e=>{e.lineStyle=void 0})},onAddAreaOpacity:()=>{r(t,e=>{e.areaOpacity=0})},onRemoveAreaOpacity:()=>{r(t,e=>{e.areaOpacity=void 0})}},t)),s>0&&-1!==u&&(0,T.jsx)(L.A,{variant:"contained",startIcon:(0,T.jsx)(Z.default,{}),sx:{marginTop:1},onClick:()=>{o.current=!0,void 0===n?a([c]):a((0,k.jM)(n,e=>{e.push(c)}))},children:"Add Query Settings"})]})}}],createInitialOptions:function(){return{}},actions:[{component:e=>{let{queryResults:t,definition:l}=e,n=(0,Q.useMemo)(()=>(e=>{let t,l,n;if(!e||0===e.length)return;let a=[];if(e.forEach(e=>{if((null==e?void 0:e.data)&&"object"==typeof e.data&&"series"in e.data){let i=e.data;i.series&&Array.isArray(i.series)&&i.series.length>0&&(a.push(...i.series),!t&&i.timeRange&&(t=i.timeRange),!l&&i.stepMs&&(l=i.stepMs),!n&&i.metadata&&(n=i.metadata))}}),a.length>0)return{series:a,timeRange:t,stepMs:l,metadata:n}})(t),[t]),a=(0,Q.useMemo)(()=>ek(n),[n]),i=(0,Q.useCallback)(()=>{if(n&&a)try{var e,t;let a=(null==l||null==(t=l.spec)||null==(e=t.display)?void 0:e.name)||"Time Series Data",i=(e=>{let{data:t}=e;if(!ek(t))return console.warn("No valid data found to export to CSV."),new Blob([""],{type:"text/csv;charset=utf-8"});let l="",n={},a=[],i=0;for(let e=0;e<t.series.length;e++){let l=t.series[e];if(!l||!Array.isArray(l.values)||0===l.values.length)continue;let o=eD(l,e),r=eI(o),s={legendName:o,columnName:r||`Series_${e+1}`,originalName:l.name||""};a.push(s),i++;for(let e=0;e<l.values.length;e++){let t,a,i=l.values[e];if(Array.isArray(i)&&i.length>=2)t=i[0],a=i[1];else{if("object"!=typeof i||null===i||!("timestamp"in i)||!("value"in i))continue;t=i.timestamp,a=i.value}if(null==a)continue;let o=e_(t);n[o]||(n[o]={}),n[o][s.columnName]=a}}if(0===i||0===a.length)return console.warn("No valid data found to export to CSV."),new Blob([""],{type:"text/csv;charset=utf-8"});if(0===Object.keys(n).length)return console.warn("No valid timestamp data found to export to CSV."),new Blob([""],{type:"text/csv;charset=utf-8"});let o=a.map(e=>e.columnName);for(let e of(l+=`DateTime,${o.join(",")}
`,Object.keys(n).sort((e,t)=>new Date(e).getTime()-new Date(t).getTime()))){let t=n[e],a=[];if(t){for(let e of o){let l=t[e];a.push(eR(l))}l+=`${eR(e)},${a.join(",")}
`}}return new Blob([l],{type:"text/csv;charset=utf-8"})})({data:n}),o=a.replace(/[<>:"/\\|?*]/g," ").trim().split(/\s+/).filter(e=>e.length>0).map((e,t)=>0===t?e.toLowerCase():e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(""),r=`${o}_data.csv`,s=document.createElement("a");s.href=URL.createObjectURL(i),s.download=r,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(s.href)}catch(e){console.error("Time series export failed:",e)}},[n,a,l]);return a?(0,T.jsx)(eT.A,{title:"Export as CSV",children:(0,T.jsx)(U.A,{size:"small",onClick:i,"aria-label":"Export time series data as CSV",children:(0,T.jsx)(eL.default,{fontSize:"inherit"})})}):null},location:"header"}]}}}]);