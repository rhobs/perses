"use strict";(self.chunk_StatChart=self.chunk_StatChart||[]).push([["903"],{82372:function(e,t,l){let n;l.r(t),l.d(t,{StatChart:()=>V});let o=[{id:"none",label:"None"},{id:"value",label:"Text"},{id:"background_solid",label:"Background"}],i=[{id:"auto",label:"Auto",description:"Show legend for multi-series, hide legend for single series"},{id:"on",label:"On",description:"Always show legend"},{id:"off",label:"Off",description:"Always hide legend"}];var a=l(62540),r=l(37266),s=l(68003),d=l(57744),u=l(38662),h=l(25632),c=l.n(h),p=l(70451);let f={unit:"percent-decimal"};var g=l(315),m=l(88091),x=l(64886),v=l(21047),b=l(87680);let C=(e,t)=>(void 0===b.Lu[e]&&console.warn(`Invalid StatChart panel calculation ${e}, fallback to last`),(b.Lu[e]??b.Lu.last)(t.values));var S=l(56599),j=l(74628),w=l(77308),y=l(74653),M=l(62707),k=l(59738),A=l(90652),O=l(72106),F=l(55875),z=l(37573),E=l(2849);function $(e){let{text:t,fontWeight:l,width:o,height:i,lineHeight:a,maxSize:s,fontSizeOverride:d}=e,u=function(){if(!n&&null===(n=document.createElement("canvas").getContext("2d")))throw Error("Canvas context is null.");return n}(),{echartsTheme:h}=(0,r.useChartsTheme)();if(void 0!==d)return Number(d);let c=h.textStyle,p=Number(null==c?void 0:c.fontSize)??12,f=(null==c?void 0:c.fontFamily)??"Lato";u.font=`${l} ${p}px ${f}`;let g=Math.min(i/a,o/u.measureText(t).width*p);return s?Math.min(g,s):g}var D=l(12826);(0,y.Y)([M.a,k.a,A.a,O.a,F.a,z.a]);let L="#FFFFFF",T="#000000",_=e=>{var t,l,n,o;let{width:i,height:s,data:d,data:{color:u},sparkline:h,showSeriesName:f,format:g,valueFontSize:m,colorMode:x}=e,{palette:{mode:v,text:{secondary:b}}}=(0,S.A)(),C=(0,r.useChartsTheme)(),w=(n=d.calculatedValue,o=g,null===n?"null":"number"==typeof n?(0,D.Fl)(n,o):void 0===n?"":n),y=C.container.padding.default,M=$({text:(null==d||null==(t=d.seriesData)?void 0:t.name)??"",fontWeight:400,width:i,height:.125*s,lineHeight:1.2,maxSize:30}),k=f?1.2*M+y:0,A=i-2*y,O=s-k,F=$({text:w,fontSizeOverride:m,fontWeight:700,width:h?A:.5*A,height:h?.25*O:.9*O,lineHeight:1.2}),z=1.2*F;M=Math.min(.7*F,M);let _=(0,p.useMemo)(()=>{if(!d.seriesData)return C.noDataOption;let e=d.seriesData,t=[];if(h){let l={type:"line",name:e.name,data:e.values,zlevel:1,symbol:"none",animation:!1,silent:!0},n={...h};"background_solid"===x&&(n.areaStyle={color:L,opacity:.4},n.lineStyle={color:L,opacity:1});let o=c()(l,n);t.push(o)}return{title:{show:!1},grid:{show:!1,top:"35%",right:0,bottom:0,left:0,containLabel:!1},xAxis:{type:"time",show:!1,boundaryGap:!1},yAxis:{type:"value",show:!1,min:e=>e.min>=0&&e.min<=1?0:e.min},tooltip:{show:!1},series:t}},[d,C,h,x]),G=h?"auto":"center",P=(0,p.useMemo)(()=>{let e="";switch(x){case"background_solid":e=E.Ay.contrast(u,L)>E.Ay.contrast(u,T)?L:T;break;case"none":e="dark"===v?L:T;break;default:e=u}return(0,a.jsx)(I,{variant:"h3",color:e,fontSize:F,padding:y,children:w})},[x,y,F,w,u,v]),V=(0,p.useMemo)(()=>{var e;if(!f)return null;let t="";return t="background_solid"===x?E.Ay.contrast(u,L)>E.Ay.contrast(u,T)?L:T:b,(0,a.jsx)(N,{padding:y,fontSize:M,color:t,children:null==(e=d.seriesData)?void 0:e.name})},[x,f,b,u,y,M,null==d||null==(l=d.seriesData)?void 0:l.name]);return(0,a.jsxs)(j.A,{sx:{height:"100%",width:"100%",backgroundColor:"background_solid"===x?u:"transparent",display:"flex",flexDirection:"column",justifyContent:G,alignItems:G},children:[V,P,h&&(0,a.jsx)(r.EChart,{sx:{width:"100%"},style:{height:Math.floor(s-k-z)},option:_,theme:C.echartsTheme,renderer:"svg"})]})},N=(0,w.A)(m.A,{shouldForwardProp:e=>"padding"!==e&&"fontSize"!==e})(e=>{let{padding:t,fontSize:l,color:n}=e;return{color:n,padding:`${t}px`,fontSize:`${l}px`,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}),I=(0,w.A)(m.A,{shouldForwardProp:e=>"color"!==e&&"padding"!==e&&"fontSize"!==e&&"sparkline"!==e})(e=>{let{theme:t,color:l,padding:n,fontSize:o,sparkline:i}=e;return{color:l??t.palette.text.primary,fontSize:`${o}px`,padding:i?`${n}px ${n}px 0 ${n}px`:` 0 ${n}px`,whiteSpace:"nowrap",lineHeight:1.2}}),G=(e,t,l)=>l||((null==t?void 0:t.length)&&null!=e?(0,x.u)(e,t).value:e),P=(e,t)=>{if(t&&e){for(let[l,n]of Object.entries(t))if((0,v.f)(e).test(l))return n}},V={PanelComponent:e=>{let t,l,n,{spec:o,contentDimensions:i,queryResults:s}=e,{format:d,sparkline:u,valueFontSize:h,colorMode:c}=o,f=(0,r.useChartsTheme)(),v=(t=s,l=o,n=f,(0,p.useMemo)(()=>{let{calculation:e,mappings:o,metricLabel:i}=l,a=[];for(let r of t)for(let t of r.data.series){let r=C(e,t),s=G(r,o,P(i,t.labels)),d=function(e,t,l){let{mappings:n,thresholds:o}=t??{},i=(null==o?void 0:o.defaultColor)??e.thresholds.defaultColor;if(null==l||""===l||!(null==o?void 0:o.steps)&&!n)return i;if(null==n?void 0:n.length){let e=function(e,t){if((null==t?void 0:t.length)&&null!=e){let{color:l}=(0,x.u)(e,t);return l||null}return null}(l,n);if(e)return e}if(o){let t=function(e,t,l,n){if((null==t?void 0:t.steps)&&"number"==typeof e){let o=t.steps.map((t,o)=>e>=t.value?t.color??l.thresholds.palette[o]??n:null).filter(e=>null!==e);return o[o.length-1]??null}return null}(l,o,e,i);if(t)return t}return i}(n,l,r),u={name:t.formattedName??"",values:t.values};a.push({calculatedValue:s,seriesData:u,color:d})}return a},[t,l,n])),b=v.length>1,S="on"===o.legendMode||"off"!==o.legendMode&&b;if(!i)return null;let j=2*(v.length-1),w=(i.width-j)/v.length;b&&w<100&&(w=100);let y=f.noDataOption.title.textStyle;return(0,a.jsx)(g.A,{height:i.height,width:i.width,spacing:"2px",direction:"row",justifyContent:b?"left":"center",alignItems:"center",sx:{overflowX:b?"scroll":"auto"},children:v.length?v.map((e,t)=>{let l=function(e,t,l){if(void 0!==l)return{lineStyle:{width:l.width??e.sparkline.width,color:t,opacity:1},areaStyle:{color:t,opacity:.4}}}(f,e.color,u);return(0,a.jsx)(_,{width:w,height:i.height,data:e,format:d,sparkline:l,showSeriesName:S,valueFontSize:h,colorMode:c},t)}):(0,a.jsx)(m.A,{sx:{...y},children:"No data"})})},supportedQueryTypes:["TimeSeriesQuery"],panelOptionsEditorComponents:[{label:"Settings",content:function(e){let{onChange:t,value:l}=e,n=c()({},f,l.format),h=(0,p.useCallback)((e,n)=>{t((0,u.jM)(l,e=>{e.legendMode=n.id}))},[t,l]),g=(0,p.useCallback)((e,n)=>{t((0,u.jM)(l,e=>{e.colorMode=n.id}))},[t,l]),m=(0,p.useMemo)(()=>(0,a.jsx)(r.OptionsEditorControl,{label:"Show",control:(0,a.jsx)(r.SettingsAutocomplete,{onChange:h,options:i,disableClearable:!0,value:i.find(e=>e.id===l.legendMode)??i.find(e=>"auto"===e.id)})}),[l.legendMode,h]),x=(0,p.useMemo)(()=>(0,a.jsx)(r.OptionsEditorControl,{label:"Color mode",control:(0,a.jsx)(r.SettingsAutocomplete,{onChange:g,options:o.map(e=>{let{id:t,label:l}=e;return{id:t,label:l}}),disableClearable:!0,value:o.find(e=>e.id===l.colorMode)??o.find(e=>"value"===e.id)})}),[l.colorMode,g]);return(0,a.jsxs)(r.OptionsEditorGrid,{children:[(0,a.jsxs)(r.OptionsEditorColumn,{children:[(0,a.jsx)(r.OptionsEditorGroup,{title:"Legend",children:m}),(0,a.jsxs)(r.OptionsEditorGroup,{title:"Misc",children:[(0,a.jsx)(r.OptionsEditorControl,{label:"Sparkline",control:(0,a.jsx)(s.A,{checked:!!l.sparkline,onChange:(e,n)=>{t((0,u.jM)(l,e=>{e.sparkline=n?{}:void 0}))}})}),(0,a.jsx)(r.FormatControls,{value:n,onChange:e=>{t((0,u.jM)(l,t=>{t.format=e}))}}),(0,a.jsx)(d.CalculationSelector,{value:l.calculation,onChange:e=>{t((0,u.jM)(l,t=>{t.calculation=e}))}}),(0,a.jsx)(d.MetricLabelInput,{value:l.metricLabel,onChange:e=>{t((0,u.jM)(l,t=>{t.metricLabel=e}))}}),(0,a.jsx)(r.FontSizeSelector,{value:l.valueFontSize,onChange:e=>{t((0,u.jM)(l,t=>{t.valueFontSize=e}))}}),x]})]}),(0,a.jsx)(r.OptionsEditorColumn,{children:(0,a.jsx)(r.ThresholdsEditor,{disablePercentMode:!0,thresholds:l.thresholds,onChange:e=>{t((0,u.jM)(l,t=>{t.thresholds=e}))}})})]})}},{label:"Value mapping",content:e=>{let{onChange:t,value:l}=e;return(0,a.jsx)(r.ValueMappingsEditor,{mappings:l.mappings??[],onChange:function(e){t({...l,mappings:e})}})}}],createInitialOptions:function(){return{calculation:"last-number",format:{unit:"decimal"},sparkline:{},legendMode:"auto"}}}}}]);