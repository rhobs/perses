{"version":3,"sources":["../../src/StatChartOptionsEditorSettings.tsx"],"sourcesContent":["// Copyright 2023 The Perses Authors\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Switch, SwitchProps } from '@mui/material';\nimport {\n  FontSizeOption,\n  FontSizeSelector,\n  FontSizeSelectorProps,\n  FormatControls,\n  FormatControlsProps,\n  OptionsEditorColumn,\n  OptionsEditorControl,\n  OptionsEditorGrid,\n  OptionsEditorGroup,\n  SettingsAutocomplete,\n  ThresholdsEditor,\n  ThresholdsEditorProps,\n} from '@perses-dev/components';\nimport { FormatOptions } from '@perses-dev/core';\nimport {\n  CalculationSelector,\n  CalculationSelectorProps,\n  MetricLabelInput,\n  MetricLabelInputProps,\n} from '@perses-dev/plugin-system';\nimport { produce } from 'immer';\nimport merge from 'lodash/merge';\nimport { ReactElement, useCallback, useMemo } from 'react';\nimport {\n  COLOR_MODE_LABELS,\n  ColorModeLabelItem,\n  SHOW_LEGEND_LABELS,\n  ShowLegendLabelItem,\n  StatChartOptions,\n  StatChartOptionsEditorProps,\n} from './stat-chart-model';\n\nconst DEFAULT_FORMAT: FormatOptions = { unit: 'percent-decimal' };\n\nexport function StatChartOptionsEditorSettings(props: StatChartOptionsEditorProps): ReactElement {\n  const { onChange, value } = props;\n\n  // ensures decimalPlaces defaults to correct value\n  const format = merge({}, DEFAULT_FORMAT, value.format);\n\n  const handleCalculationChange: CalculationSelectorProps['onChange'] = (metricLabel) => {\n    onChange(\n      produce(value, (draft: StatChartOptions) => {\n        draft.calculation = metricLabel;\n      })\n    );\n  };\n\n  const handleMetricLabelChange: MetricLabelInputProps['onChange'] = (newCalculation) => {\n    onChange(\n      produce(value, (draft: StatChartOptions) => {\n        draft.metricLabel = newCalculation;\n      })\n    );\n  };\n\n  const handleShowLegendChange = useCallback(\n    (_: unknown, newShowLegend: ShowLegendLabelItem): void => {\n      onChange(\n        produce(value, (draft: StatChartOptions) => {\n          draft.legendMode = newShowLegend.id;\n        })\n      );\n    },\n    [onChange, value]\n  );\n\n  const handleUnitChange: FormatControlsProps['onChange'] = (newFormat) => {\n    onChange(\n      produce(value, (draft: StatChartOptions) => {\n        draft.format = newFormat;\n      })\n    );\n  };\n\n  const handleSparklineChange: SwitchProps['onChange'] = (_: unknown, checked: boolean) => {\n    onChange(\n      produce(value, (draft: StatChartOptions) => {\n        // For now, setting to an empty object when checked, so the stat chart\n        // uses the default chart color and line styles. In the future, this\n        // will likely be configurable in the UI.\n        draft.sparkline = checked ? {} : undefined;\n      })\n    );\n  };\n\n  const handleThresholdsChange: ThresholdsEditorProps['onChange'] = (thresholds) => {\n    onChange(\n      produce(value, (draft: StatChartOptions) => {\n        draft.thresholds = thresholds;\n      })\n    );\n  };\n\n  const handleFontSizeChange: FontSizeSelectorProps['onChange'] = (fontSize: FontSizeOption) => {\n    onChange(\n      produce(value, (draft: StatChartOptions) => {\n        draft.valueFontSize = fontSize;\n      })\n    );\n  };\n\n  const handleColorModeChange = useCallback(\n    (_: unknown, newColorMode: ColorModeLabelItem): void => {\n      onChange(\n        produce(value, (draft: StatChartOptions) => {\n          draft.colorMode = newColorMode.id;\n        })\n      );\n    },\n    [onChange, value]\n  );\n\n  const selectShowLegend = useMemo((): ReactElement => {\n    return (\n      <OptionsEditorControl\n        label=\"Show\"\n        control={\n          <SettingsAutocomplete\n            onChange={handleShowLegendChange}\n            options={SHOW_LEGEND_LABELS}\n            disableClearable\n            value={\n              SHOW_LEGEND_LABELS.find((i) => i.id === value.legendMode) ??\n              SHOW_LEGEND_LABELS.find((i) => i.id === 'auto')!\n            }\n          />\n        }\n      />\n    );\n  }, [value.legendMode, handleShowLegendChange]);\n\n  const selectColorMode = useMemo((): ReactElement => {\n    return (\n      <OptionsEditorControl\n        label=\"Color mode\"\n        control={\n          <SettingsAutocomplete\n            onChange={handleColorModeChange}\n            options={COLOR_MODE_LABELS.map(({ id, label }) => ({ id, label }))}\n            disableClearable\n            value={\n              COLOR_MODE_LABELS.find((i) => i.id === value.colorMode) ??\n              COLOR_MODE_LABELS.find((i) => i.id === 'value')!\n            }\n          />\n        }\n      />\n    );\n  }, [value.colorMode, handleColorModeChange]);\n\n  return (\n    <OptionsEditorGrid>\n      <OptionsEditorColumn>\n        <OptionsEditorGroup title=\"Legend\">{selectShowLegend}</OptionsEditorGroup>\n        <OptionsEditorGroup title=\"Misc\">\n          <OptionsEditorControl\n            label=\"Sparkline\"\n            control={<Switch checked={!!value.sparkline} onChange={handleSparklineChange} />}\n          />\n          <FormatControls value={format} onChange={handleUnitChange} />\n          <CalculationSelector value={value.calculation} onChange={handleCalculationChange} />\n          <MetricLabelInput value={value.metricLabel} onChange={handleMetricLabelChange} />\n          <FontSizeSelector value={value.valueFontSize} onChange={handleFontSizeChange} />\n          {selectColorMode}\n        </OptionsEditorGroup>\n      </OptionsEditorColumn>\n      <OptionsEditorColumn>\n        <ThresholdsEditor disablePercentMode thresholds={value.thresholds} onChange={handleThresholdsChange} />\n      </OptionsEditorColumn>\n    </OptionsEditorGrid>\n  );\n}\n"],"names":["Switch","FontSizeSelector","FormatControls","OptionsEditorColumn","OptionsEditorControl","OptionsEditorGrid","OptionsEditorGroup","SettingsAutocomplete","ThresholdsEditor","CalculationSelector","MetricLabelInput","produce","merge","useCallback","useMemo","COLOR_MODE_LABELS","SHOW_LEGEND_LABELS","DEFAULT_FORMAT","unit","StatChartOptionsEditorSettings","props","onChange","value","format","handleCalculationChange","metricLabel","draft","calculation","handleMetricLabelChange","newCalculation","handleShowLegendChange","_","newShowLegend","legendMode","id","handleUnitChange","newFormat","handleSparklineChange","checked","sparkline","undefined","handleThresholdsChange","thresholds","handleFontSizeChange","fontSize","valueFontSize","handleColorModeChange","newColorMode","colorMode","selectShowLegend","label","control","options","disableClearable","find","i","selectColorMode","map","title","disablePercentMode"],"mappings":";AAAA,oCAAoC;AACpC,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,6CAA6C;AAC7C,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;AAEjC,SAASA,MAAM,QAAqB,gBAAgB;AACpD,SAEEC,gBAAgB,EAEhBC,cAAc,EAEdC,mBAAmB,EACnBC,oBAAoB,EACpBC,iBAAiB,EACjBC,kBAAkB,EAClBC,oBAAoB,EACpBC,gBAAgB,QAEX,yBAAyB;AAEhC,SACEC,mBAAmB,EAEnBC,gBAAgB,QAEX,4BAA4B;AACnC,SAASC,OAAO,QAAQ,QAAQ;AAChC,OAAOC,WAAW,eAAe;AACjC,SAAuBC,WAAW,EAAEC,OAAO,QAAQ,QAAQ;AAC3D,SACEC,iBAAiB,EAEjBC,kBAAkB,QAIb,qBAAqB;AAE5B,MAAMC,iBAAgC;IAAEC,MAAM;AAAkB;AAEhE,OAAO,SAASC,+BAA+BC,KAAkC;IAC/E,MAAM,EAAEC,QAAQ,EAAEC,KAAK,EAAE,GAAGF;IAE5B,kDAAkD;IAClD,MAAMG,SAASX,MAAM,CAAC,GAAGK,gBAAgBK,MAAMC,MAAM;IAErD,MAAMC,0BAAgE,CAACC;QACrEJ,SACEV,QAAQW,OAAO,CAACI;YACdA,MAAMC,WAAW,GAAGF;QACtB;IAEJ;IAEA,MAAMG,0BAA6D,CAACC;QAClER,SACEV,QAAQW,OAAO,CAACI;YACdA,MAAMD,WAAW,GAAGI;QACtB;IAEJ;IAEA,MAAMC,yBAAyBjB,YAC7B,CAACkB,GAAYC;QACXX,SACEV,QAAQW,OAAO,CAACI;YACdA,MAAMO,UAAU,GAAGD,cAAcE,EAAE;QACrC;IAEJ,GACA;QAACb;QAAUC;KAAM;IAGnB,MAAMa,mBAAoD,CAACC;QACzDf,SACEV,QAAQW,OAAO,CAACI;YACdA,MAAMH,MAAM,GAAGa;QACjB;IAEJ;IAEA,MAAMC,wBAAiD,CAACN,GAAYO;QAClEjB,SACEV,QAAQW,OAAO,CAACI;YACd,sEAAsE;YACtE,oEAAoE;YACpE,yCAAyC;YACzCA,MAAMa,SAAS,GAAGD,UAAU,CAAC,IAAIE;QACnC;IAEJ;IAEA,MAAMC,yBAA4D,CAACC;QACjErB,SACEV,QAAQW,OAAO,CAACI;YACdA,MAAMgB,UAAU,GAAGA;QACrB;IAEJ;IAEA,MAAMC,uBAA0D,CAACC;QAC/DvB,SACEV,QAAQW,OAAO,CAACI;YACdA,MAAMmB,aAAa,GAAGD;QACxB;IAEJ;IAEA,MAAME,wBAAwBjC,YAC5B,CAACkB,GAAYgB;QACX1B,SACEV,QAAQW,OAAO,CAACI;YACdA,MAAMsB,SAAS,GAAGD,aAAab,EAAE;QACnC;IAEJ,GACA;QAACb;QAAUC;KAAM;IAGnB,MAAM2B,mBAAmBnC,QAAQ;QAC/B,qBACE,KAACV;YACC8C,OAAM;YACNC,uBACE,KAAC5C;gBACCc,UAAUS;gBACVsB,SAASpC;gBACTqC,gBAAgB;gBAChB/B,OACEN,mBAAmBsC,IAAI,CAAC,CAACC,IAAMA,EAAErB,EAAE,KAAKZ,MAAMW,UAAU,KACxDjB,mBAAmBsC,IAAI,CAAC,CAACC,IAAMA,EAAErB,EAAE,KAAK;;;IAMpD,GAAG;QAACZ,MAAMW,UAAU;QAAEH;KAAuB;IAE7C,MAAM0B,kBAAkB1C,QAAQ;QAC9B,qBACE,KAACV;YACC8C,OAAM;YACNC,uBACE,KAAC5C;gBACCc,UAAUyB;gBACVM,SAASrC,kBAAkB0C,GAAG,CAAC,CAAC,EAAEvB,EAAE,EAAEgB,KAAK,EAAE,GAAM,CAAA;wBAAEhB;wBAAIgB;oBAAM,CAAA;gBAC/DG,gBAAgB;gBAChB/B,OACEP,kBAAkBuC,IAAI,CAAC,CAACC,IAAMA,EAAErB,EAAE,KAAKZ,MAAM0B,SAAS,KACtDjC,kBAAkBuC,IAAI,CAAC,CAACC,IAAMA,EAAErB,EAAE,KAAK;;;IAMnD,GAAG;QAACZ,MAAM0B,SAAS;QAAEF;KAAsB;IAE3C,qBACE,MAACzC;;0BACC,MAACF;;kCACC,KAACG;wBAAmBoD,OAAM;kCAAUT;;kCACpC,MAAC3C;wBAAmBoD,OAAM;;0CACxB,KAACtD;gCACC8C,OAAM;gCACNC,uBAAS,KAACnD;oCAAOsC,SAAS,CAAC,CAAChB,MAAMiB,SAAS;oCAAElB,UAAUgB;;;0CAEzD,KAACnC;gCAAeoB,OAAOC;gCAAQF,UAAUc;;0CACzC,KAAC1B;gCAAoBa,OAAOA,MAAMK,WAAW;gCAAEN,UAAUG;;0CACzD,KAACd;gCAAiBY,OAAOA,MAAMG,WAAW;gCAAEJ,UAAUO;;0CACtD,KAAC3B;gCAAiBqB,OAAOA,MAAMuB,aAAa;gCAAExB,UAAUsB;;4BACvDa;;;;;0BAGL,KAACrD;0BACC,cAAA,KAACK;oBAAiBmD,kBAAkB;oBAACjB,YAAYpB,MAAMoB,UAAU;oBAAErB,UAAUoB;;;;;AAIrF"}