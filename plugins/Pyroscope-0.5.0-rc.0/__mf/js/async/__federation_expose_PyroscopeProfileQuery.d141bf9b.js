/*! For license information please see __federation_expose_PyroscopeProfileQuery.d141bf9b.js.LICENSE.txt */
"use strict";(self.chunk_Pyroscope=self.chunk_Pyroscope||[]).push([["9786"],{2192:function(e,a,t){var l=t(70451),r=Symbol.for("react.element"),n=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function u(e,a,t){var l,n={},u=null,d=null;for(l in void 0!==t&&(u=""+t),void 0!==a.key&&(u=""+a.key),void 0!==a.ref&&(d=a.ref),a)o.call(a,l)&&!i.hasOwnProperty(l)&&(n[l]=a[l]);if(e&&e.defaultProps)for(l in a=e.defaultProps)void 0===n[l]&&(n[l]=a[l]);return{$$typeof:r,type:e,key:u,ref:d,props:n,_owner:s.current}}a.Fragment=n,a.jsx=u,a.jsxs=u},62540:function(e,a,t){e.exports=t(2192)},82377:function(e,a,t){t.r(a),t.d(a,{PyroscopeProfileQuery:()=>L});var l=t(94461);let r="PyroscopeDatasource",n={kind:r},o=async(e,a)=>{let t=await a.datasourceStore.getDatasourceClient(e.datasource??{kind:r});return function(e){var a;let t={profile:{stackTrace:{}},numTicks:0,maxSelf:0,metadata:{spyName:"",sampleRate:0,units:"",name:""},timeline:{startTime:0,samples:[],durationDelta:0}};if(!e)return t;let l=[],r=1;for(let a=0;a<e.flamebearer.levels.length;a++){let t=0,n=[],o=e.flamebearer.levels[a];if(o){for(let l=0;l<o.length;l+=4){let s={};s.id=r,r+=1;let i=o[l+3];if(void 0!==i){let a=e.flamebearer.names[i];a&&(s.name=a)}s.level=a;let u=o[l+1];void 0!==u&&(s.total=u);let d=o[l+2];void 0!==d&&(s.self=d);let c=o[l];void 0!==c&&(t+=c),s.start=t,void 0!==u&&(t+=u),s.end=t,s.children=[],n.push(s)}l.push(n)}}return function(e){for(let a=1;a<e.length;a++){let t=e[a],l=e[a-1];if(t&&l)for(let e=0;e<t.length;e++){let a=t[e];if(a)for(let e=0;e<l.length;e++){let t=l[e];if(t&&a.start>=t.start&&a.end<=t.end){t.children.push(a);break}}}}}(l),(null==(a=l[0])?void 0:a[0])&&(t.profile.stackTrace=l[0][0]),t.numTicks=e.flamebearer.numTicks,t.maxSelf=e.flamebearer.maxSelf,t.metadata={spyName:e.metadata.spyName,sampleRate:e.metadata.sampleRate,units:e.metadata.units,name:e.metadata.name},t.timeline={startTime:e.timeline.startTime,samples:e.timeline.samples,durationDelta:e.timeline.durationDelta},t}(await t.searchProfiles((()=>{let t={query:(()=>{let a="";if(e.service&&(a=`service_name="${e.service}"`),e.filters&&e.filters.length>0){var t;let l=(t=e.filters,`${t.filter(e=>""!==e.labelName&&""!==e.labelValue).map(e=>`${e.labelName}${e.operator}"${e.labelValue}"`).join(",")}`);""===a?a=l:a+=","+l}return e.profileType+(""===a?"":"{"+a+"}")})(),from:"now-1h"};if(a.absoluteTimeRange){let{start:e,end:r}=function(e){let{start:a,end:t}=e;return{start:Math.ceil((0,l.getUnixTime)(a)),end:Math.ceil((0,l.getUnixTime)(t))}}(a.absoluteTimeRange);t.from=e,t.until=r}return e.maxNodes&&(t.maxNodes=e.maxNodes),t})()))};var s=t(62540),i=t(57744),u=t(37266),d=t(38662),c=t(315),p=t(67987),m=t(54227),f=t(56599),h=t(93648),x=t(25742),b=t(97653),v=t(91807);function y(e){let{datasource:a,value:t,onChange:l}=e,{data:r,isLoading:n}=function(e){let{data:a}=(0,i.useDatasourceClient)(e);return(0,v.useQuery)({enabled:!!a,queryKey:["searchProfileTypes","datasource",e],queryFn:async()=>await a.searchProfileTypes({},{"content-type":"application/json"},{})})}(a);return(0,s.jsx)(c.A,{position:"relative",sx:{width:"100%"},children:(0,s.jsx)(h.A,{select:!0,label:"Profile Type",value:t,size:"small",onChange:e=>null==l?void 0:l(e.target.value),children:n?(0,s.jsx)(c.A,{width:"100%",sx:{alignItems:"center",justifyContent:"center"},children:(0,s.jsx)(x.A,{color:"inherit",size:20})}):(null==r?void 0:r.profileTypes)&&(null==r?void 0:r.profileTypes.map(e=>(0,s.jsx)(b.A,{value:e.ID,children:e.name+"/"+e.sampleType},e.ID)))})})}var g=t(5611);function j(e){let{datasource:a,value:t,onChange:l}=e,{data:r,isLoading:n}=function(e){let{data:a}=(0,i.useDatasourceClient)(e);return(0,v.useQuery)({enabled:!!a,queryKey:["searchServices","datasource",e],queryFn:async()=>await a.searchServices({},{"content-type":"application/json"})})}(a);return(0,s.jsx)(c.A,{position:"relative",sx:{width:"100%"},children:(0,s.jsx)(g.A,{options:(null==r?void 0:r.names)??[],value:t,sx:{minWidth:200},loading:n,renderInput:e=>(0,s.jsx)(h.A,{...e,label:"Service",size:"small"}),onChange:function(e,a){null!==a&&(null==l||l(a))}})})}var w=t(54381),T=t(70451);function N(e){let{datasource:a,value:t,onChange:l}=e,{data:r,isLoading:n}=function(e){let{data:a}=(0,i.useDatasourceClient)(e);return(0,v.useQuery)({enabled:!!a,queryKey:["searchLabelNames","datasource",e],queryFn:async()=>await a.searchLabelNames({},{"content-type":"application/json"},{})})}(a),o=(0,T.useMemo)(()=>{var e;let a;return e=(null==r?void 0:r.names)??[],a=/^__.*__$/,e.filter(e=>!a.test(e)&&"service_name"!==e)},[r]);return(0,s.jsx)(g.A,{disableClearable:!0,options:o,value:t,sx:e=>({width:"100%","& .MuiOutlinedInput-root":{borderTopRightRadius:0,borderBottomRightRadius:0,[e.breakpoints.down("sm")]:{borderBottomLeftRadius:0}}}),loading:n,renderInput:e=>(0,s.jsx)(h.A,{...e,placeholder:"Select label name",size:"small"}),onChange:(e,a)=>{null!==a&&(null==l||l(a))}})}var C=t(76795);function k(e){let{value:a,onChange:t}=e;return(0,s.jsx)(C.A,{sx:e=>({borderRadius:0,width:"100%",[e.breakpoints.down("sm")]:{borderTopRightRadius:4}}),value:a,size:"small",onChange:e=>null==t?void 0:t(e.target.value),children:["=","!=","=~","!~"].map(e=>(0,s.jsx)(b.A,{value:e,children:e},e))})}function A(e){let{datasource:a,value:t,labelName:l,onChange:r}=e,{data:n,isLoading:o}=function(e,a){let{data:t}=(0,i.useDatasourceClient)(e);return(0,v.useQuery)({enabled:!!t,queryKey:["searchLabelValues",a,"datasource",e],queryFn:async()=>await t.searchLabelValues({},{"content-type":"application/json"},{name:a})})}(a,l);return(0,s.jsx)(g.A,{freeSolo:!0,disableClearable:!0,options:(null==n?void 0:n.names)??[],value:t,sx:e=>({width:"100%","& .MuiOutlinedInput-root":{borderRadius:0,width:"100%",[e.breakpoints.down("sm")]:{borderBottomLeftRadius:4}}}),loading:o,renderInput:e=>(0,s.jsx)(h.A,{...e,placeholder:"Select label value",size:"small"}),onChange:(e,a)=>{null!==a&&(null==r||r(a))}})}var R=t(7800);function S(e){let{onClick:a}=e;return(0,s.jsx)(u.ToolbarIconButton,{sx:e=>({borderTopLeftRadius:0,borderBottomLeftRadius:0,width:"100%",height:"100%",[e.breakpoints.down("sm")]:{borderTopRightRadius:0}}),"aria-label":"delete filter",onClick:a,children:(0,s.jsx)(R.default,{})})}function _(e){let{datasource:a,value:t,onChange:l,deleteItem:r}=e;return(0,s.jsx)(c.A,{direction:"row",spacing:0,sx:e=>({flexWrap:"wrap",width:500,[e.breakpoints.down("sm")]:{width:"100%"}}),children:(0,s.jsxs)(w.A,{container:!0,sx:{width:"100%"},children:[(0,s.jsx)(w.A,{size:{xs:9.5,md:4.5},children:(0,s.jsx)(N,{datasource:a,value:t.labelName,onChange:e=>{null==l||l({labelName:e,labelValue:"",operator:t.operator})}})}),(0,s.jsx)(w.A,{size:{xs:2.5,md:1.5},children:(0,s.jsx)(k,{value:t.operator,onChange:e=>{null==l||l({labelName:t.labelName,labelValue:t.labelValue,operator:e})}})}),(0,s.jsx)(w.A,{size:{xs:10,md:5},children:(0,s.jsx)(A,{datasource:a,value:t.labelValue,labelName:t.labelName,onChange:e=>{null==l||l({labelName:t.labelName,labelValue:e,operator:t.operator})}})}),(0,s.jsx)(w.A,{size:{xs:2,md:1},children:(0,s.jsx)(S,{onClick:()=>{null==r||r()}})})]})})}var I=t(86742);function P(e){let{onClick:a}=e;return(0,s.jsx)(u.ToolbarIconButton,{"aria-label":"add filter",onClick:a,children:(0,s.jsx)(I.default,{})})}function D(e){let a=(0,f.A)(),{datasource:t,value:l,onChange:r}=e;return(0,s.jsxs)(c.A,{position:"relative",direction:"row",spacing:0,sx:{flexWrap:"wrap",rowGap:1,gap:1,padding:"10px",border:`1px solid ${a.palette.action.disabled}`,borderRadius:`${a.shape.borderRadius}px`,"&:hover":{borderColor:a.palette.text.primary}},children:[(0,s.jsx)(m.A,{shrink:!0,sx:{position:"absolute",top:"-6px",left:"10px",padding:"0 4px",color:a.palette.text.primary,backgroundColor:a.palette.background.default,zIndex:1},children:"Filters"}),l.map((e,a)=>(0,s.jsx)(_,{datasource:t,value:e,onChange:e=>{let t;(t=[...l])[a]=e,null==r||r(t)},deleteItem:()=>{let e;(e=[...l]).splice(a,1),0===e.length?null==r||r([{labelName:"",labelValue:"",operator:"="}]):null==r||r(e)}},`${e.labelName}:${e.operator}:${e.labelValue}`)),(0,s.jsx)(P,{onClick:()=>{let e=[...l,{labelName:"",labelValue:"",operator:"="}];null==r||r(e)}})]})}let L={getProfileData:o,OptionsEditorComponent:function(e){let{onChange:a,value:t}=e,{datasource:l}=t,o=l??n,x=(0,u.useId)("pyroscope-datasource-label"),{maxNodes:b,handleMaxNodesChange:v,maxNodesHasError:g}=function(e){let{onChange:a,value:t}=e,[l,r]=(0,T.useState)(t.maxNodes?t.maxNodes.toString():""),[n,o]=(0,T.useState)(t.maxNodes);t.maxNodes!==n&&(r(t.maxNodes?t.maxNodes.toString():""),o(t.maxNodes));let s=!(""===l||/^[0-9]+$/.test(l)&&parseInt(l)>0);return{maxNodes:l,handleMaxNodesChange:e=>{r(e),a((0,d.jM)(t,a=>{a.maxNodes=""===e?void 0:parseInt(e)}))},maxNodesHasError:s}}(e),{profileType:w,handleProfileTypeChange:N}=function(e){let{onChange:a,value:t}=e,[l,r]=(0,T.useState)(t.profileType?t.profileType:""),[n,o]=(0,T.useState)(t.profileType);return t.profileType!==n&&(r(t.profileType),o(t.profileType)),{profileType:l,handleProfileTypeChange:e=>{r(e),a((0,d.jM)(t,a=>{a.profileType=e}))}}}(e),{service:C,handleServiceChange:k}=function(e){let{onChange:a,value:t}=e,[l,r]=(0,T.useState)(t.service?t.service:""),[n,o]=(0,T.useState)(t.service);return t.service!==n&&(r(t.service||""),o(t.service)),{service:l,handleServiceChange:e=>{r(e),a((0,d.jM)(t,a=>{a.service=e}))}}}(e),{filters:A,handleFiltersChange:R}=function(e){let{onChange:a,value:t}=e,[l,r]=(0,T.useState)(t.filters?t.filters:[]);return{filters:l,handleFiltersChange:e=>{r(e),a((0,d.jM)(t,a=>{a.filters=e}))}}}(e);return(0,s.jsxs)(c.A,{spacing:2,children:[(0,s.jsxs)(p.A,{margin:"dense",fullWidth:!1,children:[(0,s.jsx)(m.A,{id:x,shrink:!0,children:"Pyroscope Datasource"}),(0,s.jsx)(i.DatasourceSelect,{datasourcePluginKind:r,value:o,onChange:e=>{if("object"==typeof e&&"kind"in e&&"name"in e&&e.kind===r)return void a((0,d.jM)(t,a=>{a.datasource=void 0===e.name?void 0:e}));throw Error("Got unexpected non-Pyroscope datasource selector")},labelId:x,label:"Pyroscope Datasource",notched:!0})]}),(0,s.jsxs)(c.A,{direction:"row",sx:{[(0,f.A)().breakpoints.down("sm")]:{flexWrap:"wrap"},gap:2,rowGap:1},children:[(0,s.jsx)(j,{datasource:o,value:C,onChange:k}),(0,s.jsx)(y,{datasource:o,value:w,onChange:N}),(0,s.jsx)(h.A,{type:"number",size:"small",label:"Max Nodes",value:b,error:g,onChange:e=>v(e.target.value),sx:e=>({width:250,[e.breakpoints.down("sm")]:{width:"100%"}}),slotProps:{htmlInput:{step:1}}})]}),(0,s.jsx)(D,{datasource:o,value:A,onChange:R})]})},createInitialOptions:()=>({maxNodes:0,datasource:void 0,service:"",profileType:"",filters:[{labelName:"",labelValue:"",operator:"="}]})}}}]);