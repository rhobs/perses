{"version":3,"sources":["../../src/PanelActions.tsx"],"sourcesContent":["// Copyright 2025 The Perses Authors\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { InfoTooltip } from '@perses-dev/components';\nimport { otlptracev1 } from '@perses-dev/core';\nimport DownloadIcon from 'mdi-material-ui/DownloadOutline';\nimport { useCallback } from 'react';\nimport { HeaderIconButton } from '@perses-dev/dashboards';\nimport { TracingGanttChartPanelProps } from './TracingGanttChartPanel';\n\nexport function DownloadTraceAction(props: TracingGanttChartPanelProps) {\n  const { queryResults } = props;\n  const trace = queryResults[0]?.data?.trace;\n\n  const handleClick = useCallback(() => {\n    if (!trace) return;\n\n    const data = JSON.stringify(trace, null, 2);\n    const filename = getFilename(trace);\n    downloadFile(filename, 'application/json', data);\n  }, [trace]);\n\n  if (!trace) {\n    return null;\n  }\n\n  return (\n    <InfoTooltip description=\"download OTLP/JSON trace\">\n      <HeaderIconButton aria-label=\"download OTLP/JSON trace\" size=\"small\" onClick={handleClick}>\n        <DownloadIcon fontSize=\"inherit\" />\n      </HeaderIconButton>\n    </InfoTooltip>\n  );\n}\n\n/**\n * A trace can only contain spans with the same trace id. Therefore, let's return the trace id of the first span.\n * Exported for tests only.\n */\nexport function getFilename(trace: otlptracev1.TracesData) {\n  for (const resourceSpan of trace.resourceSpans) {\n    for (const scopeSpan of resourceSpan.scopeSpans) {\n      for (const span of scopeSpan.spans) {\n        return `${span.traceId}.json`;\n      }\n    }\n  }\n\n  return 'trace.json';\n}\n\nfunction downloadFile(filename: string, type: string, data: string) {\n  const url = URL.createObjectURL(new Blob([data], { type }));\n\n  const link = document.createElement('a');\n  link.download = filename;\n  link.href = url;\n  link.click();\n\n  URL.revokeObjectURL(url);\n}\n"],"names":["InfoTooltip","DownloadIcon","useCallback","HeaderIconButton","DownloadTraceAction","props","queryResults","trace","data","handleClick","JSON","stringify","filename","getFilename","downloadFile","description","aria-label","size","onClick","fontSize","resourceSpan","resourceSpans","scopeSpan","scopeSpans","span","spans","traceId","type","url","URL","createObjectURL","Blob","link","document","createElement","download","href","click","revokeObjectURL"],"mappings":";AAAA,oCAAoC;AACpC,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,6CAA6C;AAC7C,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;AAEjC,SAASA,WAAW,QAAQ,yBAAyB;AAErD,OAAOC,kBAAkB,kCAAkC;AAC3D,SAASC,WAAW,QAAQ,QAAQ;AACpC,SAASC,gBAAgB,QAAQ,yBAAyB;AAG1D,OAAO,SAASC,oBAAoBC,KAAkC;IACpE,MAAM,EAAEC,YAAY,EAAE,GAAGD;IACzB,MAAME,QAAQD,YAAY,CAAC,EAAE,EAAEE,MAAMD;IAErC,MAAME,cAAcP,YAAY;QAC9B,IAAI,CAACK,OAAO;QAEZ,MAAMC,OAAOE,KAAKC,SAAS,CAACJ,OAAO,MAAM;QACzC,MAAMK,WAAWC,YAAYN;QAC7BO,aAAaF,UAAU,oBAAoBJ;IAC7C,GAAG;QAACD;KAAM;IAEV,IAAI,CAACA,OAAO;QACV,OAAO;IACT;IAEA,qBACE,KAACP;QAAYe,aAAY;kBACvB,cAAA,KAACZ;YAAiBa,cAAW;YAA2BC,MAAK;YAAQC,SAAST;sBAC5E,cAAA,KAACR;gBAAakB,UAAS;;;;AAI/B;AAEA;;;CAGC,GACD,OAAO,SAASN,YAAYN,KAA6B;IACvD,KAAK,MAAMa,gBAAgBb,MAAMc,aAAa,CAAE;QAC9C,KAAK,MAAMC,aAAaF,aAAaG,UAAU,CAAE;YAC/C,KAAK,MAAMC,QAAQF,UAAUG,KAAK,CAAE;gBAClC,OAAO,GAAGD,KAAKE,OAAO,CAAC,KAAK,CAAC;YAC/B;QACF;IACF;IAEA,OAAO;AACT;AAEA,SAASZ,aAAaF,QAAgB,EAAEe,IAAY,EAAEnB,IAAY;IAChE,MAAMoB,MAAMC,IAAIC,eAAe,CAAC,IAAIC,KAAK;QAACvB;KAAK,EAAE;QAAEmB;IAAK;IAExD,MAAMK,OAAOC,SAASC,aAAa,CAAC;IACpCF,KAAKG,QAAQ,GAAGvB;IAChBoB,KAAKI,IAAI,GAAGR;IACZI,KAAKK,KAAK;IAEVR,IAAIS,eAAe,CAACV;AACtB"}