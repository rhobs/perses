{"version":3,"sources":["../../../../src/TracingGanttChart/GanttTable/SpanLinksButton.tsx"],"sourcesContent":["// Copyright 2025 The Perses Authors\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { IconButton, Menu, MenuItem } from '@mui/material';\nimport { MouseEvent, useState } from 'react';\nimport LaunchIcon from 'mdi-material-ui/Launch';\nimport { InfoTooltip } from '@perses-dev/components';\nimport { replaceVariablesInString, useAllVariableValues, useRouterContext } from '@perses-dev/plugin-system';\nimport { Span } from '../trace';\nimport { CustomLinks } from '../../gantt-chart-model';\n\nexport interface SpanLinksButtonProps {\n  customLinks: CustomLinks;\n  span: Span;\n}\n\nexport function SpanLinksButton(props: SpanLinksButtonProps) {\n  const { customLinks, span } = props;\n  const variableValues = useAllVariableValues();\n  const { RouterComponent } = useRouterContext();\n  const [anchorEl, setAnchorEl] = useState<null | HTMLElement>(null);\n  const isOpen = Boolean(anchorEl);\n\n  if (!RouterComponent || !customLinks.links.span) {\n    return null;\n  }\n\n  // if there is a single span link, render the button directly without a menu\n  if (span.links.length == 1 && span.links[0]) {\n    const link = span.links[0];\n    return (\n      <InfoTooltip description=\"open linked span\">\n        <IconButton\n          size=\"small\"\n          component={RouterComponent}\n          to={replaceVariablesInString(customLinks.links.span, variableValues, {\n            ...customLinks.variables,\n            traceId: link.traceId,\n            spanId: link.spanId,\n          })}\n        >\n          <LaunchIcon fontSize=\"inherit\" />\n        </IconButton>\n      </InfoTooltip>\n    );\n  }\n\n  const handleOpenMenu = (event: MouseEvent<HTMLButtonElement>) => {\n    // do not propagate onClick event to the table row (otherwise, the detail pane would open)\n    event.stopPropagation();\n\n    setAnchorEl(event.currentTarget);\n  };\n\n  const handleClose = (event: MouseEvent) => {\n    // Closing the menu, i.e. clicking on the fullscreen transparent MUI backdrop element, does trigger a click on the table row (which opens the detail pane).\n    // Therefore, stop propagating this event\n    event.stopPropagation();\n\n    setAnchorEl(null);\n  };\n\n  return (\n    <>\n      <InfoTooltip description={`${span.links.length} linked spans`}>\n        <IconButton\n          aria-label=\"span links\"\n          aria-haspopup=\"true\"\n          aria-expanded={isOpen ? 'true' : undefined}\n          size=\"small\"\n          onClick={handleOpenMenu}\n        >\n          <LaunchIcon fontSize=\"inherit\" />\n        </IconButton>\n      </InfoTooltip>\n      <Menu anchorEl={anchorEl} open={isOpen} onClose={handleClose}>\n        {span.links.map((link) => (\n          <MenuItem\n            key={link.spanId}\n            component={RouterComponent}\n            onClick={handleClose}\n            to={replaceVariablesInString(customLinks.links.span!, variableValues, {\n              ...customLinks.variables,\n              traceId: link.traceId,\n              spanId: link.spanId,\n            })}\n          >\n            Open linked span {link.spanId}\n          </MenuItem>\n        ))}\n      </Menu>\n    </>\n  );\n}\n"],"names":["IconButton","Menu","MenuItem","useState","LaunchIcon","InfoTooltip","replaceVariablesInString","useAllVariableValues","useRouterContext","SpanLinksButton","props","customLinks","span","variableValues","RouterComponent","anchorEl","setAnchorEl","isOpen","Boolean","links","length","link","description","size","component","to","variables","traceId","spanId","fontSize","handleOpenMenu","event","stopPropagation","currentTarget","handleClose","aria-label","aria-haspopup","aria-expanded","undefined","onClick","open","onClose","map"],"mappings":";AAAA,oCAAoC;AACpC,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,6CAA6C;AAC7C,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;AAEjC,SAASA,UAAU,EAAEC,IAAI,EAAEC,QAAQ,QAAQ,gBAAgB;AAC3D,SAAqBC,QAAQ,QAAQ,QAAQ;AAC7C,OAAOC,gBAAgB,yBAAyB;AAChD,SAASC,WAAW,QAAQ,yBAAyB;AACrD,SAASC,wBAAwB,EAAEC,oBAAoB,EAAEC,gBAAgB,QAAQ,4BAA4B;AAS7G,OAAO,SAASC,gBAAgBC,KAA2B;IACzD,MAAM,EAAEC,WAAW,EAAEC,IAAI,EAAE,GAAGF;IAC9B,MAAMG,iBAAiBN;IACvB,MAAM,EAAEO,eAAe,EAAE,GAAGN;IAC5B,MAAM,CAACO,UAAUC,YAAY,GAAGb,SAA6B;IAC7D,MAAMc,SAASC,QAAQH;IAEvB,IAAI,CAACD,mBAAmB,CAACH,YAAYQ,KAAK,CAACP,IAAI,EAAE;QAC/C,OAAO;IACT;IAEA,4EAA4E;IAC5E,IAAIA,KAAKO,KAAK,CAACC,MAAM,IAAI,KAAKR,KAAKO,KAAK,CAAC,EAAE,EAAE;QAC3C,MAAME,OAAOT,KAAKO,KAAK,CAAC,EAAE;QAC1B,qBACE,KAACd;YAAYiB,aAAY;sBACvB,cAAA,KAACtB;gBACCuB,MAAK;gBACLC,WAAWV;gBACXW,IAAInB,yBAAyBK,YAAYQ,KAAK,CAACP,IAAI,EAAEC,gBAAgB;oBACnE,GAAGF,YAAYe,SAAS;oBACxBC,SAASN,KAAKM,OAAO;oBACrBC,QAAQP,KAAKO,MAAM;gBACrB;0BAEA,cAAA,KAACxB;oBAAWyB,UAAS;;;;IAI7B;IAEA,MAAMC,iBAAiB,CAACC;QACtB,0FAA0F;QAC1FA,MAAMC,eAAe;QAErBhB,YAAYe,MAAME,aAAa;IACjC;IAEA,MAAMC,cAAc,CAACH;QACnB,2JAA2J;QAC3J,yCAAyC;QACzCA,MAAMC,eAAe;QAErBhB,YAAY;IACd;IAEA,qBACE;;0BACE,KAACX;gBAAYiB,aAAa,GAAGV,KAAKO,KAAK,CAACC,MAAM,CAAC,aAAa,CAAC;0BAC3D,cAAA,KAACpB;oBACCmC,cAAW;oBACXC,iBAAc;oBACdC,iBAAepB,SAAS,SAASqB;oBACjCf,MAAK;oBACLgB,SAAST;8BAET,cAAA,KAAC1B;wBAAWyB,UAAS;;;;0BAGzB,KAAC5B;gBAAKc,UAAUA;gBAAUyB,MAAMvB;gBAAQwB,SAASP;0BAC9CtB,KAAKO,KAAK,CAACuB,GAAG,CAAC,CAACrB,qBACf,MAACnB;wBAECsB,WAAWV;wBACXyB,SAASL;wBACTT,IAAInB,yBAAyBK,YAAYQ,KAAK,CAACP,IAAI,EAAGC,gBAAgB;4BACpE,GAAGF,YAAYe,SAAS;4BACxBC,SAASN,KAAKM,OAAO;4BACrBC,QAAQP,KAAKO,MAAM;wBACrB;;4BACD;4BACmBP,KAAKO,MAAM;;uBATxBP,KAAKO,MAAM;;;;AAe5B"}