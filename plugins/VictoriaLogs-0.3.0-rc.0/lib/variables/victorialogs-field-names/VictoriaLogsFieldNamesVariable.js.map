{"version":3,"sources":["../../../../src/variables/victorialogs-field-names/VictoriaLogsFieldNamesVariable.tsx"],"sourcesContent":["import {\n  VariablePlugin,\n  GetVariableOptionsContext,\n  replaceVariables,\n  parseVariables,\n  datasourceSelectValueToSelector,\n  isVariableDatasource,\n} from '@perses-dev/plugin-system';\nimport { VictoriaLogsClient, DEFAULT_VICTORIALOGS, VICTORIALOGS_DATASOURCE_KIND } from '../../model';\nimport { VictoriaLogsFieldNamesVariableEditor } from './VictoriaLogsFieldNamesVariableEditor';\nimport { fieldItemsToVariableOptions, getVictoriaLogsTimeRange } from '../utils';\nimport { VictoriaLogsFieldNamesVariableOptions } from '../types';\n\nexport const VictoriaLogsFieldNamesVariable: VariablePlugin<VictoriaLogsFieldNamesVariableOptions> = {\n  getVariableOptions: async (spec: VictoriaLogsFieldNamesVariableOptions, ctx: GetVariableOptionsContext) => {\n    const datasourceSelector = datasourceSelectValueToSelector(\n      spec.datasource ?? DEFAULT_VICTORIALOGS,\n      ctx.variables,\n      await ctx.datasourceStore.listDatasourceSelectItems(VICTORIALOGS_DATASOURCE_KIND)\n    ) ?? DEFAULT_VICTORIALOGS;\n    const client: VictoriaLogsClient = await ctx.datasourceStore.getDatasourceClient(datasourceSelector);\n    const timeRange = getVictoriaLogsTimeRange(ctx.timeRange);\n    const query = replaceVariables(spec.query, ctx.variables);\n\n    const { values } = query ? await client.fieldNames({ query: query, ...timeRange }) : { values: [] };\n    return {\n      data: fieldItemsToVariableOptions(values),\n    };\n  },\n  dependsOn: (spec: VictoriaLogsFieldNamesVariableOptions) => {\n    const queryVariables = parseVariables(spec.query);\n    const datasourceVariables =\n      spec.datasource && isVariableDatasource(spec.datasource) ? parseVariables(spec.datasource) : [];\n    return { variables: [...queryVariables, ...datasourceVariables] };\n  },\n  OptionsEditorComponent: VictoriaLogsFieldNamesVariableEditor,\n  createInitialOptions: () => ({ query: '' }),\n};\n"],"names":["replaceVariables","parseVariables","datasourceSelectValueToSelector","isVariableDatasource","DEFAULT_VICTORIALOGS","VICTORIALOGS_DATASOURCE_KIND","VictoriaLogsFieldNamesVariableEditor","fieldItemsToVariableOptions","getVictoriaLogsTimeRange","VictoriaLogsFieldNamesVariable","getVariableOptions","spec","ctx","datasourceSelector","datasource","variables","datasourceStore","listDatasourceSelectItems","client","getDatasourceClient","timeRange","query","values","fieldNames","data","dependsOn","queryVariables","datasourceVariables","OptionsEditorComponent","createInitialOptions"],"mappings":"AAAA,SAGEA,gBAAgB,EAChBC,cAAc,EACdC,+BAA+B,EAC/BC,oBAAoB,QACf,4BAA4B;AACnC,SAA6BC,oBAAoB,EAAEC,4BAA4B,QAAQ,cAAc;AACrG,SAASC,oCAAoC,QAAQ,yCAAyC;AAC9F,SAASC,2BAA2B,EAAEC,wBAAwB,QAAQ,WAAW;AAGjF,OAAO,MAAMC,iCAAwF;IACnGC,oBAAoB,OAAOC,MAA6CC;QACtE,MAAMC,qBAAqBX,gCACzBS,KAAKG,UAAU,IAAIV,sBACnBQ,IAAIG,SAAS,EACb,MAAMH,IAAII,eAAe,CAACC,yBAAyB,CAACZ,kCACjDD;QACL,MAAMc,SAA6B,MAAMN,IAAII,eAAe,CAACG,mBAAmB,CAACN;QACjF,MAAMO,YAAYZ,yBAAyBI,IAAIQ,SAAS;QACxD,MAAMC,QAAQrB,iBAAiBW,KAAKU,KAAK,EAAET,IAAIG,SAAS;QAExD,MAAM,EAAEO,MAAM,EAAE,GAAGD,QAAQ,MAAMH,OAAOK,UAAU,CAAC;YAAEF,OAAOA;YAAO,GAAGD,SAAS;QAAC,KAAK;YAAEE,QAAQ,EAAE;QAAC;QAClG,OAAO;YACLE,MAAMjB,4BAA4Be;QACpC;IACF;IACAG,WAAW,CAACd;QACV,MAAMe,iBAAiBzB,eAAeU,KAAKU,KAAK;QAChD,MAAMM,sBACJhB,KAAKG,UAAU,IAAIX,qBAAqBQ,KAAKG,UAAU,IAAIb,eAAeU,KAAKG,UAAU,IAAI,EAAE;QACjG,OAAO;YAAEC,WAAW;mBAAIW;mBAAmBC;aAAoB;QAAC;IAClE;IACAC,wBAAwBtB;IACxBuB,sBAAsB,IAAO,CAAA;YAAER,OAAO;QAAG,CAAA;AAC3C,EAAE"}