{"version":3,"sources":["../../../../src/variables/victorialogs-field-names/VictoriaLogsFieldNamesVariableEditor.tsx"],"sourcesContent":["// Copyright 2025 The Perses Authors\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nimport { FormControl, Stack, TextField } from '@mui/material';\nimport {\n  DatasourceSelect,\n  DatasourceSelectProps,\n  OptionsEditorProps,\n  isVariableDatasource,\n  useDatasourceSelectValueToSelector,\n} from '@perses-dev/plugin-system';\nimport { produce } from 'immer';\nimport { ReactElement, useCallback } from 'react';\nimport {\n  DEFAULT_VICTORIALOGS,\n  isDefaultVictoriaLogsSelector,\n  isVictoriaLogsDatasourceSelector,\n  VICTORIALOGS_DATASOURCE_KIND,\n  VictoriaLogsDatasourceSelector,\n} from '../../model';\nimport { VictoriaLogsFieldNamesVariableOptions } from '../types';\n\nexport function VictoriaLogsFieldNamesVariableEditor(\n  props: OptionsEditorProps<VictoriaLogsFieldNamesVariableOptions>\n): ReactElement {\n  const {\n    onChange,\n    value,\n    value: { datasource, query },\n  } = props;\n\n  const datasourceSelectValue = datasource ?? DEFAULT_VICTORIALOGS;\n  const selectedDatasource = useDatasourceSelectValueToSelector(\n    datasourceSelectValue,\n    VICTORIALOGS_DATASOURCE_KIND\n  ) as VictoriaLogsDatasourceSelector;\n  const handleDatasourceChange: DatasourceSelectProps['onChange'] = useCallback(\n    (next) => {\n      if (isVariableDatasource(next) || isVictoriaLogsDatasourceSelector(next)) {\n        onChange(\n          produce(value, (draft) => {\n            draft.datasource = !isVariableDatasource(next) && isDefaultVictoriaLogsSelector(next) ? undefined : next;\n          })\n        );\n        return;\n      }\n\n      throw new Error('Got unexpected non-VictoriaLogs datasource selector');\n    },\n    [onChange, value]\n  );\n\n  const handleQueryChange = useCallback(\n    (event: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n      onChange(\n        produce(value, (draft) => {\n          draft.query = event.target.value;\n        })\n      );\n    },\n    [onChange, value]\n  );\n\n  return (\n    <Stack spacing={2}>\n      <FormControl margin=\"dense\">\n        <DatasourceSelect\n          datasourcePluginKind=\"VictoriaLogsDatasource\"\n          value={selectedDatasource}\n          onChange={handleDatasourceChange}\n          disabled={props.isReadonly}\n          labelId=\"victorialogs-datasource-field\"\n          label=\"VictoriaLogs Datasource\"\n        />\n      </FormControl>\n      <TextField\n        label=\"Query\"\n        InputLabelProps={{ shrink: props.isReadonly ? true : undefined }}\n        InputProps={{\n          readOnly: props.isReadonly,\n        }}\n        value={query}\n        onChange={handleQueryChange}\n      />\n    </Stack>\n  );\n}\n"],"names":["FormControl","Stack","TextField","DatasourceSelect","isVariableDatasource","useDatasourceSelectValueToSelector","produce","useCallback","DEFAULT_VICTORIALOGS","isDefaultVictoriaLogsSelector","isVictoriaLogsDatasourceSelector","VICTORIALOGS_DATASOURCE_KIND","VictoriaLogsFieldNamesVariableEditor","props","onChange","value","datasource","query","datasourceSelectValue","selectedDatasource","handleDatasourceChange","next","draft","undefined","Error","handleQueryChange","event","target","spacing","margin","datasourcePluginKind","disabled","isReadonly","labelId","label","InputLabelProps","shrink","InputProps","readOnly"],"mappings":";AAAA,oCAAoC;AACpC,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,6CAA6C;AAC7C,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;AACjC,SAASA,WAAW,EAAEC,KAAK,EAAEC,SAAS,QAAQ,gBAAgB;AAC9D,SACEC,gBAAgB,EAGhBC,oBAAoB,EACpBC,kCAAkC,QAC7B,4BAA4B;AACnC,SAASC,OAAO,QAAQ,QAAQ;AAChC,SAAuBC,WAAW,QAAQ,QAAQ;AAClD,SACEC,oBAAoB,EACpBC,6BAA6B,EAC7BC,gCAAgC,EAChCC,4BAA4B,QAEvB,cAAc;AAGrB,OAAO,SAASC,qCACdC,KAAgE;IAEhE,MAAM,EACJC,QAAQ,EACRC,KAAK,EACLA,OAAO,EAAEC,UAAU,EAAEC,KAAK,EAAE,EAC7B,GAAGJ;IAEJ,MAAMK,wBAAwBF,cAAcR;IAC5C,MAAMW,qBAAqBd,mCACzBa,uBACAP;IAEF,MAAMS,yBAA4Db,YAChE,CAACc;QACC,IAAIjB,qBAAqBiB,SAASX,iCAAiCW,OAAO;YACxEP,SACER,QAAQS,OAAO,CAACO;gBACdA,MAAMN,UAAU,GAAG,CAACZ,qBAAqBiB,SAASZ,8BAA8BY,QAAQE,YAAYF;YACtG;YAEF;QACF;QAEA,MAAM,IAAIG,MAAM;IAClB,GACA;QAACV;QAAUC;KAAM;IAGnB,MAAMU,oBAAoBlB,YACxB,CAACmB;QACCZ,SACER,QAAQS,OAAO,CAACO;YACdA,MAAML,KAAK,GAAGS,MAAMC,MAAM,CAACZ,KAAK;QAClC;IAEJ,GACA;QAACD;QAAUC;KAAM;IAGnB,qBACE,MAACd;QAAM2B,SAAS;;0BACd,KAAC5B;gBAAY6B,QAAO;0BAClB,cAAA,KAAC1B;oBACC2B,sBAAqB;oBACrBf,OAAOI;oBACPL,UAAUM;oBACVW,UAAUlB,MAAMmB,UAAU;oBAC1BC,SAAQ;oBACRC,OAAM;;;0BAGV,KAAChC;gBACCgC,OAAM;gBACNC,iBAAiB;oBAAEC,QAAQvB,MAAMmB,UAAU,GAAG,OAAOT;gBAAU;gBAC/Dc,YAAY;oBACVC,UAAUzB,MAAMmB,UAAU;gBAC5B;gBACAjB,OAAOE;gBACPH,UAAUW;;;;AAIlB"}