{"version":3,"sources":["../../../src/variables/utils.ts"],"sourcesContent":["import { VictoriaLogsClient, VictoriaLogsFieldItem, VictoriaLogsFieldNamesResponse, VictoriaLogsFieldValuesResponse } from '../model';\nimport { VariableOption, useDatasourceClient, useTimeRange } from '@perses-dev/plugin-system';\nimport { AbsoluteTimeRange, DatasourceSelector, StatusError } from '@perses-dev/core'\nimport { useQuery, UseQueryResult } from '@tanstack/react-query';\n\nexport const fieldItemsToVariableOptions = (values?: VictoriaLogsFieldItem[]): VariableOption[] => {\n  if (!values) return [];\n  return values.map((value) => ({\n    value: value.value,\n    label: value.value,\n  }));\n};\n\nexport function getVictoriaLogsTimeRange(timeRange: AbsoluteTimeRange): { start: string; end: string } {\n  const { start, end } = timeRange;\n  return {\n    start: start.toISOString(),\n    end: end.toISOString(),\n  };\n}\n\nexport function useFieldNames(\n  query: string,\n  datasource: DatasourceSelector\n): UseQueryResult<VictoriaLogsFieldNamesResponse, StatusError> {\n  const {\n    absoluteTimeRange: { start, end },\n  } = useTimeRange();\n  const { data: client } = useDatasourceClient<VictoriaLogsClient>(datasource);\n  const enabled = !!client && !!query;\n\n  return useQuery<VictoriaLogsFieldNamesResponse, StatusError>({\n    enabled: enabled,\n    queryKey: ['datasource', datasource.name, 'query', query],\n    queryFn: async () => {\n      return await client!.fieldNames({\n        start: start.toISOString(),\n        end: end.toISOString(),\n        query: query,\n      });\n    },\n  });\n}\n\nexport function useFieldValues(\n  field: string,\n  query: string,\n  datasource: DatasourceSelector\n): UseQueryResult<VictoriaLogsFieldValuesResponse, StatusError> {\n  const {\n    absoluteTimeRange: { start, end },\n  } = useTimeRange();\n  const { data: client } = useDatasourceClient<VictoriaLogsClient>(datasource);\n  const enabled = !!client && !!query;\n\n  return useQuery<VictoriaLogsFieldValuesResponse, StatusError>({\n    enabled: enabled,\n    queryKey: ['field', field, 'datasource', datasource.name, 'query', query],\n    queryFn: async () => {\n      return await client!.fieldValues({\n        query: query,\n        field: field,\n        start: start.toISOString(),\n        end: end.toISOString(),\n      });\n    },\n  });\n}\n"],"names":["useDatasourceClient","useTimeRange","useQuery","fieldItemsToVariableOptions","values","map","value","label","getVictoriaLogsTimeRange","timeRange","start","end","toISOString","useFieldNames","query","datasource","absoluteTimeRange","data","client","enabled","queryKey","name","queryFn","fieldNames","useFieldValues","field","fieldValues"],"mappings":"AACA,SAAyBA,mBAAmB,EAAEC,YAAY,QAAQ,4BAA4B;AAE9F,SAASC,QAAQ,QAAwB,wBAAwB;AAEjE,OAAO,MAAMC,8BAA8B,CAACC;IAC1C,IAAI,CAACA,QAAQ,OAAO,EAAE;IACtB,OAAOA,OAAOC,GAAG,CAAC,CAACC,QAAW,CAAA;YAC5BA,OAAOA,MAAMA,KAAK;YAClBC,OAAOD,MAAMA,KAAK;QACpB,CAAA;AACF,EAAE;AAEF,OAAO,SAASE,yBAAyBC,SAA4B;IACnE,MAAM,EAAEC,KAAK,EAAEC,GAAG,EAAE,GAAGF;IACvB,OAAO;QACLC,OAAOA,MAAME,WAAW;QACxBD,KAAKA,IAAIC,WAAW;IACtB;AACF;AAEA,OAAO,SAASC,cACdC,KAAa,EACbC,UAA8B;IAE9B,MAAM,EACJC,mBAAmB,EAAEN,KAAK,EAAEC,GAAG,EAAE,EAClC,GAAGV;IACJ,MAAM,EAAEgB,MAAMC,MAAM,EAAE,GAAGlB,oBAAwCe;IACjE,MAAMI,UAAU,CAAC,CAACD,UAAU,CAAC,CAACJ;IAE9B,OAAOZ,SAAsD;QAC3DiB,SAASA;QACTC,UAAU;YAAC;YAAcL,WAAWM,IAAI;YAAE;YAASP;SAAM;QACzDQ,SAAS;YACP,OAAO,MAAMJ,OAAQK,UAAU,CAAC;gBAC9Bb,OAAOA,MAAME,WAAW;gBACxBD,KAAKA,IAAIC,WAAW;gBACpBE,OAAOA;YACT;QACF;IACF;AACF;AAEA,OAAO,SAASU,eACdC,KAAa,EACbX,KAAa,EACbC,UAA8B;IAE9B,MAAM,EACJC,mBAAmB,EAAEN,KAAK,EAAEC,GAAG,EAAE,EAClC,GAAGV;IACJ,MAAM,EAAEgB,MAAMC,MAAM,EAAE,GAAGlB,oBAAwCe;IACjE,MAAMI,UAAU,CAAC,CAACD,UAAU,CAAC,CAACJ;IAE9B,OAAOZ,SAAuD;QAC5DiB,SAASA;QACTC,UAAU;YAAC;YAASK;YAAO;YAAcV,WAAWM,IAAI;YAAE;YAASP;SAAM;QACzEQ,SAAS;YACP,OAAO,MAAMJ,OAAQQ,WAAW,CAAC;gBAC/BZ,OAAOA;gBACPW,OAAOA;gBACPf,OAAOA,MAAME,WAAW;gBACxBD,KAAKA,IAAIC,WAAW;YACtB;QACF;IACF;AACF"}