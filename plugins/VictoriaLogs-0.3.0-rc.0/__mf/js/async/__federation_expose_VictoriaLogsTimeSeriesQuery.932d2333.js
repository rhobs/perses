"use strict";(self.chunk_VictoriaLogs=self.chunk_VictoriaLogs||[]).push([["7843"],{69791:function(e,t,r){r.d(t,{$Z:()=>l,SG:()=>M,a3:()=>c,b5:()=>o,bB:()=>a,eo:()=>p,g3:()=>u,pW:()=>d,qU:()=>h,uV:()=>n,v9:()=>i});var s=r(94461);function a(e){return void 0!==e.pastDuration}function n(e){return void 0!==e.start&&void 0!==e.end}function o(e){let t=e.end??new Date;return{start:(0,s.sub)(t,d(e.pastDuration)),end:t}}let i=/^(?:(\d+)y)?(?:(\d+)w)?(?:(\d+)d)?(?:(\d+)h)?(?:(\d+)m)?(?:(\d+)s)?(?:(\d+)ms)?$/;function d(e){let t=i.exec(e);if(null===t)throw Error(`Invalid duration string '${e}'`);return{years:parseInt(t[1]??"0"),months:0,weeks:parseInt(t[2]??"0"),days:parseInt(t[3]??"0"),hours:parseInt(t[4]??"0"),minutes:parseInt(t[5]??"0"),seconds:parseInt(t[6]??"0")+parseInt(t[7]??"0")/1e3}}function u(e){return""!==e&&i.test(e)}function l(e){return p(e.end.valueOf()-e.start.valueOf())}function p(e){let t=Math.trunc(e/31536e6);t>0&&(e-=31536e6*t);let r=Math.trunc(e/6048e5);r>0&&(e-=6048e5*r);let s=Math.trunc(e/864e5);s>0&&(e-=864e5*s);let a=Math.trunc(e/36e5);a>0&&(e-=36e5*a);let n=Math.trunc(e/6e4);return n>0&&(e-=6e4*n),{years:t,months:0,weeks:r,days:s,hours:a,minutes:n,seconds:e/1e3}}function c(e){let t=[];if(e.years&&t.push(`${e.years}y`),e.weeks&&t.push(`${e.weeks}w`),e.days&&t.push(`${e.days}d`),e.hours&&t.push(`${e.hours}h`),e.minutes&&t.push(`${e.minutes}m`),e.seconds){let r=Math.trunc(e.seconds);r&&t.push(`${r}s`);let s=Math.round((e.seconds-r)*1e3);s&&t.push(`${s}ms`)}return t.join("")}let m=[{maxMs:15,roundedStepMs:10,display:"0.01s"},{maxMs:35,roundedStepMs:20,display:"0.02s"},{maxMs:75,roundedStepMs:50,display:"0.05s"},{maxMs:150,roundedStepMs:100,display:"0.1s"},{maxMs:350,roundedStepMs:200,display:"0.2s"},{maxMs:750,roundedStepMs:500,display:"0.5s"},{maxMs:1500,roundedStepMs:1e3,display:"1s"},{maxMs:3500,roundedStepMs:2e3,display:"2s"},{maxMs:7500,roundedStepMs:5e3,display:"5s"},{maxMs:12500,roundedStepMs:1e4,display:"10s"},{maxMs:17500,roundedStepMs:15e3,display:"15s"},{maxMs:25e3,roundedStepMs:2e4,display:"20s"},{maxMs:45e3,roundedStepMs:3e4,display:"30s"},{maxMs:9e4,roundedStepMs:6e4,display:"1m"},{maxMs:21e4,roundedStepMs:12e4,display:"2m"},{maxMs:45e4,roundedStepMs:3e5,display:"5m"},{maxMs:75e4,roundedStepMs:6e5,display:"10m"},{maxMs:75e4,roundedStepMs:9e5,display:"15m"},{maxMs:15e5,roundedStepMs:12e5,display:"20m"},{maxMs:27e5,roundedStepMs:18e5,display:"30m"},{maxMs:54e5,roundedStepMs:36e5,display:"1h"},{maxMs:9e6,roundedStepMs:72e5,display:"2h"},{maxMs:162e5,roundedStepMs:108e5,display:"3h"},{maxMs:324e5,roundedStepMs:216e5,display:"6h"},{maxMs:864e5,roundedStepMs:432e5,display:"12h"},{maxMs:6048e5,roundedStepMs:864e5,display:"1d"},{maxMs:18144e5,roundedStepMs:6048e5,display:"1w"},{maxMs:36288e5,roundedStepMs:2592e6,display:"30d"},{maxMs:63072e6,roundedStepMs:31536e6,display:"1y"}];function M(e){for(let{maxMs:t,roundedStepMs:r}of m)if(e<t)return r;return 15e3}function h(e,t){return M(Math.floor((e.end.valueOf()-e.start.valueOf())/t))}},6465:function(e,t,r){r.d(t,{m:()=>p});var s=r(62540),a=r(70451),n=r(56599),o=r(29068),i=r(63960),d=r(6365),u=r(31650);let l=(0,u.pn)({LineComment:u._A.comment,"Identifier StreamSelector":u._A.labelName,"LabelName LabelMatcher":u._A.labelName,String:u._A.string,"Number Float Duration":u._A.number,"LogRangeAggregation VectorAggregation":u._A.function(u._A.keyword),"And Or Unless":u._A.logicOperator,"Eq Neq Re Nre Gt Lt Gte Lte":u._A.compareOperator,"Add Sub Mul Div Mod Pow":u._A.arithmeticOperator,Pipe:u._A.operator,"By Without":u._A.keyword,"( )":u._A.paren,"[ ]":u._A.squareBracket,"{ }":u._A.brace,"âš ":u._A.invalid});function p(e){let t=(0,n.A)(),r="dark"===t.palette.mode,u=(0,a.useMemo)(()=>[i.bj.define({parser:d.K3.configure({props:[l]}),languageData:{closeBrackets:{brackets:["(","[","{","'",'"',"`"]},commentTokens:{line:"#"}}})],[]),p=(0,a.useMemo)(()=>{let e="light"===t.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return o.Lz.theme({"&":{backgroundColor:"transparent !important",border:`1px solid ${e}`,borderRadius:`${t.shape.borderRadius}px`},"&.cm-focused.cm-editor":{outline:"none"},".cm-content":{padding:"8px"}})},[t]);return(0,s.jsx)(o.Ay,{...e,theme:r?"dark":"light",basicSetup:{lineNumbers:!1,highlightActiveLine:!1,highlightActiveLineGutter:!1,foldGutter:!1,syntaxHighlighting:!0},extensions:[o.Lz.lineWrapping,u,p],placeholder:'Example: {job="my-service"} |= "error"'})}},50095:function(e,t,r){r.d(t,{H6:()=>i,m_:()=>a,fZ:()=>o,jx:()=>n});var s=r(57744);let a="VictoriaLogsDatasource",n={kind:a};function o(e){return!(0,s.isVariableDatasource)(e)&&void 0===e.name}function i(e){return(0,s.isVariableDatasource)(e)||e.kind===a}},7140:function(e,t,r){r.d(t,{N:()=>s,S:()=>a});let s="VictoriaLogsDatasource",a={kind:s}},43198:function(e,t,r){r.r(t),r.d(t,{VictoriaLogsQueryEditor:()=>M,VictoriaLogsTimeSeriesQuery:()=>h,getVictoriaLogsTimeSeriesData:()=>i});var s=r(69791),a=r(57744),n=r(94461),o=r(7140);let i=async(e,t)=>{if(!e.query)return{series:[],timeRange:{start:t.timeRange.start,end:t.timeRange.end},stepMs:15e3};let r=(0,a.replaceVariables)(e.query,t.variableState),i=await t.datasourceStore.getDatasourceClient(e.datasource??o.S),{start:d,end:u}=t.timeRange,l=e.step?function(e){if(!e)return;let t=(0,s.pW)(e);return Math.floor((0,n.milliseconds)(t)/1e3)}(e.step)??15:15,p=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=(t-e)/1e3/1e4;return a>1&&(a=Math.ceil(a)),Math.max(s/1e3,r,a)}(d.getTime(),u.getTime(),l,t.suggestedStepMs),c=p<60?`${Math.round(p)}s`:p<3600?`${Math.round(p/60)}m`:`${Math.round(p/3600)}h`,m=await i.statsQueryRange({query:r,step:c,start:d.toISOString(),end:u.toISOString()});if("error"===m.status)throw Error(m.error);return{series:m.data.result.map(e=>{let{_stream:t,...r}=e.metric;if(t){let e=t.match(/{([^}]+)}/);e&&e[1]&&e[1].split(",").forEach(e=>{let[t,s]=e.split("=").map(e=>e.trim().replace(/^"|"$/g,""));t&&s&&(r[t]=s)})}return{name:Object.entries(r).map(e=>{let[t,r]=e;return`${t}=${r}`}).join(", "),values:e.values.map(e=>{let[t,r]=e;return[1e3*Number(t),Number(r)]}),labels:r}}),timeRange:{start:d,end:u},stepMs:1e3*p,metadata:{executedQueryString:r}}};var d=r(62540),u=r(315),l=r(54227),p=r(70451),c=r(6465),m=r(50095);function M(e){let{onChange:t,value:r}=e,{datasource:s}=r,n=s??o.S,i=(0,a.useDatasourceSelectValueToSelector)(n,m.m_),[M,h]=(0,p.useState)(r.query);(0,p.useEffect)(()=>{h(r.query)},[r.query]);let g=(0,p.useCallback)(e=>{h(e)},[]),y=(0,p.useCallback)(e=>{t({...r,query:e})},[t,r]);return(0,d.jsxs)(u.A,{spacing:1.5,paddingBottom:1,children:[(0,d.jsxs)("div",{children:[(0,d.jsx)(l.A,{sx:{display:"block",marginBottom:"4px",fontWeight:500},children:"Datasource"}),(0,d.jsx)(a.DatasourceSelect,{datasourcePluginKind:o.N,value:i,onChange:e=>{if(!(0,a.isVariableDatasource)(e)&&e.kind===o.N)return void t({...r,datasource:e});throw Error("Got unexpected non VictoriaLogsQuery datasource selection")},label:"VictoriaLogs Datasource",notched:!0})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)(l.A,{sx:{display:"block",marginBottom:"4px",fontWeight:500},children:"LogsQL Query"}),(0,d.jsx)(c.m,{value:M,onChange:g,onBlur:()=>y(M),onKeyDown:e=>{"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),y(M))},placeholder:'Enter LogsQL query (e.g. {job="mysql"} |= "error")'})]})]})}let h={getTimeSeriesData:i,OptionsEditorComponent:M,createInitialOptions:()=>({query:""}),dependsOn:e=>({variables:[...new Set([...(0,a.parseVariables)(e.query)])]})}}}]);