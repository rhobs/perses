"use strict";(self.chunk_VictoriaLogs=self.chunk_VictoriaLogs||[]).push([["6545"],{6465:function(e,t,r){r.d(t,{m:()=>g});var a=r(62540),o=r(70451),i=r(56599),n=r(29068),s=r(63960),l=r(6365),u=r(31650);let c=(0,u.pn)({LineComment:u._A.comment,"Identifier StreamSelector":u._A.labelName,"LabelName LabelMatcher":u._A.labelName,String:u._A.string,"Number Float Duration":u._A.number,"LogRangeAggregation VectorAggregation":u._A.function(u._A.keyword),"And Or Unless":u._A.logicOperator,"Eq Neq Re Nre Gt Lt Gte Lte":u._A.compareOperator,"Add Sub Mul Div Mod Pow":u._A.arithmeticOperator,Pipe:u._A.operator,"By Without":u._A.keyword,"( )":u._A.paren,"[ ]":u._A.squareBracket,"{ }":u._A.brace,"âš ":u._A.invalid});function g(e){let t=(0,i.A)(),r="dark"===t.palette.mode,u=(0,o.useMemo)(()=>[s.bj.define({parser:l.K3.configure({props:[c]}),languageData:{closeBrackets:{brackets:["(","[","{","'",'"',"`"]},commentTokens:{line:"#"}}})],[]),g=(0,o.useMemo)(()=>{let e="light"===t.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return n.Lz.theme({"&":{backgroundColor:"transparent !important",border:`1px solid ${e}`,borderRadius:`${t.shape.borderRadius}px`},"&.cm-focused.cm-editor":{outline:"none"},".cm-content":{padding:"8px"}})},[t]);return(0,a.jsx)(n.Ay,{...e,theme:r?"dark":"light",basicSetup:{lineNumbers:!1,highlightActiveLine:!1,highlightActiveLineGutter:!1,foldGutter:!1,syntaxHighlighting:!0},extensions:[n.Lz.lineWrapping,u,g],placeholder:'Example: {job="my-service"} |= "error"'})}},50095:function(e,t,r){r.d(t,{H6:()=>s,m_:()=>o,fZ:()=>n,jx:()=>i});var a=r(57744);let o="VictoriaLogsDatasource",i={kind:o};function n(e){return!(0,a.isVariableDatasource)(e)&&void 0===e.name}function s(e){return(0,a.isVariableDatasource)(e)||e.kind===o}},7140:function(e,t,r){r.d(t,{N:()=>a,S:()=>o});let a="VictoriaLogsDatasource",o={kind:a}},49008:function(e,t,r){r.r(t),r.d(t,{VictoriaLogsLogQueryEditor:()=>d,getVictoriaLogsLogData:()=>i,VictoriaLogsLogQuery:()=>m});var a=r(57744),o=r(7140);let i=async(e,t)=>{var r,i;let n;if(!e.query)return{logs:{entries:[],totalCount:0},timeRange:{start:t.timeRange.start,end:t.timeRange.end}};let s=(0,a.replaceVariables)(e.query,t.variableState),l=await t.datasourceStore.getDatasourceClient(e.datasource??o.S),{start:u,end:c}=t.timeRange;return{logs:(r=await l.streamQueryRange({query:s,start:u.toISOString(),end:c.toISOString()}),i=c.getTime().toString(),n=[],r.forEach(e=>{let{_msg:t,_time:r,...a}=e,o=r||t?Date.parse(r):i;n.push({timestamp:Number(o)/1e3,line:t||"",labels:a})}),{entries:n,totalCount:n.length}),timeRange:{start:u,end:c},metadata:{executedQueryString:s}}};var n=r(62540),s=r(315),l=r(54227),u=r(70451),c=r(6465),g=r(50095);function d(e){let{onChange:t,value:r}=e,{datasource:i}=r,d=i??o.S,m=(0,a.useDatasourceSelectValueToSelector)(d,g.m_),[p,h]=(0,u.useState)(r.query);(0,u.useEffect)(()=>{h(r.query)},[r.query]);let b=(0,u.useCallback)(e=>{h(e)},[]),y=(0,u.useCallback)(e=>{t({...r,query:e})},[t,r]);return(0,n.jsxs)(s.A,{spacing:1.5,paddingBottom:1,children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(l.A,{sx:{display:"block",marginBottom:"4px",fontWeight:500},children:"Datasource"}),(0,n.jsx)(a.DatasourceSelect,{datasourcePluginKind:o.N,value:m,onChange:e=>{if(!(0,a.isVariableDatasource)(e)&&e.kind===o.N)return void t({...r,datasource:e});throw Error("Got unexpected non VictoriaLogsQuery datasource selection")},label:"VictoriaLogs Datasource",notched:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(l.A,{sx:{display:"block",marginBottom:"4px",fontWeight:500},children:"LogsQL Query"}),(0,n.jsx)(c.m,{value:p,onChange:b,onBlur:()=>y(p),onKeyDown:e=>{"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),y(p))},placeholder:'Enter LogsQL query (e.g. {job="mysql"} |= "error")'})]})]})}let m={getLogData:i,OptionsEditorComponent:d,createInitialOptions:()=>({query:""}),dependsOn:e=>({variables:[...new Set([...(0,a.parseVariables)(e.query)])]})}}}]);