"use strict";(self.chunk_TraceTable=self.chunk_TraceTable||[]).push([["778"],{86844:function(e,t,r){r.r(t),r.d(t,{TraceTable:()=>w});var l=r(62540),a=r(74628),n=r(37266),i=r(56599),o=r(88091),s=r(47601),d=r(65211),c=r(57438),u=r(69979),m=r(69791),h=r(57744),p=r(30182),f=r(71971),x=r(70451),g=r(92959);let v=new g.A({hue:{min:20,max:360}}),j=new g.A({hue:{min:0,max:20}}),y={},b=new Intl.DateTimeFormat(void 0,{dateStyle:"long",timeStyle:"medium"}).format,C=new Intl.DateTimeFormat(void 0,{dateStyle:"long",timeStyle:"long",timeZone:"UTC"}).format;function T(e){var t,r,c,u,g;let{options:T,result:w}=e,N=(0,i.A)(),$=(0,n.useChartsTheme)(),k=(0,h.useAllVariableValues)(),M=null==(r=T.visual)||null==(t=r.palette)?void 0:t.mode,I=(0,x.useCallback)(e=>(function(e,t,r,l){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("categorical"===r){let r=t.echartsTheme.color,n=[e.palette.error.light,e.palette.error.main,e.palette.error.dark],i=a?n:r;if(0===i.length)return console.warn("getConsistentCategoricalColor() called with empty color palette, fallback to #000"),"#000";let o=0;for(let e=0;e<l.length;e++)o=l.charCodeAt(e)+((o<<5)-o);return i[Math.abs(o)%i.length]??"#000"}{let e,t;return(t=y[e=`${l}_____${a}`])||(t=function(e,t){let[r,l,a]=t?j.hsl(e):v.hsl(e),n=`${(100*l).toFixed(0)}%`,i=`${(100*a).toFixed(0)}%`;return`hsla(${r.toFixed(2)},${n},${i},0.9)`}(l,a),y[e]=t),t}})(N,$,M,e),[N,$,M]),R=[];for(let e of w){let t=e.definition.spec.plugin.spec,r=null==t||null==(c=t.datasource)?void 0:c.name;for(let t of(null==(u=e.data)?void 0:u.searchResult)||[]){let e=(null==(g=T.links)?void 0:g.trace)?(0,h.replaceVariablesInString)(T.links.trace,k,{datasourceName:r??"",traceId:t.traceId}):void 0;R.push({...t,traceLink:e})}}let O=(0,x.useMemo)(()=>[{field:"name",headerName:"Trace name",type:"string",flex:4,display:"flex",valueGetter:(e,t)=>`${t.rootServiceName}: ${t.rootTraceName}`,renderCell:e=>{let{row:t}=e;return(0,l.jsxs)(a.A,{sx:{my:1},children:[(0,l.jsx)(A,{row:t}),(0,l.jsx)("br",{}),Object.entries(t.serviceStats).map(e=>{let[t,r]=e;return(0,l.jsx)(S,{serviceName:t,stats:r,serviceColor:I(t)},t)})]})}},{field:"spanCount",headerName:"Spans",type:"number",headerAlign:"left",align:"left",flex:2,minWidth:145,display:"flex",valueGetter:(e,t)=>Object.values(t.serviceStats).reduce((e,t)=>e+t.spanCount,0),renderCell:e=>{let{row:t}=e,r=0,a=0;for(let e of Object.values(t.serviceStats))r+=e.spanCount,a+=e.errorCount??0;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(o.A,{display:"inline",children:[r," spans"]}),a>0&&(0,l.jsx)(s.A,{label:`${a} error${1===a?"":"s"}`,sx:{marginLeft:"5px"},icon:(0,l.jsx)(p.default,{}),variant:"outlined",size:"small",color:"error"})]})}},{field:"durationMs",headerName:"Duration",type:"number",headerAlign:"left",align:"left",flex:1,minWidth:70,display:"flex",renderCell:e=>{let{row:t}=e;return(0,l.jsx)(o.A,{display:"inline",children:t.durationMs<1?"<1ms":(0,m.a3)((0,m.eo)(t.durationMs))})}},{field:"startTimeUnixMs",headerName:"Start time",type:"number",headerAlign:"left",align:"left",flex:3,minWidth:240,display:"flex",renderCell:e=>{let{row:t}=e;return(0,l.jsx)(d.A,{title:C(new Date(t.startTimeUnixMs)),placement:"top",arrow:!0,children:(0,l.jsx)(o.A,{display:"inline",children:b(new Date(t.startTimeUnixMs))},`st-${t.traceId}`)})}}],[I]);return(0,l.jsx)(f.z,{sx:{borderWidth:0},columns:O,rows:R,getRowId:e=>e.traceId,getRowHeight:()=>"auto",getEstimatedRowHeight:()=>66,disableRowSelectionOnClick:!0,pageSizeOptions:[10,20,50,100],initialState:{pagination:{paginationModel:{pageSize:20}},sorting:{sortModel:[{field:"startTimeUnixMs",sort:"desc"}]}}})}function A(e){let{row:t}=e,{RouterComponent:r}=(0,h.useRouterContext)();return r&&t.traceLink?(0,l.jsxs)(c.A,{variant:"body1",color:"inherit",underline:"hover",component:r,to:t.traceLink,children:[(0,l.jsxs)("strong",{children:[t.rootServiceName,":"]})," ",t.rootTraceName]}):(0,l.jsxs)(o.A,{display:"inline",children:[(0,l.jsxs)("strong",{children:[t.rootServiceName,":"]})," ",t.rootTraceName]})}function S(e){let{serviceName:t,stats:r,serviceColor:a}=e;return(0,l.jsx)(s.A,{label:t,variant:"outlined",size:"small",style:{"--service-color":a},sx:{marginTop:"5px",marginRight:"5px",borderColor:"var(--service-color)"},avatar:(0,l.jsx)(u.A,{sx:{minWidth:"fit-content",padding:"6px",backgroundColor:"var(--service-color)",fontSize:"0.65rem",fontWeight:"bold",textShadow:"0 0 5px #fff"},children:r.spanCount})})}let w={PanelComponent:function(e){let{spec:t,queryResults:r}=e,i=(0,n.useChartsTheme)().container.padding.default;return r.some(e=>{var t;return((null==(t=e.data)?void 0:t.searchResult)??[]).length>0})?(0,l.jsx)(a.A,{sx:{height:"100%",padding:`${i}px`,overflowY:"auto"},children:(0,l.jsx)(T,{options:t,result:r})}):(0,l.jsx)(n.NoDataOverlay,{resource:"traces"})},supportedQueryTypes:["TraceQuery"],createInitialOptions:function(){return{}}}}}]);