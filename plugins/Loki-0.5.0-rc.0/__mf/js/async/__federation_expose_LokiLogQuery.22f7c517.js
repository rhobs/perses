"use strict";(self.chunk_Loki=self.chunk_Loki||[]).push([["9830"],{20392:function(e,t,a){a.r(t),a.d(t,{LokiLogQueryEditor:()=>f,getLokiLogData:()=>o,LokiLogQuery:()=>y});var r=a(57744),i=a(7140);let o=async(e,t)=>{if(!e.query)return{logs:{entries:[],totalCount:0},timeRange:{start:t.timeRange.start,end:t.timeRange.end}};let a=(0,r.replaceVariables)(e.query,t.variableState),o=await t.datasourceStore.getDatasourceClient(e.datasource??i.S),{start:n,end:s}=t.timeRange,l=await o.queryRange({query:a,start:n.getTime().toString(),end:s.getTime().toString(),direction:e.direction});if("streams"===l.data.resultType){var u;let e;return{logs:(u=l.data.result,e=[],u.forEach(t=>{t.values.forEach(a=>{let[r,i]=a;e.push({timestamp:Number(r)/1e9,line:i,labels:t.stream})})}),{entries:e,totalCount:e.length}),timeRange:{start:n,end:s},metadata:{executedQueryString:a}}}return{logs:{entries:[],totalCount:0},timeRange:{start:n,end:s}}};var n=a(62540),s=a(315),l=a(54227),u=a(61375),c=a(31729),d=a(70451),g=a(38662),h=a(37266),m=a(63446),x=a(46536),p=a(64383);function f(e){let{onChange:t,value:a}=e,{datasource:o}=a,f=o??i.S,y=(0,r.useDatasourceSelectValueToSelector)(f,x.L),{query:v,handleQueryChange:b,handleQueryBlur:k}=(0,p.Z)(e),{data:L}=(0,r.useDatasourceClient)(y),{absoluteTimeRange:j}=(0,r.useTimeRange)(),w=(0,d.useMemo)(()=>{if(L)return{client:L,timeRange:j}},[L,j]),C=(0,d.useCallback)(e=>{b(e)},[b]);return(0,n.jsxs)(s.A,{spacing:1.5,paddingBottom:1,children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(l.A,{sx:{display:"block",marginBottom:"4px",fontWeight:500},children:"Datasource"}),(0,n.jsx)(r.DatasourceSelect,{datasourcePluginKind:i.N,value:y,onChange:e=>{if(!(0,r.isVariableDatasource)(e)&&e.kind===i.N)return void t((0,g.jM)(a,t=>{t.datasource=(0,x.Aw)(e)?void 0:e}));throw Error("Got unexpected non LokiQuery datasource selection")},label:"Loki Datasource",notched:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(l.A,{sx:{display:"block",marginBottom:"4px",fontWeight:500},children:"LogQL Query"}),(0,n.jsx)(m.J,{value:v,onChange:C,onBlur:k,onKeyDown:e=>{"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),t((0,g.jM)(a,e=>{e.query=v})))},placeholder:'Enter LogQL query (e.g. {job="mysql"} |= "error")',completionConfig:w})]}),(0,n.jsx)("div",{children:(0,n.jsx)(h.OptionsEditorControl,{label:"Order",control:(0,n.jsxs)(u.A,{exclusive:!0,value:(null==a?void 0:a.direction)??"backward",onChange:(e,r)=>t((0,g.jM)(a,e=>{e.direction=r})),sx:{height:"36px",marginLeft:"10px",width:"max-content"},children:[(0,n.jsx)(c.A,{"aria-label":"backward",value:"backward",sx:{fontWeight:500},children:"Newest first"}),(0,n.jsx)(c.A,{"aria-label":"forward",value:"forward",sx:{fontWeight:500},children:"Oldest first"})]})})})]})}let y={getLogData:o,OptionsEditorComponent:f,createInitialOptions:()=>({query:""}),dependsOn:e=>({variables:[...new Set([...(0,r.parseVariables)(e.query)])]})}}}]);