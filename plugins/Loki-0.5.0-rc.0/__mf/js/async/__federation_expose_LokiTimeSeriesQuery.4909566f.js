"use strict";(self.chunk_Loki=self.chunk_Loki||[]).push([["3206"],{69791:function(e,t,s){s.d(t,{$Z:()=>l,SG:()=>c,a3:()=>m,b5:()=>d,bB:()=>r,eo:()=>p,g3:()=>o,pW:()=>i,qU:()=>y,uV:()=>n,v9:()=>u});var a=s(94461);function r(e){return void 0!==e.pastDuration}function n(e){return void 0!==e.start&&void 0!==e.end}function d(e){let t=e.end??new Date;return{start:(0,a.sub)(t,i(e.pastDuration)),end:t}}let u=/^(?:(\d+)y)?(?:(\d+)w)?(?:(\d+)d)?(?:(\d+)h)?(?:(\d+)m)?(?:(\d+)s)?(?:(\d+)ms)?$/;function i(e){let t=u.exec(e);if(null===t)throw Error(`Invalid duration string '${e}'`);return{years:parseInt(t[1]??"0"),months:0,weeks:parseInt(t[2]??"0"),days:parseInt(t[3]??"0"),hours:parseInt(t[4]??"0"),minutes:parseInt(t[5]??"0"),seconds:parseInt(t[6]??"0")+parseInt(t[7]??"0")/1e3}}function o(e){return""!==e&&u.test(e)}function l(e){return p(e.end.valueOf()-e.start.valueOf())}function p(e){let t=Math.trunc(e/31536e6);t>0&&(e-=31536e6*t);let s=Math.trunc(e/6048e5);s>0&&(e-=6048e5*s);let a=Math.trunc(e/864e5);a>0&&(e-=864e5*a);let r=Math.trunc(e/36e5);r>0&&(e-=36e5*r);let n=Math.trunc(e/6e4);return n>0&&(e-=6e4*n),{years:t,months:0,weeks:s,days:a,hours:r,minutes:n,seconds:e/1e3}}function m(e){let t=[];if(e.years&&t.push(`${e.years}y`),e.weeks&&t.push(`${e.weeks}w`),e.days&&t.push(`${e.days}d`),e.hours&&t.push(`${e.hours}h`),e.minutes&&t.push(`${e.minutes}m`),e.seconds){let s=Math.trunc(e.seconds);s&&t.push(`${s}s`);let a=Math.round((e.seconds-s)*1e3);a&&t.push(`${a}ms`)}return t.join("")}let M=[{maxMs:15,roundedStepMs:10,display:"0.01s"},{maxMs:35,roundedStepMs:20,display:"0.02s"},{maxMs:75,roundedStepMs:50,display:"0.05s"},{maxMs:150,roundedStepMs:100,display:"0.1s"},{maxMs:350,roundedStepMs:200,display:"0.2s"},{maxMs:750,roundedStepMs:500,display:"0.5s"},{maxMs:1500,roundedStepMs:1e3,display:"1s"},{maxMs:3500,roundedStepMs:2e3,display:"2s"},{maxMs:7500,roundedStepMs:5e3,display:"5s"},{maxMs:12500,roundedStepMs:1e4,display:"10s"},{maxMs:17500,roundedStepMs:15e3,display:"15s"},{maxMs:25e3,roundedStepMs:2e4,display:"20s"},{maxMs:45e3,roundedStepMs:3e4,display:"30s"},{maxMs:9e4,roundedStepMs:6e4,display:"1m"},{maxMs:21e4,roundedStepMs:12e4,display:"2m"},{maxMs:45e4,roundedStepMs:3e5,display:"5m"},{maxMs:75e4,roundedStepMs:6e5,display:"10m"},{maxMs:75e4,roundedStepMs:9e5,display:"15m"},{maxMs:15e5,roundedStepMs:12e5,display:"20m"},{maxMs:27e5,roundedStepMs:18e5,display:"30m"},{maxMs:54e5,roundedStepMs:36e5,display:"1h"},{maxMs:9e6,roundedStepMs:72e5,display:"2h"},{maxMs:162e5,roundedStepMs:108e5,display:"3h"},{maxMs:324e5,roundedStepMs:216e5,display:"6h"},{maxMs:864e5,roundedStepMs:432e5,display:"12h"},{maxMs:6048e5,roundedStepMs:864e5,display:"1d"},{maxMs:18144e5,roundedStepMs:6048e5,display:"1w"},{maxMs:36288e5,roundedStepMs:2592e6,display:"30d"},{maxMs:63072e6,roundedStepMs:31536e6,display:"1y"}];function c(e){for(let{maxMs:t,roundedStepMs:s}of M)if(e<t)return s;return 15e3}function y(e,t){return c(Math.floor((e.end.valueOf()-e.start.valueOf())/t))}},89337:function(e,t,s){s.r(t),s.d(t,{getLokiTimeSeriesData:()=>u,LokiQueryEditor:()=>h,LokiTimeSeriesQuery:()=>x});var a=s(69791),r=s(57744),n=s(94461),d=s(7140);let u=async(e,t)=>{if(!e.query)return{series:[],timeRange:{start:t.timeRange.start,end:t.timeRange.end},stepMs:15e3};let s=(0,r.replaceVariables)(e.query,t.variableState),u=await t.datasourceStore.getDatasourceClient(e.datasource??d.S),{start:i,end:o}=t.timeRange,l=e.step?function(e){if(!e)return;let t=(0,a.pW)(e);return Math.floor((0,n.milliseconds)(t)/1e3)}(e.step)??15:15,p=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=(t-e)/1e3/1e4;return r>1&&(r=Math.ceil(r)),Math.max(a/1e3,s,r)}(i.getTime(),o.getTime(),l,t.suggestedStepMs),m=p<60?`${Math.round(p)}s`:p<3600?`${Math.round(p/60)}m`:`${Math.round(p/3600)}h`,M=1e3*p,c=await u.queryRange({query:s,start:i.getTime().toString(),end:o.getTime().toString(),step:m});return"matrix"===c.data.resultType?{series:c.data.result.map(e=>({name:Object.entries(e.metric).map(e=>{let[t,s]=e;return`${t}=${s}`}).join(", "),values:e.values.map(e=>{let[t,s]=e;return[1e3*Number(t),Number(s)]}),labels:e.metric})),timeRange:{start:i,end:o},stepMs:M,metadata:{executedQueryString:s}}:{series:[],timeRange:{start:i,end:o},stepMs:M}};var i=s(62540),o=s(315),l=s(54227),p=s(70451),m=s(38662),M=s(63446),c=s(46536),y=s(64383);function h(e){let{onChange:t,value:s}=e,{datasource:a}=s,n=a??d.S,u=(0,r.useDatasourceSelectValueToSelector)(n,c.L),{query:h,handleQueryChange:x,handleQueryBlur:S}=(0,y.Z)(e),g=(0,p.useCallback)(e=>{x(e)},[x]);return(0,i.jsxs)(o.A,{spacing:1.5,paddingBottom:1,children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(l.A,{sx:{display:"block",marginBottom:"4px",fontWeight:500},children:"Datasource"}),(0,i.jsx)(r.DatasourceSelect,{datasourcePluginKind:d.N,value:u,onChange:e=>{if(!(0,r.isVariableDatasource)(e)&&e.kind===d.N)return void t((0,m.jM)(s,t=>{t.datasource=e}));throw Error("Got unexpected non LokiQuery datasource selection")},label:"Loki Datasource",notched:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(l.A,{sx:{display:"block",marginBottom:"4px",fontWeight:500},children:"LogQL Query"}),(0,i.jsx)(M.J,{value:h,onChange:g,onBlur:S,onKeyDown:e=>{"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),t((0,m.jM)(s,e=>{e.query=h})))},placeholder:'Enter LogQL query (e.g. {job="mysql"} |= "error")'})]})]})}let x={getTimeSeriesData:u,OptionsEditorComponent:h,createInitialOptions:()=>({query:""}),dependsOn:e=>({variables:[...new Set([...(0,r.parseVariables)(e.query)])]})}}}]);