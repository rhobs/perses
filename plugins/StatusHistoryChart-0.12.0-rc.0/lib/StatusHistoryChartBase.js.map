{"version":3,"sources":["../../src/StatusHistoryChartBase.tsx"],"sourcesContent":["// Copyright 2024 The Perses Authors\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Box, SxProps, Typography, useTheme } from '@mui/material';\nimport { HeatmapChart as EChartsHeatmapChart } from 'echarts/charts';\nimport {\n  GridComponent,\n  DatasetComponent,\n  TitleComponent,\n  TooltipComponent,\n  VisualMapComponent,\n  LegendComponentOption,\n} from 'echarts/components';\nimport { use } from 'echarts/core';\nimport { CanvasRenderer } from 'echarts/renderers';\nimport { TimeScale } from '@perses-dev/core';\nimport { EChartsCoreOption, TitleComponentOption } from 'echarts';\nimport { FC } from 'react';\nimport { EChart, useChartsTheme, useTimeZone } from '@perses-dev/components';\nimport { getFormattedStatusHistoryAxisLabel } from './utils/get-formatted-axis-label';\nimport { generateTooltipHTML } from './StatusHistoryTooltip';\n\nuse([\n  EChartsHeatmapChart,\n  VisualMapComponent,\n  GridComponent,\n  DatasetComponent,\n  TitleComponent,\n  TooltipComponent,\n  CanvasRenderer,\n]);\n\nexport type StatusHistoryData = [number, number, number | undefined];\n\nexport interface StatusHistoryDataItem {\n  value: StatusHistoryData;\n  label?: string;\n  itemStyle?: {\n    color?: string;\n    borderColor?: string;\n    borderWidth?: number;\n  };\n}\n\nexport interface StatusHistoryChartBaseProps {\n  height: number;\n  data: StatusHistoryDataItem[];\n  xAxisCategories: number[];\n  yAxisCategories: string[];\n  legend?: LegendComponentOption;\n  timeScale?: TimeScale;\n  colors?: Array<{ value: number | string; color: string }>;\n}\n\nexport const StatusHistoryChartBase: FC<StatusHistoryChartBaseProps> = (props) => {\n  const { height, data, xAxisCategories, yAxisCategories, timeScale, colors } = props;\n\n  const { timeZone } = useTimeZone();\n  const chartsTheme = useChartsTheme();\n  const theme = useTheme();\n\n  const noDataTextStyle = (chartsTheme.noDataOption.title as TitleComponentOption).textStyle as SxProps;\n\n  const option: EChartsCoreOption = {\n    tooltip: {\n      appendToBody: true,\n      formatter: (params: { data: StatusHistoryDataItem; marker: string }) => {\n        return generateTooltipHTML({\n          data: params.data.value,\n          label: params.data.label,\n          marker: params.marker,\n          xAxisCategories,\n          yAxisCategories,\n          theme,\n        });\n      },\n    },\n    grid: {\n      top: '5%',\n      bottom: '5%',\n    },\n    xAxis: {\n      type: 'category',\n      data: xAxisCategories,\n      axisLine: {\n        show: false,\n      },\n      splitArea: {\n        show: false,\n      },\n      axisLabel: {\n        hideOverlap: true,\n        formatter: getFormattedStatusHistoryAxisLabel(timeScale?.rangeMs ?? 0, timeZone),\n      },\n    },\n    yAxis: {\n      type: 'category',\n      data: yAxisCategories,\n      axisLine: {\n        show: false,\n      },\n      splitArea: {\n        show: false,\n        interval: 0,\n      },\n      splitLine: {\n        show: false,\n      },\n      axisLabel: {\n        interval: 0,\n      },\n    },\n    visualMap: {\n      show: false,\n      type: 'piecewise',\n      pieces: colors,\n    },\n    series: [\n      {\n        name: 'Status history',\n        type: 'heatmap',\n        coordinateSystem: 'cartesian2d',\n        data: data,\n        label: {\n          show: false,\n        },\n        itemStyle: {\n          borderWidth: 1,\n          borderType: 'solid',\n          borderColor: '#ffffff',\n        },\n        emphasis: {\n          itemStyle: {\n            opacity: 0.5,\n          },\n        },\n      },\n    ],\n  };\n\n  return (\n    <Box\n      style={{ height: height }}\n      sx={{\n        overflow: 'auto',\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n      }}\n    >\n      {data.length ? (\n        <EChart\n          style={{\n            width: '100%',\n            height: height,\n          }}\n          option={option}\n          theme={chartsTheme.echartsTheme}\n        />\n      ) : (\n        <Typography sx={{ ...noDataTextStyle }}>No data</Typography>\n      )}\n    </Box>\n  );\n};\n"],"names":["Box","Typography","useTheme","HeatmapChart","EChartsHeatmapChart","GridComponent","DatasetComponent","TitleComponent","TooltipComponent","VisualMapComponent","use","CanvasRenderer","EChart","useChartsTheme","useTimeZone","getFormattedStatusHistoryAxisLabel","generateTooltipHTML","StatusHistoryChartBase","props","height","data","xAxisCategories","yAxisCategories","timeScale","colors","timeZone","chartsTheme","theme","noDataTextStyle","noDataOption","title","textStyle","option","tooltip","appendToBody","formatter","params","value","label","marker","grid","top","bottom","xAxis","type","axisLine","show","splitArea","axisLabel","hideOverlap","rangeMs","yAxis","interval","splitLine","visualMap","pieces","series","name","coordinateSystem","itemStyle","borderWidth","borderType","borderColor","emphasis","opacity","style","sx","overflow","display","justifyContent","alignItems","length","width","echartsTheme"],"mappings":";AAAA,oCAAoC;AACpC,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,6CAA6C;AAC7C,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;AAEjC,SAASA,GAAG,EAAWC,UAAU,EAAEC,QAAQ,QAAQ,gBAAgB;AACnE,SAASC,gBAAgBC,mBAAmB,QAAQ,iBAAiB;AACrE,SACEC,aAAa,EACbC,gBAAgB,EAChBC,cAAc,EACdC,gBAAgB,EAChBC,kBAAkB,QAEb,qBAAqB;AAC5B,SAASC,GAAG,QAAQ,eAAe;AACnC,SAASC,cAAc,QAAQ,oBAAoB;AAInD,SAASC,MAAM,EAAEC,cAAc,EAAEC,WAAW,QAAQ,yBAAyB;AAC7E,SAASC,kCAAkC,QAAQ,mCAAmC;AACtF,SAASC,mBAAmB,QAAQ,yBAAyB;AAE7DN,IAAI;IACFN;IACAK;IACAJ;IACAC;IACAC;IACAC;IACAG;CACD;AAwBD,OAAO,MAAMM,yBAA0D,CAACC;IACtE,MAAM,EAAEC,MAAM,EAAEC,IAAI,EAAEC,eAAe,EAAEC,eAAe,EAAEC,SAAS,EAAEC,MAAM,EAAE,GAAGN;IAE9E,MAAM,EAAEO,QAAQ,EAAE,GAAGX;IACrB,MAAMY,cAAcb;IACpB,MAAMc,QAAQzB;IAEd,MAAM0B,kBAAkB,AAACF,YAAYG,YAAY,CAACC,KAAK,CAA0BC,SAAS;IAE1F,MAAMC,SAA4B;QAChCC,SAAS;YACPC,cAAc;YACdC,WAAW,CAACC;gBACV,OAAOpB,oBAAoB;oBACzBI,MAAMgB,OAAOhB,IAAI,CAACiB,KAAK;oBACvBC,OAAOF,OAAOhB,IAAI,CAACkB,KAAK;oBACxBC,QAAQH,OAAOG,MAAM;oBACrBlB;oBACAC;oBACAK;gBACF;YACF;QACF;QACAa,MAAM;YACJC,KAAK;YACLC,QAAQ;QACV;QACAC,OAAO;YACLC,MAAM;YACNxB,MAAMC;YACNwB,UAAU;gBACRC,MAAM;YACR;YACAC,WAAW;gBACTD,MAAM;YACR;YACAE,WAAW;gBACTC,aAAa;gBACbd,WAAWpB,mCAAmCQ,WAAW2B,WAAW,GAAGzB;YACzE;QACF;QACA0B,OAAO;YACLP,MAAM;YACNxB,MAAME;YACNuB,UAAU;gBACRC,MAAM;YACR;YACAC,WAAW;gBACTD,MAAM;gBACNM,UAAU;YACZ;YACAC,WAAW;gBACTP,MAAM;YACR;YACAE,WAAW;gBACTI,UAAU;YACZ;QACF;QACAE,WAAW;YACTR,MAAM;YACNF,MAAM;YACNW,QAAQ/B;QACV;QACAgC,QAAQ;YACN;gBACEC,MAAM;gBACNb,MAAM;gBACNc,kBAAkB;gBAClBtC,MAAMA;gBACNkB,OAAO;oBACLQ,MAAM;gBACR;gBACAa,WAAW;oBACTC,aAAa;oBACbC,YAAY;oBACZC,aAAa;gBACf;gBACAC,UAAU;oBACRJ,WAAW;wBACTK,SAAS;oBACX;gBACF;YACF;SACD;IACH;IAEA,qBACE,KAAChE;QACCiE,OAAO;YAAE9C,QAAQA;QAAO;QACxB+C,IAAI;YACFC,UAAU;YACVC,SAAS;YACTC,gBAAgB;YAChBC,YAAY;QACd;kBAEClD,KAAKmD,MAAM,iBACV,KAAC3D;YACCqD,OAAO;gBACLO,OAAO;gBACPrD,QAAQA;YACV;YACAa,QAAQA;YACRL,OAAOD,YAAY+C,YAAY;2BAGjC,KAACxE;YAAWiE,IAAI;gBAAE,GAAGtC,eAAe;YAAC;sBAAG;;;AAIhD,EAAE"}