{"version":3,"sources":["../../src/PieChartOptionsEditorSettings.tsx"],"sourcesContent":["// Copyright 2024 The Perses Authors\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport merge from 'lodash/merge';\nimport {\n  CalculationSelector,\n  CalculationSelectorProps,\n  LegendOptionsEditor,\n  LegendOptionsEditorProps,\n} from '@perses-dev/plugin-system';\nimport { produce } from 'immer';\nimport {\n  FormatControls,\n  FormatControlsProps,\n  OptionsColorPicker,\n  OptionsEditorGroup,\n  OptionsEditorGrid,\n  OptionsEditorColumn,\n  SortSelector,\n  SortSelectorProps,\n  ModeSelector,\n  ModeSelectorProps,\n  ModeOption,\n  SortOption,\n  OptionsEditorControl,\n  useChartsTheme,\n} from '@perses-dev/components';\nimport { CalculationType, isPercentUnit, FormatOptions } from '@perses-dev/core';\nimport {\n  Button,\n  FormControl,\n  InputLabel,\n  MenuItem,\n  Select,\n  Stack,\n  Switch,\n  SwitchProps,\n  Typography,\n} from '@mui/material';\nimport { ReactElement, useMemo } from 'react';\nimport { PieChartOptions, PieChartOptionsEditorProps, DEFAULT_FORMAT } from './pie-chart-model';\n\nexport function PieChartOptionsEditorSettings(props: PieChartOptionsEditorProps): ReactElement {\n  const { onChange, value } = props;\n\n  const handleCalculationChange: CalculationSelectorProps['onChange'] = (newCalculation: CalculationType) => {\n    onChange(\n      produce(value, (draft: PieChartOptions) => {\n        draft.calculation = newCalculation;\n      })\n    );\n  };\n\n  const handleLegendChange: LegendOptionsEditorProps['onChange'] = (newLegend) => {\n    onChange(\n      produce(value, (draft: PieChartOptions) => {\n        draft.legend = newLegend;\n      })\n    );\n  };\n\n  const handleUnitChange: FormatControlsProps['onChange'] = (newFormat: FormatOptions) => {\n    onChange(\n      produce(value, (draft: PieChartOptions) => {\n        draft.format = newFormat;\n      })\n    );\n  };\n\n  const handleSortChange: SortSelectorProps['onChange'] = (newSort: SortOption) => {\n    onChange(\n      produce(value, (draft: PieChartOptions) => {\n        draft.sort = newSort;\n      })\n    );\n  };\n\n  const handleModeChange: ModeSelectorProps['onChange'] = (newMode: ModeOption) => {\n    onChange(\n      produce(value, (draft: PieChartOptions) => {\n        draft.mode = newMode;\n      })\n    );\n  };\n\n  const handleShowLabelsChange: SwitchProps['onChange'] = (_: unknown, checked: boolean) => {\n    onChange(\n      produce(value, (draft: PieChartOptions) => {\n        draft.showLabels = checked;\n      })\n    );\n  };\n\n  const chartsTheme = useChartsTheme();\n  const themePalette = chartsTheme.echartsTheme.color;\n\n  const colorPalette: string[] | undefined = useMemo(() => {\n    return value.colorPalette || undefined;\n  }, [value.colorPalette]);\n\n  const handleColorChange = (color?: string[]) => {\n    onChange(\n      produce(value, (draft: PieChartOptions) => {\n        if (Array.isArray(color)) {\n          draft.colorPalette = color;\n        } else if (typeof color === 'string') {\n          draft.colorPalette = [color];\n        } else {\n          draft.colorPalette = undefined;\n        }\n      })\n    );\n  };\n\n  // ensures decimalPlaces defaults to correct value\n  const format = merge({}, DEFAULT_FORMAT, value.format);\n\n  type ColorScheme = 'default' | 'theme' | 'gradient';\n\n  const colorScheme: ColorScheme = useMemo(() => {\n    return Array.isArray(colorPalette) ? (colorPalette.length === 1 ? 'gradient' : 'theme') : 'default';\n  }, [colorPalette]);\n\n  const handleColorSchemeChange = (scheme: ColorScheme) => {\n    if (scheme === 'theme') {\n      handleColorChange(themePalette as string[]);\n    } else if (scheme === 'default') {\n      handleColorChange();\n    } else {\n      // gradient: keep existing single color if present (user-chosen via OptionsColorPicker)\n      if (Array.isArray(colorPalette) && colorPalette.length === 1) {\n        return;\n      }\n      // initialize with a sensible default so the color picker shows a color\n      handleColorChange(['#ff0000']);\n    }\n  };\n\n  const colorHelpText = useMemo(() => {\n    if (colorPalette === undefined) {\n      return 'Colors will be automatically assigned using metrics name hash.';\n    }\n    if (Array.isArray(colorPalette) && colorPalette.length > 1) {\n      return 'Colors will be automatically assigned using the current theme color palette.';\n    }\n    if (Array.isArray(colorPalette) && colorPalette.length === 1) {\n      return 'All series will use a gradient based on the selected color.';\n    }\n    return undefined;\n  }, [colorPalette]);\n\n  return (\n    <OptionsEditorGrid>\n      <OptionsEditorColumn>\n        <LegendOptionsEditor calculation=\"comparison\" value={value.legend} onChange={handleLegendChange} />\n        <OptionsEditorGroup title=\"Misc\">\n          <OptionsEditorControl\n            label=\"Show Labels\"\n            control={<Switch checked={Boolean(value.showLabels)} onChange={handleShowLabelsChange} />}\n          />\n          <FormatControls value={format} onChange={handleUnitChange} disabled={value.mode === 'percentage'} />\n          <CalculationSelector value={value.calculation} onChange={handleCalculationChange} />\n          <SortSelector value={value.sort} onChange={handleSortChange} />\n          <ModeSelector value={value.mode} onChange={handleModeChange} disablePercentageMode={isPercentUnit(format)} />\n        </OptionsEditorGroup>\n      </OptionsEditorColumn>\n      <OptionsEditorColumn>\n        <OptionsEditorGroup title=\"Colors\">\n          <Stack spacing={2}>\n            <Stack direction=\"row\" spacing={2} alignItems=\"center\">\n              <FormControl size=\"small\" sx={{ minWidth: 150 }}>\n                <InputLabel>Color Scheme</InputLabel>\n                <Select\n                  value={colorScheme}\n                  label=\"Color Scheme\"\n                  onChange={(e) => handleColorSchemeChange(e.target.value as ColorScheme)}\n                >\n                  <MenuItem value=\"default\">Default</MenuItem>\n                  <MenuItem value=\"theme\">Theme</MenuItem>\n                  <MenuItem value=\"gradient\">Gradient</MenuItem>\n                </Select>\n              </FormControl>\n              {Array.isArray(colorPalette) && colorPalette.length === 1 && (\n                <OptionsColorPicker\n                  label=\"Color\"\n                  color={colorPalette?.[0] ?? (themePalette as string[])[0] ?? '#ff0000'}\n                  onColorChange={(c: string) => handleColorChange([c])}\n                />\n              )}\n            </Stack>\n            {colorHelpText && (\n              <Typography variant=\"body2\" color=\"text.secondary\">\n                {colorHelpText}\n              </Typography>\n            )}\n          </Stack>\n        </OptionsEditorGroup>\n        <OptionsEditorGroup title=\"Reset Settings\">\n          <Button\n            variant=\"outlined\"\n            color=\"secondary\"\n            onClick={() => {\n              onChange(\n                produce(value, (draft: PieChartOptions) => {\n                  // reset button removes all optional panel options\n                  draft.legend = undefined;\n                  draft.colorPalette = undefined;\n                })\n              );\n            }}\n          >\n            Reset To Defaults\n          </Button>\n        </OptionsEditorGroup>\n      </OptionsEditorColumn>\n    </OptionsEditorGrid>\n  );\n}\n"],"names":["merge","CalculationSelector","LegendOptionsEditor","produce","FormatControls","OptionsColorPicker","OptionsEditorGroup","OptionsEditorGrid","OptionsEditorColumn","SortSelector","ModeSelector","OptionsEditorControl","useChartsTheme","isPercentUnit","Button","FormControl","InputLabel","MenuItem","Select","Stack","Switch","Typography","useMemo","DEFAULT_FORMAT","PieChartOptionsEditorSettings","props","onChange","value","handleCalculationChange","newCalculation","draft","calculation","handleLegendChange","newLegend","legend","handleUnitChange","newFormat","format","handleSortChange","newSort","sort","handleModeChange","newMode","mode","handleShowLabelsChange","_","checked","showLabels","chartsTheme","themePalette","echartsTheme","color","colorPalette","undefined","handleColorChange","Array","isArray","colorScheme","length","handleColorSchemeChange","scheme","colorHelpText","title","label","control","Boolean","disabled","disablePercentageMode","spacing","direction","alignItems","size","sx","minWidth","e","target","onColorChange","c","variant","onClick"],"mappings":"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"}