/*! For license information please see __federation_expose_ClickHouseLogQuery.ceed53aa.js.LICENSE.txt */
"use strict";(self.chunk_ClickHouse=self.chunk_ClickHouse||[]).push([["5547"],{2192:function(e,t,r){var a=r(70451),i=Symbol.for("react.element"),o=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,l=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,r){var a,o={},u=null,c=null;for(a in void 0!==r&&(u=""+r),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(c=t.ref),t)n.call(t,a)&&!s.hasOwnProperty(a)&&(o[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===o[a]&&(o[a]=t[a]);return{$$typeof:i,type:e,key:u,ref:c,props:o,_owner:l.current}}t.Fragment=o,t.jsx=u,t.jsxs=u},62540:function(e,t,r){e.exports=r(2192)},15062:function(e,t,r){r.d(t,{t:()=>a});let a=`-- Time Series Query
SELECT 
  toStartOfMinute(timestamp) as time,
  avg(cpu_usage) as avg_cpu,
  max(memory_usage) as max_memory
FROM system_metrics 
WHERE timestamp BETWEEN '{start}' AND '{end}'
GROUP BY time ORDER BY time
-- Logs Query  
SELECT 
  Timestamp as log_time,
  Body,
  ServiceName,
  ResourceAttributes,
  SeverityNumber,
  SeverityText
FROM application_logs 
WHERE timestamp >= '{start}' 
ORDER BY time DESC LIMIT 1000`},21261:function(e,t,r){r.d(t,{N:()=>u});var a=r(62540),i=r(29068),o=r(41865),n=r(56599),l=r(315),s=r(54227);function u(e){let t=(0,n.A)(),r="dark"===t.palette.mode;return(0,a.jsxs)(l.A,{position:"relative",children:[(0,a.jsx)(s.A,{sx:{fontWeight:500,marginBottom:"4px",color:t.palette.text.primary},children:"ClickHouse Query"}),(0,a.jsx)(i.Ay,{...e,style:{border:`1px solid ${t.palette.divider}`},theme:r?"dark":"light",basicSetup:{highlightActiveLine:!1,highlightActiveLineGutter:!1,foldGutter:!1,syntaxHighlighting:!0},extensions:[o.Lz.lineWrapping,o.Lz.theme({".cm-content":{paddingTop:"8px",paddingBottom:"8px",paddingRight:"40px"}})],placeholder:"Write ClickHouse Query Here..."})]})}},90916:function(e,t,r){r.r(t),r.d(t,{ClickHouseLogQuery:()=>y,getClickHouseLogData:()=>o,ClickHouseLogQueryEditor:()=>p});var a=r(57744),i=r(7140);let o=async(e,t)=>{let r;if(void 0===e.query||null===e.query||""===e.query)return{logs:{entries:[],totalCount:0},timeRange:{start:t.timeRange.start,end:t.timeRange.end}};let o=(0,a.replaceVariables)(e.query,t.variableState),n=await t.datasourceStore.getDatasourceClient(e.datasource??i.S),{start:l,end:s}=t.timeRange,u=await n.query({start:l.getTime().toString(),end:s.getTime().toString(),query:o});return{timeRange:{start:l,end:s},logs:{entries:r=u.data.map(e=>{let t=function e(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};for(let[i,o]of Object.entries(t)){let t=r?`${r}.${i}`:i;o&&"object"==typeof o&&!Array.isArray(o)?e(o,t,a):a[t]=o}return a}(e);!t.Timestamp&&t.log_time&&(t.Timestamp=t.log_time);let r={};Object.keys(t).sort((e,t)=>e.localeCompare(t)).forEach(e=>{r[e]=t[e]});let a=Object.entries(r).filter(e=>{let[t]=e;return"Timestamp"!==t}).map(e=>{let[t,r]=e;return`<${t}> ${""===r||null==r?"--":r}`}).join(" ");return{timestamp:null==r?void 0:r.Timestamp,labels:r,line:a}}),totalCount:r.length},metadata:{executedQueryString:o}}};var n=r(62540),l=r(70451),s=r(38662),u=r(315),c=r(21261),d=r(15062),m=r(64383);function p(e){let{onChange:t,value:r}=e,{datasource:o}=r,p=o??i.S,{query:y,handleQueryChange:g,handleQueryBlur:f}=(0,m.Z)(e),h=(0,l.useCallback)(e=>{g(e)},[g]);return(0,n.jsxs)(u.A,{spacing:1.5,children:[(0,n.jsx)(a.DatasourceSelect,{datasourcePluginKind:i.N,value:p,onChange:e=>{if(!(0,a.isVariableDatasource)(e)&&e.kind===i.N)return void t((0,s.jM)(r,t=>{t.datasource=e}));throw Error("Got unexpected non ClickHouse datasource selection")},label:"ClickHouse Datasource",notched:!0}),(0,n.jsx)(c.N,{value:y,onChange:h,onBlur:f,onKeyDown:e=>{"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),t((0,s.jM)(r,e=>{e.query=y})))},placeholder:"Enter ClickHouse SQL query"}),(0,n.jsxs)("details",{children:[(0,n.jsx)("summary",{style:{cursor:"pointer",fontSize:"12px",color:"#666",marginBottom:"8px"},children:"Query Examples"}),(0,n.jsx)("div",{style:{fontSize:"11px",color:"#777",backgroundColor:"#f5f5f5",padding:"8px",borderRadius:"4px",fontFamily:'Monaco, Menlo, "Ubuntu Mono", monospace',whiteSpace:"pre-wrap",lineHeight:"1.3"},children:d.t})]})]})}let y={getLogData:o,OptionsEditorComponent:p,createInitialOptions:()=>({query:""}),dependsOn:e=>({variables:[...new Set([...(0,a.parseVariables)(e.query)])]})}},7140:function(e,t,r){r.d(t,{N:()=>a,S:()=>i});let a="ClickHouseDatasource",i={kind:a}},64383:function(e,t,r){r.d(t,{Z:()=>o});var a=r(70451),i=r(38662);function o(e){let{onChange:t,value:r}=e,[o,n]=(0,a.useState)(r.query||""),[l,s]=(0,a.useState)(r.query);return r.query!==l&&(n(r.query||""),s(r.query)),{query:o,handleQueryChange:e=>{n(e)},handleQueryBlur:()=>{s(o),t((0,i.jM)(r,e=>{e.query=o}))}}}}}]);