{"version":3,"sources":["../../src/GaugeChartBase.tsx"],"sourcesContent":["// Copyright 2023 The Perses Authors\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { EChart, useChartsTheme, useDeepMemo } from '@perses-dev/components';\nimport { formatValue, FormatOptions } from '@perses-dev/core';\nimport { use, EChartsCoreOption } from 'echarts/core';\nimport { GaugeChart as EChartsGaugeChart, GaugeSeriesOption } from 'echarts/charts';\nimport { GridComponent, TitleComponent, TooltipComponent } from 'echarts/components';\nimport { CanvasRenderer } from 'echarts/renderers';\nimport { ReactElement } from 'react';\n\nuse([EChartsGaugeChart, GridComponent, TitleComponent, TooltipComponent, CanvasRenderer]);\n\n// adjusts when to show pointer icon\nconst GAUGE_SMALL_BREAKPOINT = 170;\n\nexport type GaugeChartValue = number | null | undefined;\n\nexport type GaugeSeries = {\n  value: GaugeChartValue;\n  label: string;\n};\n\nexport interface GaugeChartBaseProps {\n  width: number;\n  height: number;\n  data: GaugeSeries;\n  format: FormatOptions;\n  axisLine: GaugeSeriesOption['axisLine'];\n  max?: number;\n  valueFontSize: string;\n  progressWidth: number;\n  titleFontSize: number;\n}\n\nexport function GaugeChartBase(props: GaugeChartBaseProps): ReactElement {\n  const { width, height, data, format, axisLine, max, valueFontSize, progressWidth, titleFontSize } = props;\n  const chartsTheme = useChartsTheme();\n\n  // useDeepMemo ensures value size util does not rerun everytime you hover on the chart\n  const option: EChartsCoreOption = useDeepMemo(() => {\n    if (data.value === undefined) return chartsTheme.noDataOption;\n\n    // Base configuration shared by both series (= progress & scale)\n    const baseGaugeConfig = {\n      type: 'gauge' as const,\n      center: ['50%', '65%'] as [string, string],\n      startAngle: 200,\n      endAngle: -20,\n      min: 0,\n      max: max,\n      axisTick: {\n        show: false,\n      },\n      splitLine: {\n        show: false,\n      },\n      axisLabel: {\n        show: false,\n      },\n      data: [\n        {\n          value: data.value,\n        },\n      ],\n    };\n\n    return {\n      title: {\n        show: false,\n      },\n      tooltip: {\n        show: false,\n      },\n      series: [\n        // Inner gauge (progress)\n        {\n          ...baseGaugeConfig,\n          radius: '90%',\n          silent: true,\n          progress: {\n            show: true,\n            width: progressWidth,\n            itemStyle: {\n              color: 'auto',\n            },\n          },\n          axisLine: {\n            lineStyle: {\n              color: [[1, 'rgba(127,127,127,0.35)']], // TODO (sjcobb): use future chart theme colors\n              width: progressWidth,\n            },\n          },\n          pointer: {\n            show: false,\n          },\n          anchor: {\n            show: false,\n          },\n          title: {\n            show: false,\n          },\n          detail: {\n            show: false,\n          },\n        },\n        // Outer gauge (scale & display)\n        {\n          ...baseGaugeConfig,\n          radius: '100%',\n          pointer: {\n            show: true,\n            // pointer hidden for small panels, path taken from ex: https://echarts.apache.org/examples/en/editor.html?c=gauge-grade\n            icon: width > GAUGE_SMALL_BREAKPOINT ? 'path://M12.8,0.7l12,40.1H0.7L12.8,0.7z' : 'none',\n            length: 10,\n            width: 5,\n            offsetCenter: [0, '-49%'],\n            itemStyle: {\n              color: 'auto',\n            },\n          },\n          axisLine: axisLine,\n          // `detail` is the text displayed in the middle\n          detail: {\n            show: true,\n            width: '60%',\n            borderRadius: 8,\n            offsetCenter: [0, '-9%'],\n            color: 'inherit', // allows value color to match active threshold color\n            fontSize: valueFontSize,\n            formatter:\n              data.value === null\n                ? // We use a different function when we *know* the value is null\n                  // at this level because the `formatter` function argument is `NaN`\n                  // when the value is `null`, making it difficult to differentiate\n                  // `null` from a true `NaN` case.\n                  (): string => 'null'\n                : (value: number): string | undefined => {\n                    return formatValue(value, format);\n                  },\n          },\n          data: [\n            {\n              value: data.value,\n              name: data.label,\n              // TODO: new UX for series names, create separate React component or reuse ListLegendItem\n              // https://echarts.apache.org/en/option.html#series-gauge.data.title\n              title: {\n                show: true,\n                color: chartsTheme.echartsTheme.textStyle?.color ?? 'inherit', // series name font color\n                offsetCenter: [0, '55%'],\n                overflow: 'truncate',\n                fontSize: titleFontSize,\n                width: width * 0.8,\n              },\n            },\n          ],\n        },\n      ],\n    };\n  }, [data, width, height, chartsTheme, format, axisLine, max, valueFontSize, progressWidth, titleFontSize]);\n\n  return (\n    <EChart\n      style={{\n        width: width,\n        height: height,\n      }}\n      sx={{\n        padding: `${chartsTheme.container.padding.default}px`,\n      }}\n      option={option}\n      theme={chartsTheme.echartsTheme}\n    />\n  );\n}\n"],"names":["EChart","useChartsTheme","useDeepMemo","formatValue","use","GaugeChart","EChartsGaugeChart","GridComponent","TitleComponent","TooltipComponent","CanvasRenderer","GAUGE_SMALL_BREAKPOINT","GaugeChartBase","props","width","height","data","format","axisLine","max","valueFontSize","progressWidth","titleFontSize","chartsTheme","option","value","undefined","noDataOption","baseGaugeConfig","type","center","startAngle","endAngle","min","axisTick","show","splitLine","axisLabel","title","tooltip","series","radius","silent","progress","itemStyle","color","lineStyle","pointer","anchor","detail","icon","length","offsetCenter","borderRadius","fontSize","formatter","name","label","echartsTheme","textStyle","overflow","style","sx","padding","container","default","theme"],"mappings":"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"}