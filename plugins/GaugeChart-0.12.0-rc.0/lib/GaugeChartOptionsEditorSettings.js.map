{"version":3,"sources":["../../src/GaugeChartOptionsEditorSettings.tsx"],"sourcesContent":["// Copyright 2023 The Perses Authors\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Switch, TextField } from '@mui/material';\nimport {\n  FormatControls,\n  FormatControlsProps,\n  OptionsEditorColumn,\n  OptionsEditorControl,\n  OptionsEditorGrid,\n  OptionsEditorGroup,\n  ThresholdsEditor,\n} from '@perses-dev/components';\nimport { ThresholdOptions } from '@perses-dev/core';\nimport { CalculationSelector, CalculationSelectorProps } from '@perses-dev/plugin-system';\nimport { produce } from 'immer';\nimport merge from 'lodash/merge';\nimport { ReactElement } from 'react';\nimport {\n  DEFAULT_FORMAT,\n  DEFAULT_MAX_PERCENT,\n  DEFAULT_MAX_PERCENT_DECIMAL,\n  GaugeChartOptions,\n  GaugeChartOptionsEditorProps,\n} from './gauge-chart-model';\n\nexport function GaugeChartOptionsEditorSettings(props: GaugeChartOptionsEditorProps): ReactElement {\n  const { onChange, value } = props;\n  /* If legend setting doesn't exist (because it is optional), the legend should show by default \n     This is for the records before the legend option was added\n  */\n  const showLegend = value?.legend?.show ?? true;\n\n  const handleCalculationChange: CalculationSelectorProps['onChange'] = (newCalculation) => {\n    onChange(\n      produce(value, (draft: GaugeChartOptions) => {\n        draft.calculation = newCalculation;\n      })\n    );\n  };\n\n  const handleUnitChange: FormatControlsProps['onChange'] = (newFormat) => {\n    onChange(\n      produce(value, (draft: GaugeChartOptions) => {\n        draft.format = newFormat;\n      })\n    );\n  };\n\n  // ensures decimalPlaces defaults to correct value\n  const format = merge({}, DEFAULT_FORMAT, value.format);\n\n  // max only needs to be set explicitly for units other than percent and percent-decimal\n  let maxPlaceholder = 'Enter value';\n  if (format.unit === 'percent') {\n    maxPlaceholder = DEFAULT_MAX_PERCENT.toString();\n  } else if (format.unit === 'percent-decimal') {\n    maxPlaceholder = DEFAULT_MAX_PERCENT_DECIMAL.toString();\n  }\n\n  const handleThresholdsChange = (thresholds: ThresholdOptions): void => {\n    onChange(\n      produce(value, (draft: GaugeChartOptions) => {\n        draft.thresholds = thresholds;\n      })\n    );\n  };\n\n  return (\n    <OptionsEditorGrid>\n      <OptionsEditorColumn>\n        <OptionsEditorGroup title=\"Misc\">\n          <FormatControls value={format} onChange={handleUnitChange} />\n          <CalculationSelector value={value.calculation} onChange={handleCalculationChange} />\n          <OptionsEditorControl\n            label=\"Max\"\n            control={\n              <TextField\n                type=\"number\"\n                value={value.max ?? ''}\n                onChange={(e) => {\n                  // ensure empty value resets to undef to allow chart to calculate max\n                  const newValue = e.target.value ? Number(e.target.value) : undefined;\n                  onChange(\n                    produce(value, (draft: GaugeChartOptions) => {\n                      draft.max = newValue;\n                    })\n                  );\n                }}\n                placeholder={maxPlaceholder}\n              />\n            }\n          />\n        </OptionsEditorGroup>\n      </OptionsEditorColumn>\n      <OptionsEditorColumn>\n        <ThresholdsEditor thresholds={value.thresholds} onChange={handleThresholdsChange} />\n        <OptionsEditorControl\n          label=\"Show legend\"\n          control={\n            <Switch\n              onChange={(): void => {\n                onChange(\n                  produce(value, (draft: GaugeChartOptions) => {\n                    draft.legend = { ...draft.legend, show: !showLegend };\n                  })\n                );\n              }}\n              checked={showLegend}\n            />\n          }\n        />\n      </OptionsEditorColumn>\n    </OptionsEditorGrid>\n  );\n}\n"],"names":["Switch","TextField","FormatControls","OptionsEditorColumn","OptionsEditorControl","OptionsEditorGrid","OptionsEditorGroup","ThresholdsEditor","CalculationSelector","produce","merge","DEFAULT_FORMAT","DEFAULT_MAX_PERCENT","DEFAULT_MAX_PERCENT_DECIMAL","GaugeChartOptionsEditorSettings","props","onChange","value","showLegend","legend","show","handleCalculationChange","newCalculation","draft","calculation","handleUnitChange","newFormat","format","maxPlaceholder","unit","toString","handleThresholdsChange","thresholds","title","label","control","type","max","e","newValue","target","Number","undefined","placeholder","checked"],"mappings":";AAAA,oCAAoC;AACpC,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,6CAA6C;AAC7C,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;AAEjC,SAASA,MAAM,EAAEC,SAAS,QAAQ,gBAAgB;AAClD,SACEC,cAAc,EAEdC,mBAAmB,EACnBC,oBAAoB,EACpBC,iBAAiB,EACjBC,kBAAkB,EAClBC,gBAAgB,QACX,yBAAyB;AAEhC,SAASC,mBAAmB,QAAkC,4BAA4B;AAC1F,SAASC,OAAO,QAAQ,QAAQ;AAChC,OAAOC,WAAW,eAAe;AAEjC,SACEC,cAAc,EACdC,mBAAmB,EACnBC,2BAA2B,QAGtB,sBAAsB;AAE7B,OAAO,SAASC,gCAAgCC,KAAmC;IACjF,MAAM,EAAEC,QAAQ,EAAEC,KAAK,EAAE,GAAGF;IAC5B;;EAEA,GACA,MAAMG,aAAaD,OAAOE,QAAQC,QAAQ;IAE1C,MAAMC,0BAAgE,CAACC;QACrEN,SACEP,QAAQQ,OAAO,CAACM;YACdA,MAAMC,WAAW,GAAGF;QACtB;IAEJ;IAEA,MAAMG,mBAAoD,CAACC;QACzDV,SACEP,QAAQQ,OAAO,CAACM;YACdA,MAAMI,MAAM,GAAGD;QACjB;IAEJ;IAEA,kDAAkD;IAClD,MAAMC,SAASjB,MAAM,CAAC,GAAGC,gBAAgBM,MAAMU,MAAM;IAErD,uFAAuF;IACvF,IAAIC,iBAAiB;IACrB,IAAID,OAAOE,IAAI,KAAK,WAAW;QAC7BD,iBAAiBhB,oBAAoBkB,QAAQ;IAC/C,OAAO,IAAIH,OAAOE,IAAI,KAAK,mBAAmB;QAC5CD,iBAAiBf,4BAA4BiB,QAAQ;IACvD;IAEA,MAAMC,yBAAyB,CAACC;QAC9BhB,SACEP,QAAQQ,OAAO,CAACM;YACdA,MAAMS,UAAU,GAAGA;QACrB;IAEJ;IAEA,qBACE,MAAC3B;;0BACC,KAACF;0BACC,cAAA,MAACG;oBAAmB2B,OAAM;;sCACxB,KAAC/B;4BAAee,OAAOU;4BAAQX,UAAUS;;sCACzC,KAACjB;4BAAoBS,OAAOA,MAAMO,WAAW;4BAAER,UAAUK;;sCACzD,KAACjB;4BACC8B,OAAM;4BACNC,uBACE,KAAClC;gCACCmC,MAAK;gCACLnB,OAAOA,MAAMoB,GAAG,IAAI;gCACpBrB,UAAU,CAACsB;oCACT,qEAAqE;oCACrE,MAAMC,WAAWD,EAAEE,MAAM,CAACvB,KAAK,GAAGwB,OAAOH,EAAEE,MAAM,CAACvB,KAAK,IAAIyB;oCAC3D1B,SACEP,QAAQQ,OAAO,CAACM;wCACdA,MAAMc,GAAG,GAAGE;oCACd;gCAEJ;gCACAI,aAAaf;;;;;;0BAMvB,MAACzB;;kCACC,KAACI;wBAAiByB,YAAYf,MAAMe,UAAU;wBAAEhB,UAAUe;;kCAC1D,KAAC3B;wBACC8B,OAAM;wBACNC,uBACE,KAACnC;4BACCgB,UAAU;gCACRA,SACEP,QAAQQ,OAAO,CAACM;oCACdA,MAAMJ,MAAM,GAAG;wCAAE,GAAGI,MAAMJ,MAAM;wCAAEC,MAAM,CAACF;oCAAW;gCACtD;4BAEJ;4BACA0B,SAAS1B;;;;;;;AAOvB"}