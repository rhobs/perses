"use strict";(self.chunk_Prometheus=self.chunk_Prometheus||[]).push([["1454"],{30473:function(e,t,n){n.r(t),n.d(t,{PrometheusExplorer:()=>ey});var a=n(62540),l=n(74628),r=n(315),i=n(87034),s=n(33868),o=n(57744),d=n(56432),u=n(85180),c=n(75712),h=n(70451),x=n(24381),p=n(47095),j=n(30145),m=n(97653),f=n(10740),b=n(42927),g=n(25742),A=n(93648),v=n(2582),y=n(8072),w=n(56599),C=n(7013),S=n(39273),k=n(19056),M=n(10871),E=n(98599),_=n(33261),I=n(3412),T=n(45271),P=n(88091),V=n(33313),L=n(6227),R=n(23652),$=n(74649),O=n(91807);function q(e){return`${e.map(e=>`${e.label}${e.operator}"${e.labelValues.join("|")}"`).join(",")}`}function F(e,t,n){let{data:a}=(0,o.useDatasourceClient)(t),l=e.replace(/(_count|_sum|_bucket)$/,""),{data:r,isLoading:i,error:s}=(0,O.useQuery)({enabled:!!a&&n,queryKey:["metricMetadata",l],queryFn:async()=>await a.metricMetadata({metric:l})});return{metadata:(0,h.useMemo)(()=>{var e;for(let t of(null==r||null==(e=r.data)?void 0:e[l])??[])if(t.help.length>0)return t},[r,l]),isLoading:i,error:s}}function D(e,t,n){let{absoluteTimeRange:{start:a,end:l}}=(0,o.useTimeRange)(),{data:r}=(0,o.useDatasourceClient)(n);return(0,O.useQuery)({enabled:!!r,queryKey:["labelValues",e,"datasource",n.name,"start",a,"end","filters",...t],queryFn:async()=>{let n={labelName:e,start:a.valueOf()/1e3,end:l.valueOf()/1e3};return t.length&&(n["match[]"]=[`{${q(t)}}`]),await r.labelValues(n)}})}var Q=n(47601);function N(e){let{label:t,...n}=e;return"gauge"===t?(0,a.jsx)(Q.A,{label:t,color:"success",...n}):"counter"===t?(0,a.jsx)(Q.A,{label:t,color:"primary",...n}):"histogram"===t?(0,a.jsx)(Q.A,{label:t,color:"warning",...n}):"summary"===t?(0,a.jsx)(Q.A,{label:t,color:"secondary",...n}):(0,a.jsx)(Q.A,{label:t,sx:{fontStyle:"unknown"===t?"italic":"initial"},...n})}function z(e){let{children:t,metricName:n,datasource:l,filters:r,isMetadataEnabled:i,onExplore:s}=e,{metadata:o,isLoading:u}=F(n,l,i),c=(0,d.useExplorerQueryParams)({data:{tab:"finder",datasource:l,filters:r,exploredMetric:n}});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(T.A,{style:{width:"300px"},children:(0,a.jsx)(P.A,{sx:{fontFamily:"monospace"},children:t??n})}),(0,a.jsx)(T.A,{style:{width:115,textAlign:"center"},children:i&&u?(0,a.jsx)(V.A,{variant:"rounded",width:75}):(0,a.jsx)(N,{label:(null==o?void 0:o.type)??"unknown"})}),(0,a.jsx)(T.A,{style:{width:"100%"},children:i&&u?(0,a.jsx)(V.A,{variant:"text",width:180}):(0,a.jsx)(P.A,{sx:{fontStyle:(null==o?void 0:o.help)?"initial":"italic",minWidth:"30vw"},children:o?o.help:"unknown"})}),(0,a.jsx)(T.A,{style:{width:140},children:(0,a.jsx)(C.A,{"aria-label":`explore metric ${n}`,variant:"contained",startIcon:(0,a.jsx)(R.default,{}),style:{textWrap:"nowrap"},onClick:()=>null==s?void 0:s(n),component:_.Link,to:`?${c}`,children:"Explore"})})]})}function U(e){let{metricNames:t,filteredResults:n,datasource:l,filters:i,isMetadataEnabled:s,onExplore:o,...d}=e,u=new S.z0,c=(0,h.useMemo)(()=>n||t.map(e=>({original:e})),[n,t]);return(0,a.jsxs)(r.A,{gap:2,width:"100%",divider:(0,a.jsx)(L.A,{orientation:"horizontal",flexItem:!0}),...d,children:[(0,a.jsx)($.Sd,{style:{height:"70vh",width:"100%"},totalCount:c.length,itemContent:e=>(0,a.jsx)(z,{metricName:c[e].original,datasource:l,filters:i,isMetadataEnabled:s,onExplore:o,children:(0,a.jsx)("span",{dangerouslySetInnerHTML:{__html:u.render(c[e].original,c[e].intervals??[],{pre:'<strong style="color:darkorange">',post:"</strong>",escapeHTML:!0})}})})}),(0,a.jsx)(r.A,{sx:{width:"100%"},textAlign:"end",children:(0,a.jsxs)(P.A,{"data-testid":"finder-total",children:["Total: ",(0,a.jsx)("strong",{children:t.length})," metrics"]})})]})}var W=n(67987),H=n(86742),B=n(5611),J=n(76795),K=n(98029);function G(e){let{datasource:t,value:n,filters:l,onChange:r,onDelete:i}=e,s=(0,h.useMemo)(()=>l.filter(e=>e.label!==n.label),[l,n.label]),{data:d,isLoading:u}=function(e,t){let{absoluteTimeRange:{start:n,end:a}}=(0,o.useTimeRange)(),{data:l}=(0,o.useDatasourceClient)(t);return(0,O.useQuery)({enabled:!!l,queryKey:["labels","datasource",t.name,"start",n,"end",a,"filters",...e],queryFn:async()=>{let t={start:n.valueOf()/1e3,end:a.valueOf()/1e3};return e.length&&(t["match[]"]=[`{${q(e)}}`]),await l.labelNames(t)}})}(s,t),{data:c,isLoading:x}=D(n.label,s,t);return(0,a.jsx)(Y,{value:n,labelOptions:(null==d?void 0:d.data)??[],labelValuesOptions:(null==c?void 0:c.data)??[],isLabelOptionsLoading:u,isLabelValuesOptionsLoading:x,onChange:r,onDelete:i})}let Z=(0,h.forwardRef)((e,t)=>{let{children:n,...l}=e,r=(0,h.useRef)("500px"),[i,s]=(0,h.useState)(0);return(0,a.jsx)("ul",{style:{overflow:"hidden",padding:"0",height:i?`min(40vh, ${i}px)`:"40vh"},ref:e=>{let n=e?getComputedStyle(e).maxHeight:null;n&&n!==r.current&&(r.current=n),"function"==typeof t&&t(e)},...l,children:(0,a.jsx)($.aY,{style:{height:r.current,padding:"10px 0"},data:n,totalListHeightChanged:s,itemContent:(e,t)=>(0,h.cloneElement)(t,{index:e,title:t.props.children})})})});function Y(e){let{value:t,labelOptions:n,labelValuesOptions:l,isLabelOptionsLoading:i,isLabelValuesOptionsLoading:s,onChange:o,onDelete:d}=e;return(0,a.jsxs)(r.A,{gap:0,flexDirection:"row",alignItems:"center",children:[(0,a.jsx)(B.A,{freeSolo:!0,disableClearable:!0,options:n??[],value:t.label,sx:{minWidth:200},ListboxComponent:Z,loading:i,renderInput:e=>(0,a.jsx)(A.A,{...e,label:"Label Name",variant:"outlined",fullWidth:!0,size:"medium",sx:{"& .MuiOutlinedInput-root":{borderTopRightRadius:0,borderBottomRightRadius:0}}}),onInputChange:(e,n)=>{o({label:n??"",labelValues:t.labelValues,operator:t.operator})}}),(0,a.jsxs)(J.A,{value:t.operator,variant:"outlined",onChange:e=>"="===t.operator||"!="===t.operator?o({label:t.label,labelValues:[],operator:e.target.value}):"=~"===t.operator||"!~"===t.operator?o({label:t.label,labelValues:t.labelValues.slice(0,1),operator:e.target.value}):void o({label:t.label,labelValues:t.labelValues,operator:e.target.value}),size:"medium",sx:{borderTopLeftRadius:0,borderBottomLeftRadius:0,borderTopRightRadius:0,borderBottomRightRadius:0},children:[(0,a.jsx)(m.A,{value:"=",children:"="}),(0,a.jsx)(m.A,{value:"!=",children:"!="}),(0,a.jsx)(m.A,{value:"=~",children:"=~"}),(0,a.jsx)(m.A,{value:"!~",children:"!~"})]}),(0,a.jsx)(B.A,{freeSolo:!0,multiple:"=~"===t.operator||"!~"===t.operator,limitTags:1,disableClearable:!0,options:l??[],value:t.labelValues,ListboxComponent:Z,sx:{minWidth:200},loading:s,renderInput:e=>(0,a.jsx)(A.A,{...e,label:"=~"===t.operator||"!~"===t.operator?"Label Values":"Label Value",variant:"outlined",fullWidth:!0,size:"medium",sx:{"& .MuiOutlinedInput-root":{borderTopLeftRadius:0,borderBottomLeftRadius:0}},slotProps:{input:{...e.InputProps,style:{maxHeight:"53.13px"},endAdornment:(0,a.jsxs)(v.A,{position:"end",children:[s?(0,a.jsx)(g.A,{color:"inherit",size:20}):null,(0,a.jsx)(p.A,{"aria-label":"delete label filter",onClick:()=>d(),edge:"end",children:(0,a.jsx)(K.default,{})})]})}}}),onInputChange:(e,n)=>{("="===t.operator||"!="===t.operator)&&o({label:t.label,labelValues:[n],operator:t.operator})},onChange:(e,n)=>{Array.isArray(n)&&o({label:t.label,labelValues:n,operator:t.operator})}})]})}function X(e){let{datasource:t,filters:n,filteredFilters:l,onDatasourceChange:i,onFiltersChange:s,...d}=e,{data:u}=(0,o.useListDatasourceSelectItems)(x.eU);return(0,a.jsxs)(r.A,{...d,direction:"row",alignItems:"center",flexWrap:"wrap",gap:1,sx:{width:"100%"},children:[(0,a.jsx)(W.A,{sx:{width:500},children:(0,a.jsx)(o.DatasourceSelect,{size:"medium",datasourcePluginKind:x.eU,value:t,onChange:function(e){i((0,o.datasourceSelectValueToSelector)(e,{},u)??{kind:x.eU})},label:"Prometheus Datasource",fullWidth:!0})}),n.map((e,r)=>(0,a.jsx)(G,{datasource:t,filters:l,value:e,onChange:e=>{let t=[...n];t[r]=e,s(t)},onDelete:()=>{let e=[...n];e.splice(r,1),s(e)}},r)),(0,a.jsx)(C.A,{startIcon:(0,a.jsx)(H.default,{}),"aria-label":"add filter",onClick:()=>{s([...n,{label:"",labelValues:[""],operator:"="}])},children:"Add filter"})]})}Z.displayName="ListboxComponent";var ee=n(65211),et=n(13915),en=n(3908),ea=n(7800),el=n(37266);function er(e){let{label:t,valueCounters:n,onFilterAdd:l,...i}=e,[s,o]=(0,h.useState)(!1),[d,u]=(0,h.useState)("="),[c,x]=(0,h.useState)(""),[j,f]=(0,h.useState)(!1),b=(0,y.A)((0,w.A)().breakpoints.down("md")),g=(0,h.useMemo)(()=>j?n:n.slice(0,5),[j,n]);return(0,a.jsxs)(r.A,{sx:{width:"100%"},direction:b?"column":"row",alignItems:"center",gap:2,...i,children:[(0,a.jsxs)(r.A,{sx:{width:"100%",height:"100%"},justifyContent:"space-between",alignContent:"center",direction:b?"column":"row",children:[(0,a.jsx)(P.A,{sx:{fontFamily:"monospace"},pl:+!b,children:t}),(0,a.jsx)(r.A,{direction:"row",gap:1,alignItems:"center",children:s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(J.A,{size:"small",value:d,variant:"outlined",onChange:e=>{u(e.target.value)},children:[(0,a.jsx)(m.A,{value:"=",children:"="}),(0,a.jsx)(m.A,{value:"!=",children:"!="}),(0,a.jsx)(m.A,{value:"=~",children:"=~"}),(0,a.jsx)(m.A,{value:"!~",children:"!~"})]}),(0,a.jsx)(B.A,{freeSolo:!0,limitTags:1,disableClearable:!0,options:n.map(e=>e.labelValue),value:c,ListboxComponent:Z,sx:{width:250},renderInput:e=>(0,a.jsx)(A.A,{...e,label:"Value",variant:"outlined",fullWidth:!0,size:"small"}),onInputChange:(e,t)=>{x(t)}}),(0,a.jsx)(p.A,{"aria-label":"confirm",onClick:()=>{l({label:t,labelValues:[c],operator:d}),o(!1)},children:(0,a.jsx)(en.default,{})}),(0,a.jsx)(p.A,{"aria-label":"cancel",onClick:()=>{o(!1)},children:(0,a.jsx)(ea.default,{})})]}):(0,a.jsx)(C.A,{startIcon:(0,a.jsx)(H.default,{}),"aria-label":"add filter",onClick:()=>o(!0),children:"Add filter"})})]}),(0,a.jsxs)(r.A,{sx:{width:"100%"},gap:.5,children:[(0,a.jsxs)(r.A,{direction:"row",gap:.5,children:[(0,a.jsxs)(P.A,{variant:"subtitle1",children:[n.length," values"]}),n.length>5&&(0,a.jsx)(C.A,{variant:"text",size:"small",sx:{padding:0},onClick:()=>f(e=>!e),children:j?"[-]":"[+]"})]}),(0,a.jsx)(r.A,{sx:{overflow:b?"auto":"unset"},children:g.map(e=>(0,a.jsxs)(r.A,{direction:"row",gap:2,children:[(0,a.jsx)(P.A,{sx:{color:e=>e.palette.success.main,fontFamily:"monospace",":hover":{backgroundColor:"rgba(127,127,127,0.35)",cursor:"pointer"},textWrap:b?"nowrap":"unset"},onClick:()=>l({label:t,labelValues:[e.labelValue],operator:"="}),children:e.labelValue}),(0,a.jsxs)(P.A,{sx:{textWrap:"nowrap"},children:["(",e.counter," series)"]})]},`${t}-${e.labelValue}`))}),(0,a.jsx)(r.A,{width:"100%",textAlign:b?"center":"unset",children:j?(0,a.jsx)(C.A,{variant:"text",sx:{width:"fit-content"},onClick:()=>f(!1),children:"Hide full values"}):(0,a.jsx)(a.Fragment,{children:n.length>5&&(0,a.jsxs)(C.A,{variant:"text",sx:{width:"fit-content"},onClick:()=>f(!0),children:["Show ",n.length-5," more values"]})})})]})]},t)}function ei(e){let{labelValueCounters:t,isLoading:n,onFilterAdd:l,...i}=e,s=(0,h.useMemo)(()=>[...t.keys()].sort(),[t]);return n?(0,a.jsx)(r.A,{width:"100%",sx:{alignItems:"center",justifyContent:"center"},children:(0,a.jsx)(g.A,{})}):(0,a.jsxs)(r.A,{sx:{width:"100%"},divider:(0,a.jsx)(L.A,{flexItem:!0,orientation:"horizontal"}),gap:2,...i,children:[(0,a.jsxs)(r.A,{gap:2,direction:"row",sx:{width:"100%"},children:[(0,a.jsx)(r.A,{sx:{width:"100%"},children:(0,a.jsx)(P.A,{variant:"h3",children:"Label"})}),(0,a.jsx)(r.A,{sx:{width:"100%"},children:(0,a.jsx)(P.A,{variant:"h3",children:"Values"})})]}),s.map(e=>(0,a.jsx)(er,{label:e,valueCounters:t.get(e)??[],onFilterAdd:l},e))]})}function es(e){let{metricName:t,datasource:n,filters:l,onFilterAdd:i,...s}=e,{metadata:d,isLoading:u,error:c}=F(t,n),{series:x,labelValueCounters:p,isLoading:j,error:m}=function(e,t,n){let{absoluteTimeRange:{start:a,end:l}}=(0,o.useTimeRange)(),{data:r}=(0,o.useDatasourceClient)(n),{data:i,isLoading:s,isError:d,error:u}=(0,O.useQuery)({enabled:!!r,queryKey:["series",e,"datasource",n,"start",a,"end","filters",...t],queryFn:async()=>{let e={"match[]":[`{${q(t)}}`],start:a.valueOf()/1e3,end:l.valueOf()/1e3};return await r.series(e)}}),c=(0,h.useMemo)(()=>{let e=new Map;if((null==i?void 0:i.data)===void 0)return e;for(let t of i.data)for(let[n,a]of Object.entries(t)){let t=e.get(n);if(void 0===t){e.set(n,[{labelValue:a,counter:1}]);continue}let l=t.find(e=>e.labelValue===a);void 0===l?t.push({labelValue:a,counter:1}):l.counter+=1}return e},[i]);return{series:null==i?void 0:i.data,labelValueCounters:c,isLoading:s,isError:d,error:u}}(t,l,n);return(0,a.jsxs)(r.A,{gap:2,...s,children:[(0,a.jsxs)(r.A,{direction:"row",gap:3,mt:1,justifyContent:"space-between",children:[(0,a.jsxs)(r.A,{gap:1,children:[(0,a.jsx)(P.A,{variant:"h1",sx:{fontFamily:"monospace"},children:t}),(0,a.jsx)(P.A,{children:"Description:"}),u?(0,a.jsx)(V.A,{variant:"text",width:180}):(0,a.jsx)(P.A,{style:{fontStyle:(null==d?void 0:d.help)?"initial":"italic"},children:c?"Failed to fetch metadata":(null==d?void 0:d.help)??"unknown"})]}),(0,a.jsxs)(r.A,{gap:1,justifyContent:"center",children:[u?(0,a.jsx)(V.A,{variant:"rounded",width:75}):c?(0,a.jsx)(Q.A,{label:"failed to fetch",color:"error",sx:{fontStyle:"italic"}}):(0,a.jsx)(N,{label:(null==d?void 0:d.type)??"unknown"}),(0,a.jsxs)(P.A,{children:["Result:"," ",j?(0,a.jsx)(V.A,{variant:"text",width:20,sx:{display:"inline-block"}}):m?(0,a.jsx)("strong",{children:"failed to fetch series"}):(0,a.jsxs)("strong",{children:[(null==x?void 0:x.length)??"unknown"," series"]})]})]})]}),m?(0,a.jsx)(el.ErrorAlert,{error:{name:`Failed to fetch series ${(null==m?void 0:m.status)&&`(${m.status})`}`,message:(null==m?void 0:m.message)??"Failed to fetch series"}}):(null==x?void 0:x.length)===0?(0,a.jsx)(r.A,{...s,children:(0,a.jsx)(P.A,{sx:{color:e=>e.palette.warning.main},children:"No series found with current filters."})}):(0,a.jsx)(ei,{labelValueCounters:p,onFilterAdd:i,isLoading:j})]})}var eo=n(54227);function ed(e){let{job:t,filters:n,datasource:l,isMetadataEnabled:i,onExplore:s,...o}=e,d=(0,h.useMemo)(()=>{let e=n.filter(e=>"__name__"!==e.label&&"job"!==e.label);return e.push({label:"job",labelValues:[t],operator:"="}),e},[n,t]),{data:u,isLoading:c}=D("__name__",d,l);return c?(0,a.jsx)(r.A,{width:"100%",sx:{alignItems:"center",justifyContent:"center"},children:(0,a.jsx)(g.A,{})}):(0,a.jsx)(U,{metricNames:(null==u?void 0:u.data)??[],datasource:l,filters:d,isMetadataEnabled:i,onExplore:s,...o})}function eu(e){let{jobs:t,filters:n,datasource:l,isMetadataEnabled:i,onExplore:s,...o}=e,[d,u]=(0,h.useState)(t[0]??"");return d?(0,a.jsxs)(r.A,{gap:2,...o,children:[t.length>2&&(0,a.jsxs)(W.A,{fullWidth:!0,children:[(0,a.jsx)(eo.A,{id:"job-select-label",children:"Job"}),(0,a.jsx)(J.A,{labelId:"job-select-label",id:"job-select",label:"Job",variant:"outlined",value:d,onChange:e=>u(e.target.value),children:t.map(e=>(0,a.jsx)(m.A,{value:e,children:e},e))})]}),d&&(0,a.jsx)(ed,{job:d,filters:n,datasource:l,isMetadataEnabled:i,onExplore:s})]}):(0,a.jsx)(P.A,{children:"Something went wrong..."})}function ec(e){let{filters:t,datasource:n,isMetadataEnabled:l,onExplore:i,...s}=e,{data:o,isLoading:d}=D("job",t,n);return d?(0,a.jsx)(r.A,{width:"100%",sx:{alignItems:"center",justifyContent:"center"},children:(0,a.jsx)(g.A,{})}):(null==o?void 0:o.data)&&0!==o.data.length?(0,a.jsx)(eu,{jobs:o.data,filters:t,datasource:n,isMetadataEnabled:l,onExplore:i,...s}):(0,a.jsx)(r.A,{...s,children:(0,a.jsx)(P.A,{children:"No jobs found"})})}function eh(e){let{filters:t,datasource:n,isMetadataEnabled:l,onExplore:i,...s}=e,o=(0,h.useMemo)(()=>t.filter(e=>"__name__"!==e.label),[t]),{data:d,isLoading:u}=D("__name__",o,n);return u?(0,a.jsx)(r.A,{width:"100%",sx:{alignItems:"center",justifyContent:"center"},children:(0,a.jsx)(g.A,{})}):(0,a.jsx)(U,{metricNames:(null==d?void 0:d.data)??[],datasource:n,filters:o,isMetadataEnabled:l,onExplore:i,...s})}function ex(e){let{metricName:t,datasource:n,filters:l,type:i,isLoading:s,...d}=e,{width:x,ref:p}=(0,u.default)(),j=(0,o.useSuggestedStepMs)(x),[m,g]=(0,h.useState)(!0),{queries:A,definitions:v}=(0,h.useMemo)(()=>{let e=[{kind:"TimeSeriesQuery",spec:{plugin:{kind:"PrometheusTimeSeriesQuery",spec:{datasource:n,query:"counter"===i||m&&(void 0===i||"summary"===i||"histogram"===i)?`rate({__name__="${t}", ${q(l)}}[5m])`:`{__name__="${t}", ${q(l)}}`}}}}],a=e.map(e=>({kind:e.spec.plugin.kind,spec:e.spec.plugin.spec}));return{queries:e,definitions:a}},[n,l,t,m,i]);return s?(0,a.jsx)(r.A,{...d,children:(0,a.jsx)(V.A,{variant:"rectangular",height:"100%"})}):(0,a.jsxs)(r.A,{ref:p,alignItems:"end",...d,children:[(void 0===i||"summary"===i||"histogram"===i)&&(0,a.jsx)(f.A,{control:(0,a.jsx)(b.A,{size:"small"}),label:"Enable rate",checked:m,onChange:(e,t)=>g(t)}),(0,a.jsx)(o.DataQueriesProvider,{definitions:v,options:{suggestedStepMs:j,mode:"range"},children:(0,a.jsx)(c.Panel,{panelOptions:{hideHeader:!0},definition:{kind:"Panel",spec:{queries:A,display:{name:""},plugin:{kind:"TimeSeriesChart",spec:{}}}}})})]})}function ep(e){let{metricName:t,datasource:n,filters:l,isMetadataEnabled:o,isPanelEnabled:d,onExplore:u,onFiltersChange:c,...x}=e,[p,j]=(0,h.useState)(0),{metadata:m,isLoading:f}=F(t,n),b=(0,h.useMemo)(()=>{let e=l.filter(e=>"__name__"!==e.label);return e.push({label:"__name__",labelValues:[t],operator:"="}),e},[l,t]);function g(e,t){null==u||u(e),void 0!==t&&j(t)}return(0,a.jsxs)(r.A,{sx:{width:"100%"},...x,children:[d&&(0,a.jsx)(ex,{metricName:t,filters:l,datasource:n,type:null==m?void 0:m.type,height:"250px",isLoading:o&&f}),(0,a.jsxs)(i.A,{value:p,onChange:(e,t)=>j(t),variant:"scrollable",sx:{borderBottom:1,borderColor:"divider"},children:[(0,a.jsx)(s.A,{label:"Overview"}),(0,a.jsx)(s.A,{label:"Job related metrics",icon:(0,a.jsx)(ee.A,{title:"All metrics scraped from the same job",placement:"top",children:(0,a.jsx)(et.default,{})}),iconPosition:"end"}),l.length>0&&(0,a.jsx)(s.A,{label:"Similar metrics",icon:(0,a.jsx)(ee.A,{title:"All metrics matching current filters",placement:"top",children:(0,a.jsx)(et.default,{})}),iconPosition:"end"})]}),(0,a.jsxs)(r.A,{gap:1,children:[0===p&&(0,a.jsx)(es,{metricName:t,datasource:n,filters:b,onFilterAdd:function(e){c([...l,e])}}),1===p&&(0,a.jsx)(ec,{filters:b,datasource:n,isMetadataEnabled:o,onExplore:e=>g(e,0)}),2===p&&(0,a.jsx)(eh,{filters:b,datasource:n,isMetadataEnabled:o,onExplore:e=>g(e,0)})]})]})}let ej="PERSES_METRICS_FINDER_SETTINGS";function em(e){let{value:t,onChange:n}=e,[l,r]=(0,h.useState)(null);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.A,{"aria-label":"settings",size:"large",onClick:e=>{r(e.currentTarget)},children:(0,a.jsx)(M.default,{})}),(0,a.jsxs)(j.A,{id:"finder-settings-menu",anchorEl:l,open:!!l,onClose:()=>{r(null)},children:[(0,a.jsx)(m.A,{onClick:e=>e.preventDefault(),children:(0,a.jsx)(f.A,{control:(0,a.jsx)(b.A,{}),label:"Enable Metadata",checked:t.isMetadataEnabled,onClick:()=>n({...t,isMetadataEnabled:!t.isMetadataEnabled})})}),(0,a.jsx)(m.A,{onClick:e=>e.preventDefault(),children:(0,a.jsx)(f.A,{control:(0,a.jsx)(b.A,{}),label:"Enable Time Series Chart",checked:t.isPanelEnabled,onClick:()=>n({...t,isPanelEnabled:!t.isPanelEnabled})})})]})]})}function ef(e){let{datasource:t,filters:n,isMetadataEnabled:l,onExplore:i,...s}=e,{data:o,isLoading:d,error:u}=D("__name__",n,t),[c,x]=(0,h.useState)(""),p=(0,h.useMemo)(()=>new S.z0({includeMatches:!0,excludedChars:[" "]}),[]),j=(0,h.useMemo)(()=>{if(c&&(null==o?void 0:o.data))return p.filter(c,o.data).sort((e,t)=>t.score-e.score)},[o,p,c]);return u?(0,a.jsxs)(r.A,{width:"100%",children:["Error: ",u.message]}):d?(0,a.jsx)(r.A,{width:"100%",sx:{alignItems:"center",justifyContent:"center"},children:(0,a.jsx)(g.A,{})}):(0,a.jsxs)(r.A,{...s,children:[(0,a.jsx)(A.A,{value:c,onChange:e=>x(e.target.value),placeholder:"Search metric name...",slotProps:{input:{startAdornment:(0,a.jsx)(v.A,{position:"start",children:(0,a.jsx)(E.default,{})})}}}),(0,a.jsx)(U,{metricNames:(null==o?void 0:o.data)??[],filteredResults:j,datasource:t,filters:n,isMetadataEnabled:l,onExplore:i})]})}function eb(e){let{value:{datasource:t=I.hu,filters:n=[],exploredMetric:l},onChange:i,onExplore:s,...o}=e,u=localStorage.getItem(ej),[c,x]=(0,h.useState)(u?JSON.parse(u):{isMetadataEnabled:!0}),p=(0,y.A)((0,w.A)().breakpoints.down("md")),j=(0,h.useMemo)(()=>n.filter(e=>{let{label:t,labelValues:n}=e;return t&&(null==n?void 0:n[0])}),[n]),m=(0,d.useExplorerQueryParams)({data:{tab:"finder",datasource:t,filters:n,exploredMetric:void 0}});function f(e){i({datasource:t,filters:e,exploredMetric:l})}return(0,a.jsxs)(r.A,{...o,gap:1,children:[(0,a.jsxs)(r.A,{direction:p?"column":"row",gap:2,justifyContent:"space-between",children:[(0,a.jsx)(X,{datasource:t??I.hu,filters:n??[],filteredFilters:j,onDatasourceChange:function(e){i({datasource:e,filters:n,exploredMetric:l})},onFiltersChange:f}),(0,a.jsxs)(r.A,{direction:"row",gap:1,alignItems:"center",children:[l&&(0,a.jsx)(C.A,{variant:"contained","aria-label":"back to metric explorer",startIcon:(0,a.jsx)(k.default,{}),component:_.Link,to:`?${m}`,children:"Back"}),(0,a.jsx)(r.A,{direction:"row",sx:{width:p?"100%":"unset"},justifyContent:p?"end":"unset",alignItems:"center",children:(0,a.jsx)(em,{value:c,onChange:function(e){x(e),localStorage.setItem(ej,JSON.stringify(e))}})})]})]}),l?(0,a.jsx)(ep,{metricName:l,datasource:t??I.hu,filters:j,isMetadataEnabled:c.isMetadataEnabled,isPanelEnabled:c.isPanelEnabled,onFiltersChange:f,onExplore:s}):(0,a.jsx)(ef,{datasource:t??I.hu,filters:j,isMetadataEnabled:c.isMetadataEnabled,onExplore:s})]})}let eg=["PrometheusTimeSeriesQuery"];function eA(e){let{queries:t}=e,{width:n,ref:r}=(0,u.default)(),i=(0,o.useSuggestedStepMs)(n),s=t.length?t.map(e=>({kind:e.spec.plugin.kind,spec:e.spec.plugin.spec})):[];return(0,a.jsx)(l.A,{ref:r,height:700,children:(0,a.jsx)(o.DataQueriesProvider,{definitions:s,options:{suggestedStepMs:i,mode:"range"},children:(0,a.jsx)(c.Panel,{panelOptions:{hideHeader:!0},definition:{kind:"Panel",spec:{queries:t,display:{name:""},plugin:{kind:"TimeSeriesChart",spec:{}}}}})})})}function ev(e){let{queries:t}=e,n=t.map(e=>({kind:e.spec.plugin.kind,spec:e.spec.plugin.spec}));return(0,a.jsx)(l.A,{height:700,children:(0,a.jsx)(o.DataQueriesProvider,{definitions:n,options:{mode:"instant"},children:(0,a.jsx)(c.Panel,{panelOptions:{hideHeader:!0},definition:{kind:"Panel",spec:{queries:t,display:{name:""},plugin:{kind:"TimeSeriesTable",spec:{}}}}})})})}function ey(){let{data:{tab:e="table",queries:t=[],datasource:n=x.hu,filters:l=[],exploredMetric:u},setData:c}=(0,d.useExplorerManagerContext)(),[p,j]=(0,h.useState)(t);return(0,a.jsxs)(r.A,{gap:2,sx:{width:"100%"},children:[(0,a.jsxs)(i.A,{value:e,onChange:(e,n)=>c({tab:n,queries:t}),variant:"scrollable",sx:{borderBottom:1,borderColor:"divider"},children:[(0,a.jsx)(s.A,{value:"table",label:"Table"}),(0,a.jsx)(s.A,{value:"graph",label:"Graph"}),(0,a.jsx)(s.A,{value:"finder",label:"Finder"})]}),(0,a.jsxs)(r.A,{gap:1,children:["table"===e&&(0,a.jsxs)(r.A,{children:[(0,a.jsx)(o.MultiQueryEditor,{queryTypes:["TimeSeriesQuery"],onChange:e=>j(e),queries:p,onQueryRun:()=>c({tab:e,queries:p}),filteredQueryPlugins:eg}),(0,a.jsx)(ev,{queries:t})]}),"graph"===e&&(0,a.jsxs)(r.A,{children:[(0,a.jsx)(o.MultiQueryEditor,{queryTypes:["TimeSeriesQuery"],onChange:e=>j(e),queries:p,onQueryRun:()=>c({tab:e,queries:p}),filteredQueryPlugins:eg}),(0,a.jsx)(eA,{queries:t})]}),"finder"===e&&(0,a.jsx)(r.A,{children:(0,a.jsx)(eb,{onChange:t=>c({tab:e,...t}),value:{datasource:n,filters:l,exploredMetric:u}})})]})]})}},3412:function(e,t,n){function a(e){let[t,n]=e;return[1e3*t,function(e){let t;switch(e){case"+Inf":t=1/0;break;case"-Inf":t=-1/0;break;default:t=parseFloat(e)}return t}(n)]}n.d(t,{OM:()=>c,l3:()=>d,Vx:()=>u,eU:()=>b.eU,_H:()=>s,z:()=>w,Ul:()=>h,bZ:()=>i,ZO:()=>b.ZO,mA:()=>x,gM:()=>o,lS:()=>a,hu:()=>b.hu,LY:()=>v,kG:()=>y,do:()=>b.do});var l=n(37856);function r(e,t){let n=t||new URLSearchParams;e&&Object.entries(e).forEach(e=>{let[t,a]=e;n.set(t,a)});let a=n.toString();return""!==a?`?${a}`:""}function i(e){return async()=>{let t=`${e.datasourceUrl}/-/healthy${r(e.queryParams)}`;try{let n=await (0,l.hd)(t,{headers:e.headers,signal:e.abortSignal});return 200===n.status}catch{return!1}}}function s(e,t){return j("/api/v1/query",e,t)}function o(e,t){return j("/api/v1/query_range",e,t)}function d(e,t){return j("/api/v1/labels",e,t)}function u(e,t){let{labelName:n,...a}=e;return 0===n.length?new Promise(e=>{e({data:[]})}):p(`/api/v1/label/${encodeURIComponent(n)}/values`,a,t)}function c(e,t){return p("/api/v1/metadata",e,t)}function h(e,t){return j("/api/v1/series",e,t)}function x(e,t){return j("/api/v1/parse_query",e,t)}function p(e,t,n){let{datasourceUrl:a,headers:i,queryParams:s}=n,o=`${a}${e}${r(s,m(t))}`;return(0,l.x6)(o,{method:"GET",headers:i})}function j(e,t,n){let{datasourceUrl:a,headers:l,abortSignal:i,queryParams:s}=n;return f(`${a}${e}${r(s)}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",...l},signal:i,body:m(t)})}function m(e){let t=new URLSearchParams;for(let n in e){let a=e[n];if(void 0!==a){if("string"==typeof a){t.append(n,a);continue}if("number"==typeof a){t.append(n,a.toString());continue}for(let e of a)t.append(n,e)}}return t}async function f(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let a=await (0,l.hd)(...t);return{...await a.json(),rawResponse:a}}var b=n(24381),g=n(69791),A=n(94461);function v(e){let{start:t,end:n}=e;return{start:Math.ceil((0,A.getUnixTime)(t)),end:Math.ceil((0,A.getUnixTime)(n))}}function y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=(e.end-e.start)/1e4;return l>1&&(l=Math.ceil(l)),Math.max(a/1e3*n,t,l)}function w(e){if(!e)return;let t=(0,g.pW)(e);return Math.floor((0,A.milliseconds)(t)/1e3)}},24381:function(e,t,n){n.d(t,{ZO:()=>s,do:()=>i,eU:()=>l,hu:()=>r});var a=n(57744);let l="PrometheusDatasource",r={kind:l};function i(e){return!(0,a.isVariableDatasource)(e)&&void 0===e.name}function s(e){return(0,a.isVariableDatasource)(e)||e.kind===l}}}]);