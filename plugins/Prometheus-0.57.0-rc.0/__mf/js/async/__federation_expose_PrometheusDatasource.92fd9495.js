"use strict";(self.chunk_Prometheus=self.chunk_Prometheus||[]).push([["5412"],{37856:function(e,t,a){async function r(...e){let t=await globalThis.fetch(...e);if(!1===t.ok){let e=t.headers.get("content-type");if(e?.includes("application/json")){let e=await t.clone().json();if(e.error)throw new s(e.error,t.status);if(e.message)throw new s(e.message,t.status)}let a=await t.clone().text();if(a)throw new s(a,t.status);throw new i(t)}return t}async function n(...e){let t=await r(...e);if(!t.ok)throw new i(t);return await t.json()}a.d(t,{P7:()=>s,fk:()=>i,hd:()=>r,x6:()=>n});class i extends Error{status;constructor(e){super(`${e.status} ${e.statusText}`),this.status=e.status,Object.setPrototypeOf(this,i.prototype)}}class s extends Error{status;constructor(e,t){super(e),this.status=t,Object.setPrototypeOf(this,s.prototype)}}},42524:function(e,t,a){var r;t.default=void 0,t.default=(0,((r=a(1448))&&r.__esModule?r:{default:r}).default)("M19,13H5V11H19V13Z","Minus")},86742:function(e,t,a){var r;t.default=void 0,t.default=(0,((r=a(1448))&&r.__esModule?r:{default:r}).default)("M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z","Plus")},3412:function(e,t,a){function r(e){let[t,a]=e;return[1e3*t,function(e){let t;switch(e){case"+Inf":t=1/0;break;case"-Inf":t=-1/0;break;default:t=parseFloat(e)}return t}(a)]}a.d(t,{OM:()=>c,l3:()=>u,Vx:()=>d,eU:()=>g.eU,_H:()=>l,z:()=>w,Ul:()=>h,bZ:()=>s,ZO:()=>g.ZO,mA:()=>p,gM:()=>o,lS:()=>r,hu:()=>g.hu,LY:()=>P,kG:()=>x,do:()=>g.do});var n=a(37856);function i(e,t){let a=t||new URLSearchParams;e&&Object.entries(e).forEach(e=>{let[t,r]=e;a.set(t,r)});let r=a.toString();return""!==r?`?${r}`:""}function s(e){return async()=>{let t=`${e.datasourceUrl}/-/healthy${i(e.queryParams)}`;try{let a=await (0,n.hd)(t,{headers:e.headers,signal:e.abortSignal});return 200===a.status}catch{return!1}}}function l(e,t){return m("/api/v1/query",e,t)}function o(e,t){return m("/api/v1/query_range",e,t)}function u(e,t){return m("/api/v1/labels",e,t)}function d(e,t){let{labelName:a,...r}=e;return 0===a.length?new Promise(e=>{e({data:[]})}):f(`/api/v1/label/${encodeURIComponent(a)}/values`,r,t)}function c(e,t){return f("/api/v1/metadata",e,t)}function h(e,t){return m("/api/v1/series",e,t)}function p(e,t){return m("/api/v1/parse_query",e,t)}function f(e,t,a){let{datasourceUrl:r,headers:s,queryParams:l}=a,o=`${r}${e}${i(l,v(t))}`;return(0,n.x6)(o,{method:"GET",headers:s})}function m(e,t,a){let{datasourceUrl:r,headers:n,abortSignal:s,queryParams:l}=a;return y(`${r}${e}${i(l)}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",...n},signal:s,body:v(t)})}function v(e){let t=new URLSearchParams;for(let a in e){let r=e[a];if(void 0!==r){if("string"==typeof r){t.append(a,r);continue}if("number"==typeof r){t.append(a,r.toString());continue}for(let e of r)t.append(a,e)}}return t}async function y(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];let r=await (0,n.hd)(...t);return{...await r.json(),rawResponse:r}}var g=a(24381),_=a(69791),b=a(94461);function P(e){let{start:t,end:a}=e;return{start:Math.ceil((0,b.getUnixTime)(t)),end:Math.ceil((0,b.getUnixTime)(a))}}function x(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=(e.end-e.start)/1e4;return n>1&&(n=Math.ceil(n)),Math.max(r/1e3*a,t,n)}function w(e){if(!e)return;let t=(0,_.pW)(e);return Math.floor((0,b.milliseconds)(t)/1e3)}},24381:function(e,t,a){a.d(t,{ZO:()=>l,do:()=>s,eU:()=>n,hu:()=>i});var r=a(57744);let n="PrometheusDatasource",i={kind:n};function s(e){return!(0,r.isVariableDatasource)(e)&&void 0===e.name}function l(e){return(0,r.isVariableDatasource)(e)||e.kind===n}},40759:function(e,t,a){a.r(t),a.d(t,{PrometheusDatasource:()=>p});var r=a(3412),n=a(62540),i=a(57744),s=a(88091),l=a(93648),o=a(74628),u=a(47095),d=a(86742),c=a(42524),h=a(70451);let p={createClient:(e,t)=>{let{directUrl:a,proxy:n,queryParams:i}=e,{proxyUrl:s}=t,l=a??s;if(void 0===l)throw Error("No URL specified for Prometheus client. You can use directUrl in the spec to configure it.");let o=null==n?void 0:n.spec.headers;return{options:{datasourceUrl:l},healthCheck:(0,r.bZ)({datasourceUrl:l,headers:o,queryParams:i}),instantQuery:(e,t,a)=>(0,r._H)(e,{datasourceUrl:l,headers:t??o,abortSignal:a,queryParams:i}),rangeQuery:(e,t,a)=>(0,r.gM)(e,{datasourceUrl:l,headers:t??o,abortSignal:a,queryParams:i}),labelNames:(e,t,a)=>(0,r.l3)(e,{datasourceUrl:l,headers:t??o,abortSignal:a,queryParams:i}),labelValues:(e,t,a)=>(0,r.Vx)(e,{datasourceUrl:l,headers:t??o,abortSignal:a,queryParams:i}),metricMetadata:(e,t,a)=>(0,r.OM)(e,{datasourceUrl:l,headers:t??o,abortSignal:a,queryParams:i}),series:(e,t,a)=>(0,r.Ul)(e,{datasourceUrl:l,headers:t??o,abortSignal:a,queryParams:i}),parseQuery:(e,t,a)=>(0,r.mA)(e,{datasourceUrl:l,headers:t??o,abortSignal:a,queryParams:i})}},getBuiltinVariableDefinitions:()=>[{kind:"BuiltinVariable",spec:{name:"__interval",value:()=>"$__interval",source:"Prometheus",display:{name:"__interval",description:'For dynamic queries that adapt across different time ranges, use $__interval instead of hardcoded intervals. It represents the actual spacing between data points: itâ€™s calculated based on the current time range and the panel pixel width (taking the "Min step" as a lower bound).',hidden:!0}}},{kind:"BuiltinVariable",spec:{name:"__interval_ms",value:()=>"$__interval_ms",source:"Prometheus",display:{name:"__interval_ms",description:"Same as $__interval but in milliseconds.",hidden:!0}}},{kind:"BuiltinVariable",spec:{name:"__rate_interval",value:()=>"$__rate_interval",source:"Prometheus",display:{name:"__rate_interval",description:"Use this one rather than $__interval as the range parameter of functions like rate, increase, etc. With such function it is advised to choose a range that is at least 4x the scrape interval (this is to allow for various races, and to be resilient to a failed scrape). $__rate_interval provides that, as it is defined as `max($__interval + Min Step, 4 * Min Step)`, where Min Step value should represent the scrape interval of the metrics.",hidden:!0}}}],OptionsEditorComponent:function(e){let{value:t,onChange:a,isReadonly:r}=e,p=(0,h.useRef)(0),[f,m]=(0,h.useState)(()=>Object.entries(t.queryParams??{}).map(e=>{let[t,a]=e;return{id:String(p.current++),key:t,value:a}})),v=new Map,y=new Set;f.forEach(e=>{let{key:t}=e;if(""!==t){let e=(v.get(t)||0)+1;v.set(t,e),e>1&&y.add(t)}});let g=y.size>0,_=e=>{let r={};e.forEach(e=>{let{key:t,value:a}=e;""!==t&&(r[t]=a)}),a({...t,queryParams:Object.keys(r).length>0?r:void 0})},b=(e,t,a)=>{let r=f.map(r=>r.id!==e?r:"key"===t?{...r,key:a}:{...r,value:a});m(r),_(r)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.A,{variant:"h4",mb:2,children:"General Settings"}),(0,n.jsx)(l.A,{size:"small",fullWidth:!0,label:"Scrape Interval",value:t.scrapeInterval||"",placeholder:"Default: 1m",InputProps:{readOnly:r},InputLabelProps:{shrink:!!r||void 0},onChange:e=>a({...t,scrapeInterval:e.target.value}),helperText:"Set it to match the typical scrape interval used in your Prometheus instance."}),(0,n.jsx)(i.HTTPSettingsEditor,{value:t,onChange:a,isReadonly:r,initialSpecDirect:{directUrl:""},initialSpecProxy:{proxy:{kind:"HTTPProxy",spec:{allowedEndpoints:[{endpointPattern:"/api/v1/labels",method:"POST"},{endpointPattern:"/api/v1/series",method:"POST"},{endpointPattern:"/api/v1/metadata",method:"GET"},{endpointPattern:"/api/v1/query",method:"POST"},{endpointPattern:"/api/v1/query_range",method:"POST"},{endpointPattern:"/api/v1/label/([a-zA-Z0-9_-]+)/values",method:"GET"},{endpointPattern:"/api/v1/parse_query",method:"POST"}],url:""}}}}),(0,n.jsx)(s.A,{variant:"h5",mt:2,mb:1,children:"Query Parameters"}),f.length>0&&(0,n.jsx)(n.Fragment,{children:f.map(e=>(0,n.jsxs)(o.A,{display:"flex",alignItems:"center",gap:2,mb:1,children:[(0,n.jsx)(l.A,{size:"small",label:"Key",value:e.key,placeholder:"Parameter name",disabled:r,onChange:t=>b(e.id,"key",t.target.value),error:y.has(e.key),sx:{minWidth:150}}),(0,n.jsx)(l.A,{size:"small",label:"Value",value:e.value,placeholder:"Parameter value",disabled:r,onChange:t=>b(e.id,"value",t.target.value),sx:{minWidth:150,flexGrow:1}}),!r&&(0,n.jsx)(u.A,{onClick:()=>{var t;let a;return t=e.id,void(m(a=f.filter(e=>e.id!==t)),_(a))},children:(0,n.jsx)(c.default,{})})]},e.id))}),g&&(0,n.jsx)(s.A,{variant:"body2",color:"error",mb:1,children:"Duplicate parameter keys detected. Each key must be unique."}),0===f.length&&(0,n.jsx)(s.A,{variant:"body2",color:"textSecondary",children:"No query parameters configured. Use query parameters to pass additional options to Prometheus (e.g., dedup=false for Thanos)."}),!r&&(0,n.jsx)(u.A,{onClick:()=>{let e=[...f,{id:String(p.current++),key:"",value:""}];m(e),_(e)},children:(0,n.jsx)(d.default,{})})]})},createInitialOptions:()=>({directUrl:""})}}}]);