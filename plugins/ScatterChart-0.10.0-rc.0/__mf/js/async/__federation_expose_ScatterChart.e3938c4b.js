"use strict";(self.chunk_ScatterChart=self.chunk_ScatterChart||[]).push([["211"],{62547:function(e,t,r){r.r(t),r.d(t,{ScatterChart:()=>y});var a=r(62540),n=r(70451),o=r(37266),i=r(74653),s=r(32741),l=r(90652),u=r(61305),c=r(50944),d=r(59738),m=r(72106),h=r(55875),p=r(37573),b=r(12826),f=r(57744);(0,i.Y)([l.a,u.a,c.a,s.a,d.a,m.a,h.a,p.a]);let v=new Intl.DateTimeFormat(void 0,{dateStyle:"long",timeStyle:"medium"}).format;function C(e){let{width:t,height:r,options:i,link:s}=e,l=(0,o.useChartsTheme)(),{absoluteTimeRange:u}=(0,f.useTimeRange)(),c=(0,f.useAllVariableValues)(),{navigate:d}=(0,f.useRouterContext)(),m={dataset:i.dataset,series:i.series,dataZoom:i.dataZoom,grid:{top:45,bottom:20,left:30,right:20},xAxis:{type:"time",min:u.start,max:u.end},yAxis:{scale:!0,type:"value",name:"Duration",splitNumber:4,axisLabel:{formatter:e=>(0,b.Fl)(e,{unit:"milliseconds"})}},animation:!1,tooltip:{padding:5,borderWidth:1,trigger:"axis",axisPointer:{type:"cross"},formatter:function(e){let t=e[0].data;return`<b>Service name</b>: ${t.rootServiceName}<br/><b>Span name</b>: ${t.rootTraceName}<br/><b>Time</b>: ${v(t.startTime)}<br/><b>Duration</b>: ${(0,b.Fl)(t.durationMs,{unit:"milliseconds"})}<br/><b>Span count</b>: ${t.spanCount} (${t.errorCount} errors)<br/>`}},legend:{show:!0,type:"scroll",orient:"horizontal",bottom:0}},h=(0,n.useMemo)(()=>{let e={};return d&&s&&(e.click=e=>{let t=e.data.linkVariables;d((0,f.replaceVariablesInString)(s,c,t))}),e},[s,d,c]);return(0,a.jsx)(o.EChart,{style:{width:t,height:r},option:m,theme:l.echartsTheme,onEvents:h})}let S=[6,20],y={PanelComponent:function(e){let{spec:t,contentDimensions:r,queryResults:i}=e,s=(0,o.useChartsTheme)().thresholds.defaultColor||"blue",l=t.sizeRange||S,{dataset:u,minSpanCount:c,maxSpanCount:d}=(0,n.useMemo)(()=>{let e,t,r=[];for(let a of i){if(void 0===a.data.searchResult)continue;let n=a.data.searchResult.map(r=>{var n;let o=0,i=0;for(let e of Object.values(r.serviceStats))o+=e.spanCount,i+=e.errorCount??0;(void 0===e||o<e)&&(e=o),(void 0===t||o>t)&&(t=o);let s=a.definition.spec.plugin.spec;return{...r,linkVariables:{datasourceName:(null==s||null==(n=s.datasource)?void 0:n.name)??"",traceId:r.traceId},name:`${r.rootServiceName}: ${r.rootTraceName}`,startTime:new Date(r.startTimeUnixMs),spanCount:o,errorCount:i}});r.push({source:n})}return{dataset:r,minSpanCount:e??0,maxSpanCount:t??0}},[i]),m=(0,n.useMemo)(()=>{let e={type:"scatter",encode:{x:"startTime",y:"durationMs"},symbolSize:function(e){return function(e,t,r){let[a,n]=r,[o,i]=t;return i-o==0?n:a+(e-o)/(i-o)*(n-a)}(e.spanCount,[c,d],l)},itemStyle:{color:function(e){return e.data.errorCount>0?"red":s}}},t=[];for(let r=0;r<u.length;r++)t.push({...e,datasetIndex:r});return t},[u,s,c,d,l]);return i.some(e=>{var t;return((null==(t=e.data)?void 0:t.searchResult)??[]).length>0})?void 0===r?null:(0,a.jsx)("div",{"data-testid":"ScatterChartPanel_ScatterPlot",children:(0,a.jsx)(C,{width:r.width,height:r.height,options:{dataset:u,series:m},link:t.link})}):(0,a.jsx)(o.NoDataOverlay,{resource:"traces"})},supportedQueryTypes:["TraceQuery"],createInitialOptions:function(){return{}}}}}]);